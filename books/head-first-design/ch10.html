<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/head-first-design/0596007124/ch10.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy="public"


  data-user-id="2198516"
  data-user-uuid="48b847cc-4100-401a-9732-d0a93f06ed1e"
  data-username="Evan_l00"
  data-account-type="B2B"
  
  data-activated-trial-date=""


  data-archive="0596007124"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch10.html"
  data-epub-title="Head First Design Patterns" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/head-first-design/0596007124/ch10.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy="public"


  data-user-id="2198516"
  data-user-uuid="48b847cc-4100-401a-9732-d0a93f06ed1e"
  data-username="Evan_l00"
  data-account-type="B2B"
  
  data-activated-trial-date=""


  data-archive="0596007124"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch10.html"
  data-epub-title="Head First Design Patterns" data-debug=0 data-testing=0><!--<![endif]--><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="author" content="Safari Books Online" /><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://0596007124"/><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"/><meta property="twitter:account_id" content="4503599627559754" /><script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,n,t){function r(t){if(!n[t]){var o=n[t]={exports:{}};e[t][0].call(o.exports,function(n){var o=e[t][1][n];return r(o||n)},o,o.exports)}return n[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<t.length;o++)r(t[o]);return r}({1:[function(e,n,t){function r(){}function o(e,n,t){return function(){return i(e,[c.now()].concat(u(arguments)),n?null:this,t),n?void 0:this}}var i=e("handle"),a=e(3),u=e(4),f=e("ee").get("tracer"),c=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(e,n){s[n]=o(d+n,!0,"api")}),s.addPageAction=o(d+"addPageAction",!0),s.setCurrentRouteName=o(d+"routeName",!0),n.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,n){var t={},r=this,o="function"==typeof n;return i(l+"tracer",[c.now(),e,t],r),function(){if(f.emit((o?"":"no-")+"fn-start",[c.now(),r,o],t),o)try{return n.apply(this,arguments)}catch(e){throw f.emit("fn-err",[arguments,this,e],t),e}finally{f.emit("fn-end",[c.now()],t)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,n){m[n]=o(l+n)}),newrelic.noticeError=function(e,n){"string"==typeof e&&(e=new Error(e)),i("err",[e,c.now(),!1,n])}},{}],2:[function(e,n,t){function r(e,n){if(!o)return!1;if(e!==o)return!1;if(!n)return!0;if(!i)return!1;for(var t=i.split("."),r=n.split("."),a=0;a<r.length;a++)if(r[a]!==t[a])return!1;return!0}var o=null,i=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var u=navigator.userAgent,f=u.match(a);f&&u.indexOf("Chrome")===-1&&u.indexOf("Chromium")===-1&&(o="Safari",i=f[1])}n.exports={agent:o,version:i,match:r}},{}],3:[function(e,n,t){function r(e,n){var t=[],r="",i=0;for(r in e)o.call(e,r)&&(t[i]=n(r,e[r]),i+=1);return t}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],4:[function(e,n,t){function r(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(o<0?0:o);++r<o;)i[r]=e[n+r];return i}n.exports=r},{}],5:[function(e,n,t){n.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,n,t){function r(){}function o(e){function n(e){return e&&e instanceof r?e:e?f(e,u,i):i()}function t(t,r,o,i){if(!d.aborted||i){e&&e(t,r,o);for(var a=n(o),u=v(t),f=u.length,c=0;c<f;c++)u[c].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(e,n){h[e]=v(e).concat(n)}function m(e,n){var t=h[e];if(t)for(var r=0;r<t.length;r++)t[r]===n&&t.splice(r,1)}function v(e){return h[e]||[]}function g(e){return p[e]=p[e]||o(t)}function w(e,n){c(e,function(e,t){n=n||"feature",y[t]=n,n in s||(s[n]=[])})}var h={},y={},b={on:l,addEventListener:l,removeEventListener:m,emit:t,get:g,listeners:v,context:n,buffer:w,abort:a,aborted:!1};return b}function i(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var u="nr@context",f=e("gos"),c=e(3),s={},p={},d=n.exports=o();d.backlog=s},{}],gos:[function(e,n,t){function r(e,n,t){if(o.call(e,n))return e[n];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,n,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[n]=r,r}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],handle:[function(e,n,t){function r(e,n,t,r){o.buffer([e],r),o.emit(e,n,t)}var o=e("ee").get("handle");n.exports=r,r.ee=o},{}],id:[function(e,n,t){function r(e){var n=typeof e;return!e||"object"!==n&&"function"!==n?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");n.exports=r},{}],loader:[function(e,n,t){function r(){if(!E++){var e=x.info=NREUM.info,n=l.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&n))return s.abort();c(y,function(n,t){e[n]||(e[n]=t)}),f("mark",["onload",a()+x.offset],null,"api");var t=l.createElement("script");t.src="https://"+e.agent,n.parentNode.insertBefore(t,n)}}function o(){"complete"===l.readyState&&i()}function i(){f("mark",["domContent",a()+x.offset],null,"api")}function a(){return O.exists&&performance.now?Math.round(performance.now()):(u=Math.max((new Date).getTime(),u))-x.offset}var u=(new Date).getTime(),f=e("handle"),c=e(3),s=e("ee"),p=e(2),d=window,l=d.document,m="addEventListener",v="attachEvent",g=d.XMLHttpRequest,w=g&&g.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:g,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var h=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1130.min.js"},b=g&&w&&w[m]&&!/CriOS/.test(navigator.userAgent),x=n.exports={offset:u,now:a,origin:h,features:{},xhrWrappable:b,userAgent:p};e(1),l[m]?(l[m]("DOMContentLoaded",i,!1),d[m]("load",r,!1)):(l[v]("onreadystatechange",o),d[v]("onload",r)),f("mark",["firstbyte",u],null,"api");var E=0,O=e(5)},{}]},{},["loader"]);</script><link rel="apple-touch-icon" href="/static/images/apple-touch-icon.0c29511d2d72.png"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic' rel='stylesheet' type='text/css'><title>10. The State Pattern: The State of Things - Head First Design Patterns</title><link rel="stylesheet" href="/static/CACHE/css/output.68851547a55f.css" type="text/css" /><link rel="stylesheet" type="text/css" href="/static/css/annotator.e3b0c44298fc.css"/><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book">
    @charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content font,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}@page{margin:5px !important}#sbo-rt-content p{margin:8px 0 0;line-height:125%;text-align:left}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link{text-decoration:none;color:#8e0012}#sbo-rt-content sup{font-size:x-small;vertical-align:super}#sbo-rt-content sub{font-size:smaller;vertical-align:sub}#sbo-rt-content span.lineannotation{font-style:italic;color:#A62A2A;font-family:serif,"DejaVuSerif"}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#FFF}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content h1,#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important}#sbo-rt-content h2{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content h3{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content h4{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content h5{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section.chapter div.titlepage,#sbo-rt-content section.appendix div.titlepage,#sbo-rt-content section.preface div.titlepage{page-break-inside:avoid;page-break-after:avoid}#sbo-rt-content section.chapter>div.titlepage,#sbo-rt-content section.preface>div.titlepage,#sbo-rt-content section.appendix>div.titlepage{margin-bottom:50px}#sbo-rt-content section.chapter>div.titlepage h2.title,#sbo-rt-content section.preface>div.titlepage h2.title,#sbo-rt-content section.appendix>div.titlepage h2.title{font-size:2em;line-height:1;margin-bottom:15px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content div.toc-title{margin-bottom:30px !important}#sbo-rt-content div.part h1{font-size:2em;text-align:center;margin-top:0 !important;padding:50px 0 20px 0;border-bottom:1px solid #000}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center;-webkit-border-radius:5px;border-radius:5px;border:1px solid #DCDCDC;padding:15px 5px 15px 5px !important;margin:30px 0 30px 0 !important;max-height:100%;page-break-inside:avoid}#sbo-rt-content div.figure-title,#sbo-rt-content div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.informalfigure{text-align:center;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:30px 0 20px 0 !important;-webkit-border-radius:5px;border-radius:5px;border:1px solid #DCDCDC;background-color:#F7F7F7;font-size:90%;padding:15px !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title{font-weight:bold;font-size:1em;font-family:sans-serif,"DejaVuSans";text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar ol{margin-left:15px}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div.caution,#sbo-rt-content div.sidebar div.important{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content div.sidebar div.figure{border:none}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div.example{margin:10px 0 15px 0 !important}#sbo-rt-content div.example-title{font-style:italic;font-weight:normal;font-family:serif,"DejaVuSerif";margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div.example-contents pre.programlisting,#sbo-rt-content div.example-contents pre.screen{margin:0}#sbo-rt-content span.gray{color:#4C4C4C}#sbo-rt-content div.book div.titlepage h1.title{font-size:3em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content div.book div.titlepage h2.subtitle{text-align:center;color:#000;margin:0 !important;font-style:italic;font-family:serif;font-size:1.5em}#sbo-rt-content div.book div.titlepage div.author h3{font-size:2em;font-family:sans-serif,"DejaVuSans";font-weight:bold;color:#8e0012;margin:50px 0 !important;text-align:center}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif,"DejaVuSerif";font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif,"DejaVuSerif";margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10pt}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-family:serif,"DejaVuSerif";font-style:italic}#sbo-rt-content blockquote div.attribution{margin:5px 0 0 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p{font-style:normal}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div.footnote{font-size:90%}#sbo-rt-content div.refnamediv h2,#sbo-rt-content div.refnamediv h3,#sbo-rt-content div.refsynopsisdiv h2{font-size:1.1em;color:#000;margin-top:15px !important;margin-bottom:0 !important}#sbo-rt-content div.refentry div.refsect1 h2{font-size:1.1em;color:#000;margin-top:15px !important;margin-bottom:0 !important}#sbo-rt-content div.refsect2 h3{font-size:1em;color:#000;margin-top:10px !important;margin-bottom:0 !important}#sbo-rt-content div.refnamediv p{margin-left:15px !important}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dt span.term{font-weight:bold;font-style:italic}#sbo-rt-content dt span.term code.literal{font-style:normal;font-weight:normal}#sbo-rt-content dt span.term em code.literal{font-style:italic}#sbo-rt-content dd{margin-left:1.5em !important}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ol{list-style-type:decimal;margin-top:8px !important;margin-bottom:8px !important;margin-left:20px !important;padding-left:25px !important}#sbo-rt-content ol[type="A"]{list-style-type:upper-alpha}#sbo-rt-content ol[type="I"]{list-style-type:upper-roman}#sbo-rt-content ol[type="a"]{list-style-type:lower-alpha}#sbo-rt-content ol[type="i"]{list-style-type:lower-roman}#sbo-rt-content ol ol{list-style-type:lower-alpha}#sbo-rt-content ol ol ol{list-style-type:lower-roman}#sbo-rt-content ul{list-style-type:square;margin-top:8px !important;margin-bottom:8px !important;margin-left:5px !important;padding-left:20px !important}#sbo-rt-content ul ul{list-style-type:none;padding-left:0 !important;margin-left:0 !important}#sbo-rt-content ol li,#sbo-rt-content ul li,#sbo-rt-content dd{margin-bottom:1em}#sbo-rt-content ul ul li p:before{content:"— "}#sbo-rt-content ul ul ul li p:before{content:""}#sbo-rt-content ul ul ul{list-style-type:square;margin-left:20px !important;padding-left:30px !important}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist{margin-left:20px !important;margin-bottom:10px}#sbo-rt-content table.simplelist td{border:none;font-size:90%}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content div.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content div.calloutlist img{padding:0}#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.calloutlist>dl>dd>div.orderedlist{margin-top:25pt}#sbo-rt-content div.calloutlist>dl>dd>div.orderedlist>ol.orderedlist>li{margin-bottom:25pt}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div.note,#sbo-rt-content div.warning,#sbo-rt-content div.caution,#sbo-rt-content div.important{margin:30px !important;-webkit-border-radius:5px;border-radius:5px;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip,#sbo-rt-content div.note,#sbo-rt-content div.important{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div.caution{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div.note h3,#sbo-rt-content div.warning h3,#sbo-rt-content div.caution h3,#sbo-rt-content div.important h3{font:bold 90%;font-family:sans-serif,"DejaVuSans";text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div.tip h3,#sbo-rt-content div.note h3,#sbo-rt-content div.important h3{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div.caution h3{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;-webkit-border-radius:0;border-radius:0;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px auto 30px auto !important;max-width:95%;border-collapse:collapse;border-spacing:0}#sbo-rt-content div.table,#sbo-rt-content div.informaltable{page-break-inside:avoid}#sbo-rt-content tr{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif,"DejaVuSans";color:#000;font-weight:bold}#sbo-rt-content td{padding:.3em;text-align:left;vertical-align:baseline;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title{font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";margin:20px 0 0 0 !important;text-align:center;padding:0}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content div.equation{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title{font-style:italic;font-weight:normal;font-family:serif,"DejaVuSerif";margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{font-weight:bold}#sbo-rt-content div.index dt{line-height:140%}#sbo-rt-content div.index a.indexterm{color:#8e0012}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif,"DejaVuSerif";text-align:left}
    </style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/0596007124/chapter/ch10.html",
          "book_id": "0596007124",
          "chapter_uri": "ch10.html",
          "position": 1.26118538794,
          "user_uuid": "48b847cc-4100-401a-9732-d0a93f06ed1e",
          "next_chapter_uri": "/library/view/head-first-design/0596007124/ch11.html"
        
      },
      title: "Head First Design Patterns",
      author_list: "Kathy Sierra, Bert Bates, Elisabeth Robson, Eric Freeman",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false
    };
    // ]]></script><script src="/static/js/src/modernizr.8e35451ddb64.js"></script><script>
    
      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

      window.PRIVACY_CONTROL_SWITCH = true;

      window.PUBLISHER_PAGES = true;

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://learning.oreilly.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://learning.oreilly.com/library/view/head-first-design/0596007124/ch10.html"/><meta name="description" content="Chapter 10. The State Pattern: The State of Things A little-known fact: the Strategy and State Patterns were twins separated at birth. As you know, the Strategy Pattern went on to create ... "><meta property="og:title" content="10. The State Pattern: The State of Things" /><meta itemprop="isPartOf" content="/library/view/head-first-design/0596007124/" /><meta itemprop="name" content="10. The State Pattern: The State of Things" /><meta property="og:url" itemprop="url" content="https://learning.oreilly.com/library/view/head-first-design/0596007124/ch10.html" /><meta property="og:site_name" content="Safari" /><meta property="og:image" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/0596007124/" /><meta property="og:description" itemprop="description" content="Chapter 10. The State Pattern: The State of Things A little-known fact: the Strategy and State Patterns were twins separated at birth. As you know, the Strategy Pattern went on to create ... "><meta itemprop="inLanguage" content="en" /><meta itemprop="publisher" content="O&#39;Reilly Media, Inc." /><meta property="og:type" content="book" /><meta property="og:book:isbn" itemprop="isbn" content="9780596007126" /><meta property="og:book:author" itemprop="author" content="Kathy Sierra" /><meta property="og:book:author" itemprop="author" content="Bert Bates" /><meta property="og:book:author" itemprop="author" content="Elisabeth Robson" /><meta property="og:book:author" itemprop="author" content="Eric Freeman" /><meta property="og:book:tag" itemprop="about" content="Core Programming" /><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script type="text/javascript">
    (function(i,s,o,g,r,a,m) {
      i['GoogleAnalyticsObject']=r;
      i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();
      a=s.createElement(o),m=s.getElementsByTagName(o)[0];
      a.async=1;
      a.src=g;
      m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    var matches = document.cookie.match(/BrowserCookie\s*=\s*([a-f0-9\-]{36})/),
      user_uuid = null;

    if (matches && matches.length === 2) {
      user_uuid = matches[1];
    }

  
    ga('create', 'UA-39299553-7', {'userId': '48b847cc-4100-401a-9732-d0a93f06ed1e' });
  

  
    
      ga('set', 'dimension1', 'B2B');
    
  

  ga('set', 'dimension6', user_uuid);

  
    ga('set', 'dimension2', '48b847cc-4100-401a-9732-d0a93f06ed1e');
    
      ga('set', 'dimension7', '0014100001N37poAAB');
    
  

  

  

  //enable enhanced link tracking
  ga('require', 'linkid', 'linkid.js');

  // reading interface will track pageviews itself
  if (document.location.pathname.indexOf("/library/view") !== 0) {
    ga('send', 'pageview');
  }
  </script><script>
    var dataLayer = window.dataLayer || [];

    
      window.medalliaVsgUserIdentifier = '48b847cc-4100-401a-9732-d0a93f06ed1e';
      dataLayer.push({userIdentifier: '48b847cc-4100-401a-9732-d0a93f06ed1e'});
      dataLayer.push({loggedIn: 'yes'});

      
        window.medalliaVsgAccountIdentifier = '555c1d98-46da-46de-8ca0-0032dbcc46d2';
        
        dataLayer.push({orgID: '555c1d98-46da-46de-8ca0-0032dbcc46d2'});
        

        window.medalliaVsgIsIndividual = false;
        
          
          dataLayer.push({learningAccountType: 'enterprise'});
          
        

        
          dataLayer.push({learningPaidAccount: 'yes'});
        
      
    

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
    (function () {
      var VERSION = 'V1.1';
      var AUTHOR = 'Awwad';
      if (!window.GtmHelper)
        window.GtmHelper = function () {
          var instance = this;
          var loc = document.location;
          this.version = VERSION;
          this.author = AUTHOR;
          this.readCookie = function (name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
          };
          this.createCookie = function (name, value, days, cookieDomain) {
            var domain = "";
            var expires = "";

            if (days) {
              var date = new Date();
              date.setTime(date.getTime() + Math.ceil(days * 24 * 60 * 60 * 1000));
              var expires = " expires=" + date.toGMTString() + ";";
            }

            if (typeof (cookieDomain) != 'undefined')
              domain = " domain=" + cookieDomain + "; ";

            document.cookie = name + "=" + value + ";" + expires + domain + "path=/";
          };

          this.isDuplicated = function (currentTransactionId) {
            // the previous transaction id:
            var previousTransIdValue = this.readCookie("previousTransId");

            if (currentTransactionId === previousTransIdValue) {
              return true; // Duplication
            } else {
              return false;
            }
          };
        }
    })()
  </script><script defer src="/static/js/build/vendor.75d9ef59282e.js"></script><script defer src="/static/js/build/reader.a89acaddae62.js"></script></head>


<body class="reading sidenav nav-collapsed  scalefonts">

    
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        

  




<a href="#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.738 14H9.254v-3.676a.617.617 0 0 0-.621-.613H7.39a.617.617 0 0 0-.62.613V14H4.284a.617.617 0 0 1-.622-.613V10.22c0-.327.132-.64.367-.87l3.547-3.493a.627.627 0 0 1 .875 0l3.54 3.499c.234.229.366.54.367.864v3.167a.617.617 0 0 1-.62.613zM7.57 2.181a.625.625 0 0 1 .882 0l5.77 5.692-.93.92-5.28-5.209-5.28 5.208-.932-.919 5.77-5.692z" /></svg><span>Safari Home</span></a></li><li><a href="/resource-centers/" class="t-resource-centers-nav l0 nav-icn"><?xml version="1.0" encoding="UTF-8"?><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Topic-Page-Design" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Heron-Button" transform="translate(-20.000000, -78.000000)" fill="#4A3A30"><g id="Group-9" transform="translate(20.000000, 78.000000)"><rect id="Rectangle" x="9.6" y="0" width="6.4" height="6.4" rx="0.503118"></rect><rect id="Rectangle" x="9.6" y="9.6" width="6.4" height="6.4" rx="0.503118"></rect><rect id="Rectangle" x="0" y="9.6" width="6.4" height="6.4" rx="0.503118"></rect></g></g></g></svg><span>Resource Centers</span></a></li><li><a href="/playlists/" class="t-queue-nav l0 nav-icn None"><?xml version="1.0" encoding="UTF-8"?><svg width="21px" height="17px" viewBox="0 0 21 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- Generator: Sketch 46.2 (44496) - http://www.bohemiancoding.com/sketch --><title>icon_Playlist_sml</title><desc>Created with Sketch.</desc><defs></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="icon_Playlist_sml" fill-rule="nonzero" fill="#000000"><g id="playlist-icon"><g id="Group-6"><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle></g><g id="Group-5" transform="translate(0.000000, 7.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g><g id="Group-5-Copy" transform="translate(0.000000, 14.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g></g></g></g></svg><span>
               Playlists
            </span></a></li><li class="search"><a href="#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"/></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"/></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z"/></g></svg><span>History</span></a></li><li><a href="/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" width="20" height="20" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z"/></g></svg><span>Topics</span></a></li><li><a href="/learning-paths/" class="l1 nav-icn t-learningpaths-nav js-toggle-menu-item"><?xml version="1.0" encoding="UTF-8"?><svg width="32px" height="32px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- Generator: Sketch 52.5 (67469) - http://www.bohemiancoding.com/sketch --><title>Mask</title><desc>Created with Sketch.</desc><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M0,16.0214227 C0,15.0387209 0.796453294,14.2411658 1.77779753,14.2411658 C2.75914177,14.2411658 3.55559506,15.0387209 3.55559506,16.0214227 C3.55559506,17.0041246 2.75914177,17.8016797 1.77779753,17.8016797 C0.796453294,17.8016797 0,17.0041246 0,16.0214227 Z M9.77788642,5.22914885 C8.9280992,5.72049977 7.84008711,5.42853763 7.34941499,4.57757479 C6.85874287,3.72661195 7.15030167,2.63709467 8.00008889,2.14574375 C8.84987611,1.65439282 9.9378882,1.94635496 10.4285603,2.7973178 C10.9192324,3.64828064 10.6276736,4.73779792 9.77788642,5.22914885 Z M4.57213969,7.35869225 C5.42192691,7.85004318 5.71348571,8.93956046 5.22281359,9.79052329 C4.73214147,10.6414861 3.64412938,10.9334483 2.79434216,10.4420974 C1.94455494,9.95074642 1.65299614,8.86122915 2.14366826,8.01026631 C2.63434038,7.15930347 3.72235247,6.86734132 4.57213969,7.35869225 Z M2.79434216,21.6007481 C3.64412938,21.1093972 4.73214147,21.4013594 5.22281359,22.2523222 C5.71348571,23.103285 5.42192691,24.1928023 4.57213969,24.6841532 C3.72235247,25.1755042 2.63434038,24.883542 2.14366826,24.0325792 C1.65299614,23.1816163 1.94455494,22.0920991 2.79434216,21.6007481 Z M7.34941499,27.4652707 C7.84008711,26.6143079 8.9280992,26.3223457 9.77788642,26.8136966 C10.6276736,27.3050476 10.9192324,28.3945649 10.4285603,29.2455277 C9.9378882,30.0964905 8.84987611,30.3884527 8.00008889,29.8971017 C7.15030167,29.4057508 6.85874287,28.3162335 7.34941499,27.4652707 Z M18.7118524,11.3165596 C21.3074367,12.8173162 22.1963355,16.1392758 20.6976522,18.738451 C19.1989689,21.3358459 15.8815987,22.2259744 13.2860143,20.726998 C10.6922077,19.2262414 9.80330893,15.9042818 11.3002144,13.3051066 C12.7988978,10.7059314 16.116268,9.81580294 18.7118524,11.3165596 Z M26.7821642,27.8093944 L30.1315348,31.1633985 C30.3982044,31.4304371 30.2097579,31.8844026 29.8346426,31.8844026 L21.5945511,31.8844026 C21.1287681,31.8844026 20.751875,31.5069881 20.751875,31.0405608 L20.751875,22.7890697 C20.751875,22.4134355 21.2052134,22.2247282 21.4701052,22.4899865 L24.2843587,25.3081333 C26.8337204,23.0240636 28.4444049,19.7092251 28.4444049,16.0223129 C28.4444049,9.15052091 22.8621207,3.56051397 15.9998222,3.56051397 L15.9998222,0 C24.8230314,0 32,7.18689745 32,16.0223129 C32,20.6919269 29.9750886,24.8790914 26.7821642,27.8093944 Z" id="Mask" fill="#8B889A"></path></g></svg><span>Learning Paths</span></a></li><li class="nav-offers flyout-parent"><a href="#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>offers icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M35.9 20.6L27 15.5C26.1 15 24.7 15 23.7 15.5L14.9 20.6C13.9 21.1 13.2 22.4 13.2 23.4L13.2 41.4C13.2 42.4 13.9 43.7 14.9 44.2L23.3 49C24.2 49.5 25.6 49.5 26.6 49L35.9 43.6C36.8 43.1 37.6 41.8 37.6 40.8L37.6 23.4C37.6 22.4 36.8 21.1 35.9 20.6L35.9 20.6ZM40 8.2C39.1 7.6 37.6 7.6 36.7 8.2L30.2 11.9C29.3 12.4 29.3 13.2 30.2 13.8L39.1 18.8C40 19.4 40.7 20.6 40.7 21.7L40.7 39C40.7 40.1 41.4 40.5 42.4 40L48.2 36.6C49.1 36.1 49.8 34.9 49.8 33.8L49.8 15.6C49.8 14.6 49.1 13.3 48.2 12.8L40 8.2 40 8.2ZM27 10.1L33.6 6.4C34.5 5.9 34.5 5 33.6 4.5L26.6 0.5C25.6 0 24.2 0 23.3 0.5L16.7 4.2C15.8 4.7 15.8 5.6 16.7 6.1L23.7 10.1C24.7 10.6 26.1 10.6 27 10.1ZM10.1 21.7C10.1 20.6 10.8 19.4 11.7 18.8L20.6 13.8C21.5 13.2 21.5 12.4 20.6 11.9L13.6 7.9C12.7 7.4 11.2 7.4 10.3 7.9L1.6 12.8C0.7 13.3 0 14.6 0 15.6L0 33.8C0 34.9 0.7 36.1 1.6 36.6L8.4 40.5C9.3 41 10.1 40.6 10.1 39.6L10.1 21.7 10.1 21.7Z"/></g></svg><span>Offers & Deals</span></a><ul class="flyout"><li><a href="/oreilly-conferences/" class="l2 nav-icn"><span>Conferences</span></a></li><li><a href="https://get.oreilly.com/email-signup.html" target="_blank" class="l2 nav-icn"><span>Newsletters</span></a></li></ul></li><li class="nav-highlights"><a href="/u/48b847cc-4100-401a-9732-d0a93f06ed1e/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" width="20" height="20" fill="#4A3C31"><path d="M13.325 18.071H8.036c0-6.736 4.324-10.925 14.464-12.477V0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35c5.142 0 9.175-3.515 9.175-8.816 0-4.628-2.367-7.293-6.253-8.113zm27.5 0h-5.26c0-6.736 4.295-10.925 14.435-12.477V0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35c5.113 0 9.146-3.515 9.146-8.816 0-4.628-2.338-7.293-6.253-8.113z" fill-rule="evenodd"/></svg><span>Highlights</span></a></li><li><a href="/u/preferences/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"/></g></svg><span>Settings</span></a></li><li><a href="https://www.oreilly.com/online-learning/support/" class="l1 no-icon">Support</a></li><li><a href="/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="/u/preferences/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"/></g></svg><span>Settings</span></a></li><li><a href="https://www.oreilly.com/online-learning/support/" class="l2">Support</a></li><li><a href="/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>



      </div>
      <div id="container" class="application">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Head First Design Patterns
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/0596007124/chapter/ch10.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards"></div></div></li><li class="js-font-control-panel font-control-activator"><a href="#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a
        class="twitter share-button t-twitter"
        target="_blank"
        aria-label="Share this section on Twitter"
        title="Share this section on Twitter"
      
        href="https://twitter.com/share?url=https://learning.oreilly.com/library/view/head-first-design/0596007124/ch10.html&text=Head%20First%20Design%20Patterns&via=safari"
      ><span>Twitter</span></a></li><li><a
        class="facebook share-button t-facebook"
        target="_blank"
        aria-label="Share this section on Facebook"
        title="Share this section on Facebook"
        href="https://www.facebook.com/sharer/sharer.php?u=https://learning.oreilly.com/library/view/head-first-design/0596007124/ch10.html"
      ><span>Facebook</span></a></li><li><a
        class="googleplus share-button t-googleplus"
        target="_blank"
        aria-label="Share this secton on Google Plus"
        title="Share this secton on Google Plus"
        href="https://plus.google.com/share?url=https://learning.oreilly.com/library/view/head-first-design/0596007124/ch10.html"
      ><span>Google Plus</span></a></li><li><a
        class="email share-button t-email"
        aria-label="Share this section via email"
        title="Share this section via email"
      
        href="mailto:?subject=Safari: 10.%20The%20State%20Pattern%3A%20The%20State%20of%20Things&body=https://learning.oreilly.com/library/view/head-first-design/0596007124/ch10.html%0D%0Afrom Head%20First%20Design%20Patterns%0D%0A"
      ><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    
    <section role="document">
        
        




  <script defer src="/static/js/build/djangoMessagesPage.9240133f6829.js"></script>


        
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="/library/view/head-first-design/0596007124/ch09.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">9. The Iterator and Composite Patterns: Well-Managed Collections</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="/library/view/head-first-design/0596007124/ch11.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">11. The Proxy Pattern: Controlling Object Access</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><section class="chapter" title="Chapter 10. The State Pattern: The State of Things" epub:type="chapter" id="state_pattern_the_state_of_things"><div class="titlepage"><div><div><h2 class="title">Chapter 10. The State Pattern: The State of Things</h2></div></div></div><div class="informalfigure"><a id="med_id00547a"></a><div class="mediaobject"><a id="med_id00547"></a><img src="/library/view/head-first-design/0596007124/figs/web/393fig01.png.jpg" alt="image with no caption" width="638" height="544"></div></div><p><span class="strong"><strong>A little-known fact: the Strategy and State Patterns were twins separated at birth.</strong></span> As you know, the Strategy Pattern went on to create a wildly successful business around interchangeable algorithms. State, however, took the perhaps more noble path of helping objects to control their behavior by changing their internal state. He’s often overheard telling his object clients, “Just repeat after me: I’m good enough, I’m smart enough, and doggonit...”</p><div class="sect1" title="Jawva Breakers"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="jawva_breakers">Ja<span class="strikethrough">w</span>va Breakers</h2></div></div></div><p><a id="iddle1689" class="indexterm"></a><a id="iddle2377" class="indexterm"></a>Java toasters are so ’90s. Today people are building Java into <span class="emphasis"><em>real</em></span> devices, like gumball machines. That’s right, gumball machines have gone high tech; the major manufacturers have found that by putting CPUs into their machines, they can increase sales, monitor inventory over the network and measure customer satisfaction more accurately.</p><div class="note" title="Note"><h3 class="title"><a id="ch10note01"></a>Note</h3><p>At least that’s their story – we think they just got bored with the circa 1800’s technology and needed to find a way to make their jobs more exciting.</p></div><p>But these manufacturers are gumball machine experts, not software developers, and they’ve asked for your help:</p><div class="informalfigure"><a id="med_id00548a"></a><div class="mediaobject"><a id="med_id00548"></a><img src="/library/view/head-first-design/0596007124/figs/web/394fig01.png.jpg" alt="image with no caption" width="101" height="168"></div></div><div class="informalfigure"><a id="med_id00549a"></a><div class="mediaobject"><a id="med_id00549"></a><img src="/library/view/head-first-design/0596007124/figs/web/394fig02.png.jpg" alt="image with no caption" width="770" height="610"></div></div></div><div class="sect1" title="Cubicle Conversation"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="cubicle_conversation-id00121">Cubicle Conversation</h2></div></div></div><div class="informalfigure"><a id="med_id00550a"></a><div class="mediaobject"><a id="med_id00550"></a><img src="/library/view/head-first-design/0596007124/figs/web/395fig01.png.jpg" alt="image with no caption" width="462" height="382"></div></div><p><span class="strong"><strong>Judy</strong></span>: This diagram looks like a state diagram.</p><p><span class="strong"><strong>Joe</strong></span>: Right, each of those circles is a state...</p><p><span class="strong"><strong>Judy</strong></span>: ... and each of the arrows is a state transition.</p><p><span class="strong"><strong>Frank</strong></span>: Slow down, you two, it’s been too long since I studied state diagrams. Can you remind me what they’re all about?</p><p><span class="strong"><strong>Judy</strong></span>: Sure, Frank. Look at the circles; those are states. “No Quarter” is probably the starting state for the gumball machine because it’s just sitting there waiting for you to put your quarter in. All states are just different configurations of the machine that behave in a certain way and need some action to take them to another state.</p><p><span class="strong"><strong>Joe</strong></span>: Right. See, to go to another state, you need to do something like put a quarter in the machine. See the arrow from “No Quarter” to “Has Quarter”?</p><p><span class="strong"><strong>Frank</strong></span>: Yes...</p><p><span class="strong"><strong>Joe</strong></span>: That just means that if the gumball machine is in the “No Quarter” state and you put a quarter in, it will change to the “Has Quarter” state. That’s the state transition.</p><p><span class="strong"><strong>Frank</strong></span>: Oh, I see! And if I’m in the “Has Quarter” state, I can turn the crank and change to the “Gumball Sold” state, or eject the quarter and change back to the “No Quarter” state.</p><p><span class="strong"><strong>Judy</strong></span>: You got it!</p><p><span class="strong"><strong>Frank</strong></span>: This doesn’t look too bad then. We’ve obviously got four states, and I think we also have four actions: “inserts quarter,” “ejects quarter,” “turns crank” and “dispense.” But... when we dispense, we test for zero or more gumballs in the “Gumball Sold” state, and then either go to the “Out of Gumballs” state or the “No Quarter” state. So we actually have five transitions from one state to another.</p><p><span class="strong"><strong>Judy</strong></span>: That test for zero or more gumballs also implies we’ve got to keep track of the number of gumballs too. Any time the machine gives you a gumball, it might be the last one, and if it is, we need to transition to the “Out of Gumballs” state.</p><p><span class="strong"><strong>Joe</strong></span>: Also, don’t forget that you could do nonsensical things, like try to eject the quarter when the gumball machine is in the “No Quarter” state, or insert two quarters.</p><p><span class="strong"><strong>Frank</strong></span>: Oh, I didn’t think of that; we’ll have to take care of those too.</p><p><span class="strong"><strong>Joe</strong></span>: For every possible action we’ll just have to check to see which state we’re in and act appropriately. We can do this! Let’s start mapping the state diagram to code...</p></div><div class="sect1" title="State machines 101"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="state_machines_101">State machines 101</h2></div></div></div><p><a id="iddle1692" class="indexterm"></a><a id="iddle1921" class="indexterm"></a><a id="iddle2371" class="indexterm"></a><a id="iddle2380" class="indexterm"></a><a id="iddle2387" class="indexterm"></a>How are we going to get from that state diagram to actual code? Here’s a quick introduction to implementing state machines:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>① First, gather up your states:</p><div class="informalfigure"><a id="med_id00551a"></a><div class="mediaobject"><a id="med_id00551"></a><img src="/library/view/head-first-design/0596007124/figs/web/396fig01.png.jpg" alt="image with no caption" width="537" height="124"></div></div></li><li class="listitem" style="list-style-type: none"><p>② Next, create an instance variable to hold the current state, and define values for each of the states:</p><div class="informalfigure"><a id="med_id00552a"></a><div class="mediaobject"><a id="med_id00552"></a><img src="/library/view/head-first-design/0596007124/figs/web/396fig02.png.jpg" alt="image with no caption" width="747" height="254"></div></div></li><li class="listitem" style="list-style-type: none"><p>③ Now we gather up all the actions that can happen in the system:</p><div class="informalfigure"><a id="med_id00553a"></a><div class="mediaobject"><a id="med_id00553"></a><img src="/library/view/head-first-design/0596007124/figs/web/396fig03.png.jpg" alt="image with no caption" width="590" height="226"></div></div></li><li class="listitem" style="list-style-type: none"><p>④ Now we create a class that acts as the state machine. For each action, we create a method that uses conditional statements to determine what behavior is appropriate in each state. For instance, for the insert quarter action, we might write a method like this:</p><div class="informalfigure"><a id="med_id00554a"></a><div class="mediaobject"><a id="med_id00554"></a><img src="/library/view/head-first-design/0596007124/figs/web/397fig01.png.jpg" alt="image with no caption" width="757" height="529"></div></div><div class="informalfigure"><a id="med_id00555a"></a><div class="mediaobject"><a id="med_id00555"></a><img src="/library/view/head-first-design/0596007124/figs/web/397fig02.png.jpg" alt="image with no caption" width="481" height="342"></div></div></li></ul></div><p>With that quick review, let’s go implement the Gumball Machine!</p></div><div class="sect1" title="Writing the code"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="writing_the_code">Writing the code</h2></div></div></div><p><a id="iddle1708" class="indexterm"></a><a id="iddle2385" class="indexterm"></a>It’s time to implement the Gumball Machine. We know we’re going to have an instance variable that holds the current state. From there, we just need to handle all the actions, behaviors and state transitions that can happen. For actions, we need to implement inserting a quarter, removing a quarter, turning the crank, and dispensing a gumball; we also have the empty Gumball Machine condition to implement.</p><div class="informalfigure"><a id="med_id00556a"></a><div class="mediaobject"><a id="med_id00556"></a><img src="/library/view/head-first-design/0596007124/figs/web/398fig01.png.jpg" alt="image with no caption" width="831" height="791"></div></div><div class="informalfigure"><a id="med_id00557a"></a><div class="mediaobject"><a id="med_id00557"></a><img src="/library/view/head-first-design/0596007124/figs/web/399fig01.png.jpg" alt="image with no caption" width="831" height="980"></div></div></div><div class="sect1" title="In-house testing"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="in-house_testing">In-house testing</h2></div></div></div><p><a id="iddle1707" class="indexterm"></a><a id="iddle2384" class="indexterm"></a>That feels like a nice solid design using a well-thought-out methodology, doesn’t it? Let’s do a little in-house testing before we hand it off to Mighty Gumball to be loaded into their actual gumball machines. Here’s our test harness:</p><div class="informalfigure"><a id="med_id00558a"></a><div class="mediaobject"><a id="med_id00558"></a><img src="/library/view/head-first-design/0596007124/figs/web/400fig01.png.jpg" alt="image with no caption" width="1000" height="550"></div></div></div><div class="sect1" title="You knew it was coming... a change request!"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="you_knew_it_was_cominghellip_a_change_re">You knew it was coming... a change request!</h2></div></div></div><p><a id="iddle1694" class="indexterm"></a><a id="iddle2065" class="indexterm"></a><a id="iddle2388" class="indexterm"></a><span class="strong"><strong>Mighty Gumball, Inc., has loaded your code into their newest machine and their quality assurance experts are putting it through its paces. So far, everything’s looking great from their perspective.</strong></span></p><p><span class="strong"><strong>In fact, things have gone so smoothly they’d like to take things to the next level...</strong></span></p><div class="informalfigure"><a id="med_id00559a"></a><div class="mediaobject"><a id="med_id00559"></a><img src="/library/view/head-first-design/0596007124/figs/web/402fig01.png.jpg" alt="image with no caption" width="749" height="582"></div></div><div class="sidebar"><a id="design_puzzle-id00122"></a><div class="sidebar-title">Design Puzzle</div><p><a id="iddle1432" class="indexterm"></a><a id="iddle1512" class="indexterm"></a><a id="iddle1698" class="indexterm"></a><a id="iddle2069" class="indexterm"></a><a id="iddle2392" class="indexterm"></a>Draw a state diagram for a Gumball Machine that handles the 1 in 10 contest. In this contest, 10% of the time the Sold state leads to two balls being released, not one. Check your answer with ours (at the end of the chapter) to make sure we agree before you go further...</p><div class="informalfigure"><a id="med_id00560a"></a><div class="mediaobject"><a id="med_id00560"></a><img src="/library/view/head-first-design/0596007124/figs/web/403fig01.png" alt="image with no caption" width="815" height="711"></div></div></div></div><div class="sect1" title="The messy STATE of things..."><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="messy_state_of_thingshellip">The messy STATE of things...</h2></div></div></div><p><a id="iddle1417" class="indexterm"></a><a id="iddle1535" class="indexterm"></a><a id="iddle1697" class="indexterm"></a><a id="iddle2068" class="indexterm"></a><a id="iddle2089" class="indexterm"></a><a id="iddle2274" class="indexterm"></a><a id="iddle2391" class="indexterm"></a>Just because you’ve written your gumball machine using a well-thought-out methodology doesn’t mean it’s going to be easy to extend. In fact, when you go back and look at your code and think about what you’ll have to do to modify it, well...</p><div class="informalfigure"><a id="med_id00561a"></a><div class="mediaobject"><a id="med_id00561"></a><img src="/library/view/head-first-design/0596007124/figs/web/404fig01.png.jpg" alt="image with no caption" width="702" height="451"></div></div><div class="sidebar"><a id="sharpen_your_pencil-id00123"></a><div class="sidebar-title">Sharpen your pencil</div><p>Which of the following describe the state of our implementation? (Choose all that apply.)</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"><col class="c2"><col class="c3"></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="inline_id00050"></a><img src="/library/view/head-first-design/0596007124/figs/web/square.png.jpg" alt="" width="17" height="17"></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>This code certainly isn’t adhering to the Open Closed Principle.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="inline_id00051"></a><img src="/library/view/head-first-design/0596007124/figs/web/square.png.jpg" alt="" width="17" height="17"></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>B.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>This code would make a FORTRAN programmer proud.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="inline_id00052"></a><img src="/library/view/head-first-design/0596007124/figs/web/square.png.jpg" alt="" width="17" height="17"></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>C.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>This design isn’t even very object-oriented.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="inline_id00053"></a><img src="/library/view/head-first-design/0596007124/figs/web/square.png.jpg" alt="" width="17" height="17"></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>State transitions aren’t explicit; they are buried in the middle of a bunch of conditional statements.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="inline_id00054"></a><img src="/library/view/head-first-design/0596007124/figs/web/square.png.jpg" alt="" width="17" height="17"></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>E.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We haven’t encapsulated anything that varies here.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="inline_id00055"></a><img src="/library/view/head-first-design/0596007124/figs/web/square.png.jpg" alt="" width="17" height="17"></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>F.</p></td><td style="vertical-align: top; "><p>Further additions are likely to cause bugs in working code.</p></td></tr></tbody></table></div></div><div class="informalfigure"><a id="med_id00562a"></a><div class="mediaobject"><a id="med_id00562"></a><img src="/library/view/head-first-design/0596007124/figs/web/405fig01.png.jpg" alt="image with no caption" width="558" height="462"></div></div><p><a id="iddle1409" class="indexterm"></a><a id="iddle1473" class="indexterm"></a><a id="iddle1676" class="indexterm"></a><span class="strong"><strong>Frank</strong></span>: You’re right about that! We need to refactor this code so that it’s easy to maintain and modify.</p><p><span class="strong"><strong>Judy</strong></span>: We really should try to localize the behavior for each state so that if we make changes to one state, we don’t run the risk of messing up the other code.</p><p><span class="strong"><strong>Frank</strong></span>: Right; in other words, follow that ol’ “encapsulate what varies” principle.</p><p><span class="strong"><strong>Judy</strong></span>: Exactly.</p><p><span class="strong"><strong>Frank</strong></span>: If we put each state’s behavior in its own class, then every state just implements its own actions.</p><p><span class="strong"><strong>Judy</strong></span>: Right. And maybe the Gumball Machine can just delegate to the state object that represents the current state.</p><p><span class="strong"><strong>Frank</strong></span>: Ah, you’re good: favor composition... more principles at work.</p><p><span class="strong"><strong>Judy</strong></span>: Cute. Well, I’m not 100% sure how this is going to work, but I think we’re on to something.</p><p><span class="strong"><strong>Frank</strong></span>: I wonder if this will make it easier to add new states?</p><p><span class="strong"><strong>Judy</strong></span>: I think so... We’ll still have to change code, but the changes will be much more limited in scope because adding a new state will mean we just have to add a new class and maybe change a few transitions here and there.</p><p><span class="strong"><strong>Frank</strong></span>: I like the sound of that. Let’s start hashing out this new design!</p></div><div class="sect1" title="The new design"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="new_design">The new design</h2></div></div></div><p><a id="iddle1703" class="indexterm"></a><a id="iddle2074" class="indexterm"></a><a id="iddle2397" class="indexterm"></a>It looks like we’ve got a new plan: instead of maintaining our existing code, we’re going to rework it to encapsulate state objects in their own classes and then delegate to the current state when an action occurs.</p><p>We’re following our design principles here, so we should end up with a design that is easier to maintain down the road. Here’s how we’re going to do it:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>① First, we’re going to define a State interface that contains a method for every action in the Gumball Machine.</strong></span></p></li><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>② Then we’re going to implement a State class for every state of the machine. These classes will be responsible for the behavior of the machine when it is in the corresponding state.</strong></span></p></li><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>③ Finally, we’re going to get rid of all of our conditional code and instead delegate to the State class to do the work for us.</strong></span></p></li></ul></div><p>Not only are we following design principles, as you’ll see, we’re actually implementing the State Pattern. But we’ll get to all the official State Pattern stuff after we rework our code...</p><div class="informalfigure"><a id="med_id00563a"></a><div class="mediaobject"><a id="med_id00563"></a><img src="/library/view/head-first-design/0596007124/figs/web/406fig01.png.jpg" alt="image with no caption" width="425" height="363"></div></div></div><div class="sect1" title="Defining the State interfaces and classes"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="defining_the_state_interfaces_and_classe">Defining the State interfaces and classes</h2></div></div></div><p><a id="iddle1122" class="indexterm"></a>First let’s create an interface for State, which all our states implement:</p><div class="informalfigure"><a id="med_id00564a"></a><div class="mediaobject"><a id="med_id00564"></a><img src="/library/view/head-first-design/0596007124/figs/web/407fig01.png.jpg" alt="image with no caption" width="998" height="1000"></div></div><p>Then take each state in our design and encapsulate it in a class that implements the State interface.</p><div class="sidebar"><a id="sharpen_your_pencil-id00124"></a><div class="sidebar-title">Sharpen your pencil</div><p><a id="iddle1527" class="indexterm"></a><a id="iddle1695" class="indexterm"></a><a id="iddle2066" class="indexterm"></a><a id="iddle2266" class="indexterm"></a><a id="iddle2389" class="indexterm"></a>To implement our states, we first need to specify the behavior of the classes when each action is called. Annotate the diagram below with the behavior of each action in each class; we’ve already filled in a few for you.</p><div class="informalfigure"><a id="med_id00565a"></a><div class="mediaobject"><a id="med_id00565"></a><img src="/library/view/head-first-design/0596007124/figs/web/408fig01.png.jpg" alt="image with no caption" width="887" height="1000"></div></div></div></div><div class="sect1" title="Implementing our State classes"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="implementing_our_state_classes">Implementing our State classes</h2></div></div></div><p><a id="iddle1123" class="indexterm"></a><a id="iddle1700" class="indexterm"></a><a id="iddle2071" class="indexterm"></a><a id="iddle2394" class="indexterm"></a>Time to implement a state: we know what behaviors we want; we just need to get it down in code. We’re going to closely follow the state machine code we wrote, but this time everything is broken out into different classes.</p><p>Let’s start with the NoQuarterState:</p><div class="informalfigure"><a id="med_id00566a"></a><div class="mediaobject"><a id="med_id00566"></a><img src="/library/view/head-first-design/0596007124/figs/web/409fig01.png.jpg" alt="image with no caption" width="809" height="566"></div></div><div class="informalfigure"><a id="med_id00567a"></a><div class="mediaobject"><a id="med_id00567"></a><img src="/library/view/head-first-design/0596007124/figs/web/409fig02.png.jpg" alt="image with no caption" width="422" height="276"></div></div></div><div class="sect1" title="Reworking the Gumball Machine"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="reworking_the_gumball_machine">Reworking the Gumball Machine</h2></div></div></div><p><a id="iddle1127" class="indexterm"></a><a id="iddle1704" class="indexterm"></a><a id="iddle2075" class="indexterm"></a><a id="iddle2398" class="indexterm"></a>Before we finish the State classes, we’re going to rework the Gumball Machine—that way you can see how it all fits together. We’ll start with the state-related instance variables and switch the code from using integers to using state objects:</p><div class="informalfigure"><a id="med_id00568a"></a><div class="mediaobject"><a id="med_id00568"></a><img src="/library/view/head-first-design/0596007124/figs/web/410fig01.png.jpg" alt="image with no caption" width="816" height="710"></div></div></div><div class="sect1" title="Now, let’s look at the complete GumballMachine class..."><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="nowcomma_letapostrophes_look_at_the_comp">Now, let’s look at the complete GumballMachine class...</h2></div></div></div><div class="informalfigure"><a id="med_id00569a"></a><div class="mediaobject"><a id="med_id00569"></a><img src="/library/view/head-first-design/0596007124/figs/web/411fig01.png.jpg" alt="image with no caption" width="786" height="913"></div></div></div><div class="sect1" title="Implementing more states"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="implementing_more_states">Implementing more states</h2></div></div></div><p><a id="iddle1124" class="indexterm"></a><a id="iddle1701" class="indexterm"></a><a id="iddle2072" class="indexterm"></a><a id="iddle2395" class="indexterm"></a>Now that you’re starting to get a feel for how the Gumball Machine and the states fit together, let’s implement the HasQuarterState and the SoldState classes...</p><div class="informalfigure"><a id="med_id00570a"></a><div class="mediaobject"><a id="med_id00570"></a><img src="/library/view/head-first-design/0596007124/figs/web/412fig01.png.jpg" alt="image with no caption" width="813" height="770"></div></div><p>Now, let’s check out the SoldState class...</p><div class="informalfigure"><a id="med_id00571a"></a><div class="mediaobject"><a id="med_id00571"></a><img src="/library/view/head-first-design/0596007124/figs/web/413fig01.png.jpg" alt="image with no caption" width="826" height="692"></div></div><div class="note" title="Brain Power"><h3 class="title"><a id="ch10note02"></a>Brain Power</h3><p>Look back at the GumballMachine implementation. If the crank is turned and not successful (say the customer didn’t insert a quarter first), we call dispense anyway, even though it’s unnecessary. How might you fix this?</p></div><div class="sidebar"><a id="sharpen_your_pencil-id00125"></a><div class="sidebar-title">Sharpen your pencil</div><p><a id="iddle1549" class="indexterm"></a><a id="iddle2291" class="indexterm"></a>We have one remaining class we haven’t implemented: SoldOutState. Why don’t you implement it? To do this, carefully think through how the Gumball Machine should behave in each situation. Check your answer before moving on...</p><a id="pro_id00037"></a><pre class="programlisting"><span class="strong"><strong>public class SoldOutState implements _______________ {</strong></span>
    <span class="strong"><strong>GumballMachine gumballMachine;</strong></span>

     <span class="strong"><strong>public SoldOutState(GumballMachine gumballMachine) {</strong></span>


     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public void insertQuarter() {</strong></span>



     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public void ejectQuarter() {</strong></span>


     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public void turnCrank() {</strong></span>




     <span class="strong"><strong>}</strong></span>


     <span class="strong"><strong>public void dispense() {</strong></span>




     <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre></div></div><div class="sect1" title="Let’s take a look at what we’ve done so far..."><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="letapostrophes_take_a_look_at_what_weapo">Let’s take a look at what we’ve done so far...</h2></div></div></div><p>For starters, you now have a Gumball Machine implementation that is <span class="emphasis"><em>structurally</em></span> quite different from your first version, and yet <span class="emphasis"><em>functionally it is exactly the same</em></span>. By structurally changing the implemention, you’ve:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Localized the behavior of each state into its own class.</p></li><li class="listitem"><p>Removed all the troublesome <code class="literal">if</code> statements that would have been difficult to maintain.</p></li><li class="listitem"><p>Closed each state for modification, and yet left the Gumball Machine open to extension by adding new state classes (and we’ll do this in a second).</p></li><li class="listitem"><p>Created a code base and class structure that maps much more closely to the Mighty Gumball diagram and is easier to read and understand.</p></li></ul></div><p>Now let’s look a little more at the functional aspect of what we did:</p><div class="informalfigure"><a id="med_id00572a"></a><div class="mediaobject"><a id="med_id00572"></a><img src="/library/view/head-first-design/0596007124/figs/web/415fig01.png.jpg" alt="image with no caption" width="640" height="615"></div></div><div class="informalfigure"><a id="med_id00573a"></a><div class="mediaobject"><a id="med_id00573"></a><img src="/library/view/head-first-design/0596007124/figs/web/416fig01.png.jpg" alt="image with no caption" width="755" height="966"></div></div><div class="sidebar"><a id="sharpen_your_pencil-id00126"></a><div class="sidebar-title">Sharpen your pencil</div><p><a id="iddle1525" class="indexterm"></a><a id="iddle2264" class="indexterm"></a><span class="strong"><strong>Behind the Scenes: Self-Guided Tour</strong></span></p><div class="informalfigure"><a id="med_id00574a"></a><div class="mediaobject"><a id="med_id00574"></a><img src="/library/view/head-first-design/0596007124/figs/web/common17.png.jpg" alt="image with no caption" width="105" height="95"></div></div><p>Trace the steps of the Gumball Machine starting with the NoQuarter state. Also annotate the diagram with actions and output of the machine. For this exercise you can assume there are plenty of gumballs in the machine.</p><div class="informalfigure"><a id="med_id00575a"></a><div class="mediaobject"><a id="med_id00575"></a><img src="/library/view/head-first-design/0596007124/figs/web/417fig01.png.jpg" alt="image with no caption" width="782" height="772"></div></div></div></div><div class="sect1" title="The State Pattern defined"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="state_pattern_defined">The State Pattern defined</h2></div></div></div><p><a id="iddle2372" class="indexterm"></a><a id="iddle2433" class="indexterm"></a>Yes, it’s true, we just implemented the State Pattern! So now, let’s take a look at what it’s all about:</p><div class="note" title="Note"><h3 class="title"><a id="ch10note03"></a>Note</h3><p><span class="strong"><strong>The State Pattern</strong></span> allows an object to alter its behavior when its internal state changes. The object will appear to change its class.</p></div><p>The first part of this description makes a lot of sense, right? Because the pattern encapsulates state into separate classes and delegates to the object representing the current state, we know that behavior changes along with the internal state. The Gumball Machine provides a good example: when the gumball machine is in the NoQuarterState and you insert a quarter, you get different behavior (the machine accepts the quarter) than if you insert a quarter when it’s in the HasQuarterState (the machine rejects the quarter).</p><p>What about the second part of the definition? What does it mean for an object to “appear to change its class”? Think about it from the perspective of a client: if an object you’re using can completely change its behavior, then it appears to you that the object is actually instantiated from another class. In reality, however, you know that we are using composition to give the appearance of a class change by simply referencing different state objects.</p><p>Okay, now it’s time to check out the State Pattern class diagram:</p><div class="informalfigure"><a id="med_id00576a"></a><div class="mediaobject"><a id="med_id00576"></a><img src="/library/view/head-first-design/0596007124/figs/web/418fig01.png.jpg" alt="image with no caption" width="877" height="544"></div></div><div class="informalfigure"><a id="med_id00577a"></a><div class="mediaobject"><a id="med_id00577"></a><img src="/library/view/head-first-design/0596007124/figs/web/419fig01.png.jpg" alt="image with no caption" width="363" height="424"></div></div><p><a id="iddle2401" class="indexterm"></a><a id="iddle2420" class="indexterm"></a>You’ve got a good eye! Yes, the class diagrams are essentially the same, but the two patterns differ in their <span class="emphasis"><em>intent</em></span>.</p><p>With the State Pattern, we have a set of behaviors encapsulated in state objects; at any time the context is delegating to one of those states. Over time, the current state changes across the set of state objects to reflect the internal state of the context, so the context’s behavior changes over time as well. The client usually knows very little, if anything, about the state objects.</p><p>With Strategy, the client usually specifies the strategy object that the context is composed with. Now, while the pattern provides the flexibility to change the strategy object at runtime, often there is a strategy object that is most appropriate for a context object. For instance, in <a class="xref" href="ch01.html" title="Chapter 1. Intro to Design Patterns: Welcome to Design Patterns">Chapter 1</a>, some of our ducks were configured to fly with typical flying behavior (like mallard ducks), while others were configured with a fly behavior that kept them grounded (like rubber ducks and decoy ducks).</p><p>In general, think of the Strategy Pattern as a flexible alternative to subclassing; if you use inheritance to define the behavior of a class, then you’re stuck with that behavior even if you need to change it. With Strategy you can change the behavior by composing with a different object.</p><p>Think of the State Pattern as an alternative to putting lots of conditionals in your context; by encapsulating the behaviors within state objects, you can simply change the state object in context to change its behavior.</p><div class="sidebar"><a id="there_are_no_dumb_questions-id00127"></a><div class="sidebar-title">There Are No Dumb Questions</div><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "><col></colgroup><tbody><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch10qa1qe1"></a><a id="ch10qa1q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><a id="iddle1126" class="indexterm"></a><a id="iddle1128" class="indexterm"></a><a id="iddle2021" class="indexterm"></a><a id="iddle2386" class="indexterm"></a><a id="iddle2399" class="indexterm"></a><a id="iddle2400" class="indexterm"></a><a id="iddle2403" class="indexterm"></a><span class="strong"><strong>Q: In the GumballMachine, the states decide what the next state should be. Do the ConcreteStates always decide what state to go to next?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch10qa1q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> No, not always. The alternative is to let the Context decide on the flow of state transitions.</p><p>As a general guideline, when the state transitions are fixed they are appropriate for putting in the Context; however, when the transitions are more dynamic, they are typically placed in the state classes themselves (for instance, in the GumballMachine the choice of the transition to NoQuarter or SoldOut depended on the runtime count of gumballs).</p><p>The disadvantage of having state transitions in the state classes is that we create dependencies between the state classes. In our implementation of the GumballMachine we tried to minimize this by using getter methods on the Context, rather than hardcoding explicit concrete state classes.</p><p>Notice that by making this decision, you are making a decision as to which classes are closed for modification— the Context or the state classes—as the system evolves.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch10qa1qe2"></a><a id="ch10qa1q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Do clients ever interact directly with the states?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch10qa1q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> No. The states are used by the Context to represent its internal state and behavior, so all requests to the states come from the Context. Clients don’t directly change the state of the Context. It is the Context’s job to oversee its state, and you don’t usually want a client changing the state of a Context without that Context’s knowledge.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch10qa1qe3"></a><a id="ch10qa1q3"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: If I have lots of instances of the Context in my application, is it possible to share the state objects across them?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch10qa1q3a3"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Yes, absolutely, and in fact this is a very common scenario. The only requirement is that your state objects do not keep their own internal context; otherwise, you’d need a unique instance per context.</p><p>To share your states, you’ll typically assign each state to a static instance variable. If your state needs to make use of methods or instance variables in your Context, you’ll also have to give it a reference to the Context in each handler() method.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch10qa1qe4"></a><a id="ch10qa1q4"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: It seems like using the State Pattern always increases the number of classes in our designs. Look how many more classes our GumballMachine had than the original design!</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch10qa1q4a4"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> You’re right, by encapsulating state behavior into separate state classes, you’ll always end up with more classes in your design. That’s often the price you pay for flexibility. Unless your code is some “one off” implementation you’re going to throw away (yeah, right), consider building it with the additional classes and you’ll probably thank yourself down the road. Note that often what is important is the number of classes that you expose to your clients, and there are ways to hide these extra classes from your clients (say, by declaring them package visible).</p><p>Also, consider the alternative: if you have an application that has a lot of state and you decide not to use separate objects, you’ll instead end up with very large, monolithic conditional statements. This makes your code hard to maintain and understand. By using objects, you make states explicit and reduce the effort needed to understand and maintain your code.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch10qa1qe5"></a><a id="ch10qa1q5"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: The State Pattern class diagram shows that State is an abstract class. But didn’t you use an interface in the implementation of the gumball machine’s state?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch10qa1q5a5"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Yes. Given we had no common functionality to put into an abstract class, we went with an interface. In your own implementation, you might want to consider an abstract class. Doing so has the benefit of allowing you to add methods to the abstract class later, without breaking the concrete state implementations.</p></td></tr></tbody></table></div></blockquote></div></div></div><div class="sect1" title="We still need to finish the Gumball 1 in 10 game"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="we_still_need_to_finish_the_gumball_1_in">We still need to finish the Gumball 1 in 10 game</h2></div></div></div><p><a id="iddle1125" class="indexterm"></a><a id="iddle1702" class="indexterm"></a><a id="iddle2073" class="indexterm"></a><a id="iddle2396" class="indexterm"></a>Remember, we’re not done yet. We’ve got a game to implement, but now that we’ve got the State Pattern implemented, it should be a breeze. First, we need to add a state to the GumballMachine class:</p><div class="informalfigure"><a id="med_id00578a"></a><div class="mediaobject"><a id="med_id00578"></a><img src="/library/view/head-first-design/0596007124/figs/web/421fig01.png.jpg" alt="image with no caption" width="576" height="257"></div></div><p>Now let’s implement the WinnerState class; it’s remarkably similar to the SoldState class:</p><div class="informalfigure"><a id="med_id00579a"></a><div class="mediaobject"><a id="med_id00579"></a><img src="/library/view/head-first-design/0596007124/figs/web/421fig02.png.jpg" alt="image with no caption" width="829" height="501"></div></div></div><div class="sect1" title="Finishing the game"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="finishing_the_game">Finishing the game</h2></div></div></div><p><a id="iddle1693" class="indexterm"></a><a id="iddle2381" class="indexterm"></a>We’ve just got one more change to make: we need to implement the random chance game and add a transition to the WinnerState. We’re going to add both to the HasQuarterState since that is where the customer turns the crank:</p><div class="informalfigure"><a id="med_id00580a"></a><div class="mediaobject"><a id="med_id00580"></a><img src="/library/view/head-first-design/0596007124/figs/web/422fig01.png.jpg" alt="image with no caption" width="793" height="746"></div></div><p>Wow, that was pretty simple to implement! We just added a new state to the GumballMachine and then implemented it. All we had to do from there was to implement our chance game and transition to the correct state. It looks like our new code strategy is paying off...</p></div><div class="sect1" title="Demo for the CEO of Mighty Gumball, Inc."><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="demo_for_the_ceo_of_mighty_gumballcomma">Demo for the CEO of Mighty Gumball, Inc.</h2></div></div></div><p><a id="iddle1691" class="indexterm"></a><a id="iddle2379" class="indexterm"></a>The CEO of Mighty Gumball has dropped by for a demo of your new gumball game code. Let’s hope those states are all in order! We’ll keep the demo short and sweet (the short attention span of CEOs is well documented), but hopefully long enough so that we’ll win at least once.</p><div class="informalfigure"><a id="med_id00581a"></a><div class="mediaobject"><a id="med_id00581"></a><img src="/library/view/head-first-design/0596007124/figs/web/423fig01.png.jpg" alt="image with no caption" width="767" height="604"></div></div><div class="informalfigure"><a id="med_id00582a"></a><div class="mediaobject"><a id="med_id00582"></a><img src="/library/view/head-first-design/0596007124/figs/web/423fig02.png.jpg" alt="image with no caption" width="526" height="323"></div></div><div class="informalfigure"><a id="med_id00583a"></a><div class="mediaobject"><a id="med_id00583"></a><img src="/library/view/head-first-design/0596007124/figs/web/424fig01.png.jpg" alt="image with no caption" width="828" height="644"></div></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00128"></a><div class="sidebar-title">There Are No Dumb Questions</div><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "><col></colgroup><tbody><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch10qa2qe1"></a><a id="ch10qa2q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><a id="iddle1706" class="indexterm"></a><a id="iddle2383" class="indexterm"></a><span class="strong"><strong>Q: Why do we need the WinnerState? Couldn’t we just have the SoldState dispense two gumballs?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch10qa2q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> That’s a great question. SoldState and WinnerState are almost identical, except that WinnerState dispenses two gumballs instead of one. You certainly could put the code to dispense two gumballs into the SoldState. The downside is, of course, that now you’ve got TWO states represented in one State class: the state in which you’re a winner, and the state in which you’re not. So you are sacrificing clarity in your State class to reduce code duplication. Another thing to consider is the principle you learned in the previous chapter: One class, One responsibility. By putting the WinnerState responsibility into the SoldState, you’ve just given the SoldState TWO responsibilities. What happens when the promotion ends? Or the stakes of the contest change? So, it’s a tradeoff and comes down to a design decision.</p></td></tr></tbody></table></div></blockquote></div></div><div class="informalfigure"><a id="med_id00584a"></a><div class="mediaobject"><a id="med_id00584"></a><img src="/library/view/head-first-design/0596007124/figs/web/425fig01.png.jpg" alt="image with no caption" width="481" height="357"></div></div></div><div class="sect1" title="Sanity check..."><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="sanity_checkhellip">Sanity check...</h2></div></div></div><p><a id="iddle1690" class="indexterm"></a><a id="iddle2378" class="indexterm"></a>Yes, the CEO of Mighty Gumball probably needs a sanity check, but that’s not what we’re talking about here. Let’s think through some aspects of the GumballMachine that we might want to shore up before we ship the gold version:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>We’ve got a lot of duplicate code in the Sold and Winning states and we might want to clean those up. How would we do it? We could make State into an abstract class and build in some default behavior for the methods; after all, error messages like, “You already inserted a quarter,” aren’t going to be seen by the customer. So all “error response” behavior could be generic and inherited from the abstract State class.</p><div class="note" title="Note"><h3 class="title"><a id="ch10note04"></a>Note</h3><p>Dammit Jim, I’m a gumball machine, not a computer!</p></div></li><li class="listitem"><p>The dispense() method always gets called, even if the crank is turned when there is no quarter. While the machine operates correctly and doesn’t dispense unless it’s in the right state, we could easily fix this by having turnCrank() return a boolean, or by introducing exceptions. Which do you think is a better solution?</p></li><li class="listitem"><p>All of the intelligence for the state transitions is in the State classes. What problems might this cause? Would we want to move that logic into the Gumball Machine? What would be the advantages and disadvantages of that?</p></li><li class="listitem"><p>Will you be instantiating a lot of GumballMachine objects? If so, you may want to move the state instances into static instance variables and share them. What changes would this require to the GumballMachine and the States?</p></li></ul></div><div class="sidebar"><a id="fireside_chats-id00129"></a><div class="sidebar-title"><code class="literal">Fireside Chats</code></div><p><a id="iddle2402" class="indexterm"></a><a id="iddle2421" class="indexterm"></a>Tonight’s talk: <span class="strong"><strong>A Strategy and State Pattern Reunion.</strong></span></p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Strategy:</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>State:</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Hey bro. Did you hear I was in <a class="xref" href="ch01.html" title="Chapter 1. Intro to Design Patterns: Welcome to Design Patterns">Chapter 1</a>?</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Yeah, word is definitely getting around.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>I was just over giving the Template Method guys a hand—they needed me to help them finish off their chapter. So, anyway, what is my noble brother up to?</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Same as always—helping classes to exhibit different behaviors in different states.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>I don’t know, you always sound like you’ve just copied what I do and you’re using different words to describe it. Think about it: I allow objects to incorporate different behaviors or algorithms through composition and delegation. You’re just copying me.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>I admit that what we do is definitely related, but my intent is totally different than yours. And, the way I teach my clients to use composition and delegation is totally different.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Oh yeah? How so? I don’t get it.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Well, if you spent a little more time thinking about something other than <span class="emphasis"><em>yourself</em></span>, you might. Anyway, think about how you work: you have a class you’re instantiating and you usually give it a strategy object that implements some behavior. Like, in <a class="xref" href="ch01.html" title="Chapter 1. Intro to Design Patterns: Welcome to Design Patterns">Chapter 1</a> you were handing out quack behaviors, right? Real ducks got a real quack; rubber ducks got a quack that squeaked.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Yeah, that was some <span class="emphasis"><em>fine</em></span> work... and I’m sure you can see how that’s more powerful than inheriting your behavior, right?</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Yes, of course. Now, think about how I work; it’s totally different.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Sorry, you’re going to have to explain that.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Okay, when my Context objects get created, I may tell them the state to start in, but then they change their own state over time.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Hey, come on, I can change behavior at runtime too; that’s what composition is all about!</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Sure you can, but the way I work is built around discrete states; my Context objects change state over time according to some well-defined state transitions. In other words, changing behavior is built in to my scheme—it’s how I work!</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Well, I admit, I don’t encourage my objects to have a well-defined set of transitions between states. In fact, I typically like to control what strategy my objects are using.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Look, we’ve already said we’re alike in structure, but what we do is quite different in intent. Face it, the world has uses for both of us.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Yeah, yeah, keep living your pipe dreams, brother. You act like you’re a big pattern like me, but check it out: I’m in <a class="xref" href="ch01.html" title="Chapter 1. Intro to Design Patterns: Welcome to Design Patterns">Chapter 1</a>; they stuck you way out in <a class="xref" href="ch10.html" title="Chapter 10. The State Pattern: The State of Things">Chapter 10</a>. I mean, how many people are actually going to read this far?</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Are you kidding? This is a Head First book and Head First readers rock. Of course they’re going to get to <a class="xref" href="ch10.html" title="Chapter 10. The State Pattern: The State of Things">Chapter 10</a>!</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>That’s my brother, always the dreamer.</p></td><td> </td></tr></tbody></table></div></div></div><div class="sect1" title="We almost forgot!"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="we_almost_forgotexclamation_mark">We almost forgot!</h2></div></div></div><div class="informalfigure"><a id="med_id00585a"></a><div class="mediaobject"><a id="med_id00585"></a><img src="/library/view/head-first-design/0596007124/figs/web/428fig01.png.jpg" alt="image with no caption" width="852" height="675"></div></div><div class="sidebar"><a id="sharpen_your_pencil-id00130"></a><div class="sidebar-title">Sharpen your pencil</div><p><a id="iddle1705" class="indexterm"></a><a id="iddle2382" class="indexterm"></a><a id="iddle1552" class="indexterm"></a><a id="iddle2297" class="indexterm"></a>We need you to write the refill() method for the Gumball machine. It has one argument—the number of gumballs you’re adding to the machine—and should update the gumball machine count and reset the machine’s state.</p></div><div class="informalfigure"><a id="med_id00586a"></a><div class="mediaobject"><a id="med_id00586"></a><img src="/library/view/head-first-design/0596007124/figs/web/429fig01.png.jpg" alt="image with no caption" width="423" height="358"></div></div><div class="sidebar"><a id="who_does_whatquestion_mark-id00131"></a><div class="sidebar-title">Who Does What?</div><p><a id="iddle1584" class="indexterm"></a><a id="iddle2373" class="indexterm"></a><a id="iddle2412" class="indexterm"></a><a id="iddle2462" class="indexterm"></a><a id="iddle2521" class="indexterm"></a>Match each pattern with its description:</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Pattern</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Description</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>State</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Encapsulate interchangeable behaviors and use delegation to decide which behavior to use.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Strategy</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Subclasses decide how to implement steps in an algorithm.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>Template Method</p></td><td style="vertical-align: top; "><p>Encapsulate state-based behavior and delegate behavior to the current state.</p></td></tr></tbody></table></div></div></div><div class="sect1" title="Tools for your Design Toolbox"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="tools_for_your_design_toolbox-id00132">Tools for your Design Toolbox</h2></div></div></div><p>It’s the end of another chapter; you’ve got enough patterns here to breeze through any job interview!</p><div class="informalfigure"><a id="med_id00587a"></a><div class="mediaobject"><a id="med_id00587"></a><img src="/library/view/head-first-design/0596007124/figs/web/431fig01.png.jpg" alt="image with no caption" width="586" height="875"></div></div><div class="sidebar"><a id="bullet_points-id00133"></a><div class="sidebar-title">Bullet Points</div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The State Pattern allows an object to have many different behaviors that are based on its internal state.</p></li><li class="listitem"><p>Unlike a procedural state machine, the State Pattern represents state as a full-blown class.</p></li><li class="listitem"><p>The Context gets its behavior by delegating to the current state object it is composed with.</p></li><li class="listitem"><p>By encapsulating each state into a class, we localize any changes that will need to be made.</p></li><li class="listitem"><p>The State and Strategy Patterns have the same class diagram, but they differ in intent.</p></li><li class="listitem"><p>Strategy Pattern typically configures Context classes with a behavior or algorithm.</p></li><li class="listitem"><p>State Pattern allows a Context to change its behavior as the state of the Context changes.</p></li><li class="listitem"><p>State transitions can be controlled by the State classes or by the Context classes.</p></li><li class="listitem"><p>Using the State Pattern will typically result in a greater number of classes in your design.</p></li><li class="listitem"><p>State classes may be shared among Context instances.</p></li></ul></div></div><div class="sidebar"><a id="design_puzzle_solution-id00134"></a><div class="sidebar-title">Design Puzzle Solution</div><p><a id="iddle1433" class="indexterm"></a><a id="iddle1513" class="indexterm"></a><a id="iddle1699" class="indexterm"></a><a id="iddle2070" class="indexterm"></a><a id="iddle2393" class="indexterm"></a>Draw a state diagram for a Gumball Machine that handles the 1-in-10 contest. In this contest, 10% of the time the Sold state leads to two balls being released, not one. Here’s our solution.</p><div class="informalfigure"><a id="med_id00588a"></a><div class="mediaobject"><a id="med_id00588"></a><img src="/library/view/head-first-design/0596007124/figs/web/432fig01.png.jpg" alt="image with no caption" width="849" height="661"></div></div></div><div class="sidebar"><a id="sharpen_your_pencil_solution-id00135"></a><div class="sidebar-title">Sharpen your pencil Solution</div><p><a id="iddle1536" class="indexterm"></a><a id="iddle1550" class="indexterm"></a><a id="iddle2275" class="indexterm"></a><a id="iddle2292" class="indexterm"></a>Which of the following describe the state of our implementation? (Choose all that apply.) Here’s our solution.</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"><col class="c2"><col class="c3"></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="inline_id00056"></a><img src="/library/view/head-first-design/0596007124/figs/web/433fig01.png.jpg" alt="" width="34" height="28"></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>This code certainly isn’t adhering to the Open Closed Principle.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="inline_id00057"></a><img src="/library/view/head-first-design/0596007124/figs/web/433fig02.png.jpg" alt="" width="27" height="23"></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>B.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>This code would make a FORTRAN programmer proud.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="inline_id00058"></a><img src="/library/view/head-first-design/0596007124/figs/web/433fig03.png.jpg" alt="" width="27" height="23"></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>C.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>This design isn’t even very object-oriented.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="inline_id00059"></a><img src="/library/view/head-first-design/0596007124/figs/web/433fig04.png.jpg" alt="" width="30" height="24"></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>State transitions aren’t explicit; they are buried in the middle of a bunch of conditional statements.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="inline_id00060"></a><img src="/library/view/head-first-design/0596007124/figs/web/433fig05.png.jpg" alt="" width="28" height="24"></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>E.</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>We haven’t encapsulated anything that varies here.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="inline_id00061"></a><img src="/library/view/head-first-design/0596007124/figs/web/433fig06.png.jpg" alt="" width="30" height="24"></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>F.</p></td><td style="vertical-align: top; "><p>Further additions are likely to cause bugs in working code.</p></td></tr></tbody></table></div></div><div class="sidebar"><a id="sharpen_your_pencil_solution-id00136"></a><div class="sidebar-title">Sharpen your pencil Solution</div><p>We have one remaining class we haven’t implemented: SoldOutState. Why don’t you implement it? To do this, carefully think through how the Gumball Machine should behave in each situation. Here’s our solution.</p><a id="pro_id00038"></a><pre class="programlisting"><span class="strong"><strong>public class SoldOutState implements State {</strong></span>
    <span class="strong"><strong>GumballMachine gumballMachine;</strong></span>

     <span class="strong"><strong>public SoldOutState(GumballMachine gumballMachine) {</strong></span>
         <span class="strong"><strong>this.gumballMachine = gumballMachine;</strong></span>
     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public void insertQuarter() {</strong></span>
         <span class="strong"><strong>System.out.println("You can't insert a quarter, the machine is sold out");</strong></span>
     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public void ejectQuarter() {</strong></span>
         <span class="strong"><strong>System.out.println("You can't eject, you haven't inserted a quarter yet");</strong></span>
     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public void turnCrank() {</strong></span>
         <span class="strong"><strong>System.out.println("You turned, but there are no gumballs");</strong></span>
     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public void dispense() {</strong></span>
         <span class="strong"><strong>System.out.println("No gumball dispensed");</strong></span>
     <span class="strong"><strong>}</strong></span>

     <span class="strong"><strong>public String toString() {</strong></span>
         <span class="strong"><strong>return "sold out";</strong></span>
     <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre><div class="note" title="Note"><h3 class="title"><a id="ch10note04a"></a>Note</h3><p>In the Sold Out state, we really can’t do anything until someone refills the Gumball Machine.</p></div></div><div class="sidebar"><a id="sharpen_your_pencil_solution-id00137"></a><div class="sidebar-title">Sharpen your pencil Solution</div><p><a id="iddle1528" class="indexterm"></a><a id="iddle1696" class="indexterm"></a><a id="iddle2067" class="indexterm"></a><a id="iddle2267" class="indexterm"></a><a id="iddle2390" class="indexterm"></a>To implement the states, we first need to define what the behavior will be when the corresponding action is called. Annotate the diagram below with the behavior of each action in each class; here’s our solution.</p><div class="informalfigure"><a id="med_id00589a"></a><div class="mediaobject"><a id="med_id00589"></a><img src="/library/view/head-first-design/0596007124/figs/web/434fig01.png.jpg" alt="image with no caption" width="792" height="986"></div></div></div><div class="sidebar"><a id="behind_the_scenes_self-guided_tour_solut"></a><div class="sidebar-title">Behind the Scenes: Self-Guided Tour Solution</div><div class="informalfigure"><a id="med_id00590a"></a><div class="mediaobject"><a id="med_id00590"></a><img src="/library/view/head-first-design/0596007124/figs/web/435fig01.png.jpg" alt="image with no caption" width="946" height="1000"></div></div></div><div class="sidebar"><a id="who_does_whatquestion_mark_solut-id00138"></a><div class="sidebar-title">Who Does What? Solution</div><p><a id="iddle1526" class="indexterm"></a><a id="iddle2265" class="indexterm"></a><a id="iddle1553" class="indexterm"></a><a id="iddle1585" class="indexterm"></a><a id="iddle2298" class="indexterm"></a><a id="iddle2374" class="indexterm"></a><a id="iddle2413" class="indexterm"></a><a id="iddle2463" class="indexterm"></a><a id="iddle2522" class="indexterm"></a>Match each pattern with its description:</p><div class="informalfigure"><a id="med_id00591a"></a><div class="mediaobject"><a id="med_id00591"></a><img src="/library/view/head-first-design/0596007124/figs/web/436fig01.png.jpg" alt="image with no caption" width="570" height="380"></div></div></div><div class="sidebar"><a id="sharpen_your_pencil_solution-id00139"></a><div class="sidebar-title">Sharpen your pencil Solution</div><p>To refill the Gumball Machine, we add a refill() method to the State interface, which each State must implement. In every state except the SoldOutState, the method does nothing. In SoldOutState, refill() transitions to NoQuarterState. We also add a refill() method to GumballMachine that adds to the count of gumballs, and then calls the current state’s refill() method.</p><div class="informalfigure"><a id="med_id00592a"></a><div class="mediaobject"><a id="med_id00592"></a><img src="/library/view/head-first-design/0596007124/figs/web/436fig02.png.jpg" alt="image with no caption" width="802" height="209"></div></div></div></div></section></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="/library/view/head-first-design/0596007124/ch09.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">9. The Iterator and Composite Patterns: Well-Managed Collections</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="/library/view/head-first-design/0596007124/ch11.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">11. The Proxy Pattern: Controlling Object Access</div>
        </a>
    
  
  </div>


        
    </section>
  </div>
<section class="sbo-saved-archives"></section>

<script>
  window.dataLayer = window.dataLayer || [];
  context = {
    product: {
      title: 'Head First Design Patterns',
      type: 'book',
      identifier: '0596007124',
      topic: 'Design Patterns'
    },
    content: {
      title: 'Head First Design Patterns',
      formatType: 'book',
      identifier: '0596007124',
      author: 'Kathy Sierra, Bert Bates, Elisabeth Robson, Eric Freeman',
      publisher: 'O&#39;Reilly Media, Inc.',
      releaseDate: '2004-10-25',
      parentTopic: 'none',
      free: 'no',
      subdirectory: 'none'
    }
  }
  dataLayer.push(context);
</script>



          
          
  




    
    



        
      </div>
      
        



  <footer class="pagefoot t-pagefoot">
    <a href="#" class="icon-up"><div class="visuallyhidden">Back to top</div></a>
    <ul class='js-footer-nav'>
      
        <li><a class="t-resource-centers-footer" href="/resource-centers/">Resource Centers</a></li>
      
      <li>
      <a class="t-queue-footer" href="/playlists/">Playlists</a>
      </li>
      
        <li><a class="t-recent-footer" href="/history/">History</a></li>
        <li><a class="t-topics-footer" href="/topics?q=*&limit=21">Topics</a></li>
      
      <li><a class="t-settings-footer js-settings" href="/u/preferences/">Settings</a></li>
      <li class="full-support"><a href="https://www.oreilly.com/online-learning/support/">Support</a></li>
      <li><a href="https://www.oreilly.com/online-learning/apps.html">Get the App</a></li>
      <li><a href="/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">&#169; 2019 <a href="/" target="_blank">Safari</a>.</span>
    <a href="/terms/">Terms of Service</a> /
    <a href="https://www.oreilly.com/privacy.html">Privacy Policy</a>
  </footer>

<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"transactionName":"YgdaZ0NSW0cEB0RdWltNfkZfUEFdCgofXFBHDVYdR1pQQxZeRl1QQj1aWkU=","agent":"","beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","applicationTime":6912,"licenseKey":"510f1a6865","applicationID":"172641827,79672898,93931619","queueTime":2}</script>


      
    
    <script src="/jsi18n/web/" charset="utf-8"></script>
    <script src="/library/jsi18n/appcache/" charset="utf-8"></script>
  </body>
</html>
