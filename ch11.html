<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/head-first-design/0596007124/ch11.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy="public"


  data-user-id="2198516"
  data-user-uuid="48b847cc-4100-401a-9732-d0a93f06ed1e"
  data-username="Evan_l00"
  data-account-type="B2B"
  
  data-activated-trial-date=""


  data-archive="0596007124"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch11.html"
  data-epub-title="Head First Design Patterns" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/head-first-design/0596007124/ch11.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy="public"


  data-user-id="2198516"
  data-user-uuid="48b847cc-4100-401a-9732-d0a93f06ed1e"
  data-username="Evan_l00"
  data-account-type="B2B"
  
  data-activated-trial-date=""


  data-archive="0596007124"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch11.html"
  data-epub-title="Head First Design Patterns" data-debug=0 data-testing=0><!--<![endif]--><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="author" content="Safari Books Online" /><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"/><meta name="HandheldFriendly" content="True"/><meta name="MobileOptimized" content="320"/><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://0596007124"/><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"/><meta property="twitter:account_id" content="4503599627559754" /><script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,n,t){function r(t){if(!n[t]){var o=n[t]={exports:{}};e[t][0].call(o.exports,function(n){var o=e[t][1][n];return r(o||n)},o,o.exports)}return n[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<t.length;o++)r(t[o]);return r}({1:[function(e,n,t){function r(){}function o(e,n,t){return function(){return i(e,[c.now()].concat(u(arguments)),n?null:this,t),n?void 0:this}}var i=e("handle"),a=e(3),u=e(4),f=e("ee").get("tracer"),c=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(e,n){s[n]=o(d+n,!0,"api")}),s.addPageAction=o(d+"addPageAction",!0),s.setCurrentRouteName=o(d+"routeName",!0),n.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,n){var t={},r=this,o="function"==typeof n;return i(l+"tracer",[c.now(),e,t],r),function(){if(f.emit((o?"":"no-")+"fn-start",[c.now(),r,o],t),o)try{return n.apply(this,arguments)}catch(e){throw f.emit("fn-err",[arguments,this,e],t),e}finally{f.emit("fn-end",[c.now()],t)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,n){m[n]=o(l+n)}),newrelic.noticeError=function(e,n){"string"==typeof e&&(e=new Error(e)),i("err",[e,c.now(),!1,n])}},{}],2:[function(e,n,t){function r(e,n){if(!o)return!1;if(e!==o)return!1;if(!n)return!0;if(!i)return!1;for(var t=i.split("."),r=n.split("."),a=0;a<r.length;a++)if(r[a]!==t[a])return!1;return!0}var o=null,i=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var u=navigator.userAgent,f=u.match(a);f&&u.indexOf("Chrome")===-1&&u.indexOf("Chromium")===-1&&(o="Safari",i=f[1])}n.exports={agent:o,version:i,match:r}},{}],3:[function(e,n,t){function r(e,n){var t=[],r="",i=0;for(r in e)o.call(e,r)&&(t[i]=n(r,e[r]),i+=1);return t}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],4:[function(e,n,t){function r(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(o<0?0:o);++r<o;)i[r]=e[n+r];return i}n.exports=r},{}],5:[function(e,n,t){n.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,n,t){function r(){}function o(e){function n(e){return e&&e instanceof r?e:e?f(e,u,i):i()}function t(t,r,o,i){if(!d.aborted||i){e&&e(t,r,o);for(var a=n(o),u=v(t),f=u.length,c=0;c<f;c++)u[c].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(e,n){h[e]=v(e).concat(n)}function m(e,n){var t=h[e];if(t)for(var r=0;r<t.length;r++)t[r]===n&&t.splice(r,1)}function v(e){return h[e]||[]}function g(e){return p[e]=p[e]||o(t)}function w(e,n){c(e,function(e,t){n=n||"feature",y[t]=n,n in s||(s[n]=[])})}var h={},y={},b={on:l,addEventListener:l,removeEventListener:m,emit:t,get:g,listeners:v,context:n,buffer:w,abort:a,aborted:!1};return b}function i(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var u="nr@context",f=e("gos"),c=e(3),s={},p={},d=n.exports=o();d.backlog=s},{}],gos:[function(e,n,t){function r(e,n,t){if(o.call(e,n))return e[n];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,n,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[n]=r,r}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],handle:[function(e,n,t){function r(e,n,t,r){o.buffer([e],r),o.emit(e,n,t)}var o=e("ee").get("handle");n.exports=r,r.ee=o},{}],id:[function(e,n,t){function r(e){var n=typeof e;return!e||"object"!==n&&"function"!==n?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");n.exports=r},{}],loader:[function(e,n,t){function r(){if(!E++){var e=x.info=NREUM.info,n=l.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&n))return s.abort();c(y,function(n,t){e[n]||(e[n]=t)}),f("mark",["onload",a()+x.offset],null,"api");var t=l.createElement("script");t.src="https://"+e.agent,n.parentNode.insertBefore(t,n)}}function o(){"complete"===l.readyState&&i()}function i(){f("mark",["domContent",a()+x.offset],null,"api")}function a(){return O.exists&&performance.now?Math.round(performance.now()):(u=Math.max((new Date).getTime(),u))-x.offset}var u=(new Date).getTime(),f=e("handle"),c=e(3),s=e("ee"),p=e(2),d=window,l=d.document,m="addEventListener",v="attachEvent",g=d.XMLHttpRequest,w=g&&g.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:g,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var h=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1130.min.js"},b=g&&w&&w[m]&&!/CriOS/.test(navigator.userAgent),x=n.exports={offset:u,now:a,origin:h,features:{},xhrWrappable:b,userAgent:p};e(1),l[m]?(l[m]("DOMContentLoaded",i,!1),d[m]("load",r,!1)):(l[v]("onreadystatechange",o),d[v]("onload",r)),f("mark",["firstbyte",u],null,"api");var E=0,O=e(5)},{}]},{},["loader"]);</script><link rel="apple-touch-icon" href="/static/images/apple-touch-icon.0c29511d2d72.png"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic' rel='stylesheet' type='text/css'><title>11. The Proxy Pattern: Controlling Object Access - Head First Design Patterns</title><link rel="stylesheet" href="/static/CACHE/css/output.68851547a55f.css" type="text/css" /><link rel="stylesheet" type="text/css" href="/static/css/annotator.e3b0c44298fc.css"/><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book">
    @charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content font,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}@page{margin:5px !important}#sbo-rt-content p{margin:8px 0 0;line-height:125%;text-align:left}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link{text-decoration:none;color:#8e0012}#sbo-rt-content sup{font-size:x-small;vertical-align:super}#sbo-rt-content sub{font-size:smaller;vertical-align:sub}#sbo-rt-content span.lineannotation{font-style:italic;color:#A62A2A;font-family:serif,"DejaVuSerif"}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#FFF}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content h1,#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important}#sbo-rt-content h2{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content h3{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content h4{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content h5{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section.chapter div.titlepage,#sbo-rt-content section.appendix div.titlepage,#sbo-rt-content section.preface div.titlepage{page-break-inside:avoid;page-break-after:avoid}#sbo-rt-content section.chapter>div.titlepage,#sbo-rt-content section.preface>div.titlepage,#sbo-rt-content section.appendix>div.titlepage{margin-bottom:50px}#sbo-rt-content section.chapter>div.titlepage h2.title,#sbo-rt-content section.preface>div.titlepage h2.title,#sbo-rt-content section.appendix>div.titlepage h2.title{font-size:2em;line-height:1;margin-bottom:15px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content div.toc-title{margin-bottom:30px !important}#sbo-rt-content div.part h1{font-size:2em;text-align:center;margin-top:0 !important;padding:50px 0 20px 0;border-bottom:1px solid #000}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center;-webkit-border-radius:5px;border-radius:5px;border:1px solid #DCDCDC;padding:15px 5px 15px 5px !important;margin:30px 0 30px 0 !important;max-height:100%;page-break-inside:avoid}#sbo-rt-content div.figure-title,#sbo-rt-content div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.informalfigure{text-align:center;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:30px 0 20px 0 !important;-webkit-border-radius:5px;border-radius:5px;border:1px solid #DCDCDC;background-color:#F7F7F7;font-size:90%;padding:15px !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title{font-weight:bold;font-size:1em;font-family:sans-serif,"DejaVuSans";text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar ol{margin-left:15px}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div.caution,#sbo-rt-content div.sidebar div.important{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content div.sidebar div.figure{border:none}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div.example{margin:10px 0 15px 0 !important}#sbo-rt-content div.example-title{font-style:italic;font-weight:normal;font-family:serif,"DejaVuSerif";margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div.example-contents pre.programlisting,#sbo-rt-content div.example-contents pre.screen{margin:0}#sbo-rt-content span.gray{color:#4C4C4C}#sbo-rt-content div.book div.titlepage h1.title{font-size:3em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content div.book div.titlepage h2.subtitle{text-align:center;color:#000;margin:0 !important;font-style:italic;font-family:serif;font-size:1.5em}#sbo-rt-content div.book div.titlepage div.author h3{font-size:2em;font-family:sans-serif,"DejaVuSans";font-weight:bold;color:#8e0012;margin:50px 0 !important;text-align:center}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif,"DejaVuSerif";font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif,"DejaVuSerif";margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10pt}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-family:serif,"DejaVuSerif";font-style:italic}#sbo-rt-content blockquote div.attribution{margin:5px 0 0 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p{font-style:normal}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div.footnote{font-size:90%}#sbo-rt-content div.refnamediv h2,#sbo-rt-content div.refnamediv h3,#sbo-rt-content div.refsynopsisdiv h2{font-size:1.1em;color:#000;margin-top:15px !important;margin-bottom:0 !important}#sbo-rt-content div.refentry div.refsect1 h2{font-size:1.1em;color:#000;margin-top:15px !important;margin-bottom:0 !important}#sbo-rt-content div.refsect2 h3{font-size:1em;color:#000;margin-top:10px !important;margin-bottom:0 !important}#sbo-rt-content div.refnamediv p{margin-left:15px !important}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dt span.term{font-weight:bold;font-style:italic}#sbo-rt-content dt span.term code.literal{font-style:normal;font-weight:normal}#sbo-rt-content dt span.term em code.literal{font-style:italic}#sbo-rt-content dd{margin-left:1.5em !important}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ol{list-style-type:decimal;margin-top:8px !important;margin-bottom:8px !important;margin-left:20px !important;padding-left:25px !important}#sbo-rt-content ol[type="A"]{list-style-type:upper-alpha}#sbo-rt-content ol[type="I"]{list-style-type:upper-roman}#sbo-rt-content ol[type="a"]{list-style-type:lower-alpha}#sbo-rt-content ol[type="i"]{list-style-type:lower-roman}#sbo-rt-content ol ol{list-style-type:lower-alpha}#sbo-rt-content ol ol ol{list-style-type:lower-roman}#sbo-rt-content ul{list-style-type:square;margin-top:8px !important;margin-bottom:8px !important;margin-left:5px !important;padding-left:20px !important}#sbo-rt-content ul ul{list-style-type:none;padding-left:0 !important;margin-left:0 !important}#sbo-rt-content ol li,#sbo-rt-content ul li,#sbo-rt-content dd{margin-bottom:1em}#sbo-rt-content ul ul li p:before{content:"— "}#sbo-rt-content ul ul ul li p:before{content:""}#sbo-rt-content ul ul ul{list-style-type:square;margin-left:20px !important;padding-left:30px !important}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist{margin-left:20px !important;margin-bottom:10px}#sbo-rt-content table.simplelist td{border:none;font-size:90%}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content div.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content div.calloutlist img{padding:0}#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.calloutlist>dl>dd>div.orderedlist{margin-top:25pt}#sbo-rt-content div.calloutlist>dl>dd>div.orderedlist>ol.orderedlist>li{margin-bottom:25pt}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div.note,#sbo-rt-content div.warning,#sbo-rt-content div.caution,#sbo-rt-content div.important{margin:30px !important;-webkit-border-radius:5px;border-radius:5px;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip,#sbo-rt-content div.note,#sbo-rt-content div.important{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div.caution{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div.note h3,#sbo-rt-content div.warning h3,#sbo-rt-content div.caution h3,#sbo-rt-content div.important h3{font:bold 90%;font-family:sans-serif,"DejaVuSans";text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div.tip h3,#sbo-rt-content div.note h3,#sbo-rt-content div.important h3{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div.caution h3{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;-webkit-border-radius:0;border-radius:0;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px auto 30px auto !important;max-width:95%;border-collapse:collapse;border-spacing:0}#sbo-rt-content div.table,#sbo-rt-content div.informaltable{page-break-inside:avoid}#sbo-rt-content tr{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif,"DejaVuSans";color:#000;font-weight:bold}#sbo-rt-content td{padding:.3em;text-align:left;vertical-align:baseline;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title{font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";margin:20px 0 0 0 !important;text-align:center;padding:0}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content div.equation{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title{font-style:italic;font-weight:normal;font-family:serif,"DejaVuSerif";margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{font-weight:bold}#sbo-rt-content div.index dt{line-height:140%}#sbo-rt-content div.index a.indexterm{color:#8e0012}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif,"DejaVuSerif";text-align:left}
    </style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/0596007124/chapter/ch11.html",
          "book_id": "0596007124",
          "chapter_uri": "ch11.html",
          "position": 0,
          "user_uuid": "48b847cc-4100-401a-9732-d0a93f06ed1e",
          "next_chapter_uri": "/library/view/head-first-design/0596007124/ch12.html"
        
      },
      title: "Head First Design Patterns",
      author_list: "Kathy Sierra, Bert Bates, Elisabeth Robson, Eric Freeman",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false
    };
    // ]]></script><script src="/static/js/src/modernizr.8e35451ddb64.js"></script><script>
    
      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

      window.PRIVACY_CONTROL_SWITCH = true;

      window.PUBLISHER_PAGES = true;

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://learning.oreilly.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://learning.oreilly.com/library/view/head-first-design/0596007124/ch11.html"/><meta name="description" content="Chapter 11. The Proxy Pattern: Controlling Object Access Ever play good cop, bad cop? You’re the good cop and you provide all your services in a nice and friendly manner, but you ... "><meta property="og:title" content="11. The Proxy Pattern: Controlling Object Access" /><meta itemprop="isPartOf" content="/library/view/head-first-design/0596007124/" /><meta itemprop="name" content="11. The Proxy Pattern: Controlling Object Access" /><meta property="og:url" itemprop="url" content="https://learning.oreilly.com/library/view/head-first-design/0596007124/ch11.html" /><meta property="og:site_name" content="Safari" /><meta property="og:image" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/0596007124/" /><meta property="og:description" itemprop="description" content="Chapter 11. The Proxy Pattern: Controlling Object Access Ever play good cop, bad cop? You’re the good cop and you provide all your services in a nice and friendly manner, but you ... "><meta itemprop="inLanguage" content="en" /><meta itemprop="publisher" content="O&#39;Reilly Media, Inc." /><meta property="og:type" content="book" /><meta property="og:book:isbn" itemprop="isbn" content="9780596007126" /><meta property="og:book:author" itemprop="author" content="Kathy Sierra" /><meta property="og:book:author" itemprop="author" content="Bert Bates" /><meta property="og:book:author" itemprop="author" content="Elisabeth Robson" /><meta property="og:book:author" itemprop="author" content="Eric Freeman" /><meta property="og:book:tag" itemprop="about" content="Core Programming" /><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script type="text/javascript">
    (function(i,s,o,g,r,a,m) {
      i['GoogleAnalyticsObject']=r;
      i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();
      a=s.createElement(o),m=s.getElementsByTagName(o)[0];
      a.async=1;
      a.src=g;
      m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    var matches = document.cookie.match(/BrowserCookie\s*=\s*([a-f0-9\-]{36})/),
      user_uuid = null;

    if (matches && matches.length === 2) {
      user_uuid = matches[1];
    }

  
    ga('create', 'UA-39299553-7', {'userId': '48b847cc-4100-401a-9732-d0a93f06ed1e' });
  

  
    
      ga('set', 'dimension1', 'B2B');
    
  

  ga('set', 'dimension6', user_uuid);

  
    ga('set', 'dimension2', '48b847cc-4100-401a-9732-d0a93f06ed1e');
    
      ga('set', 'dimension7', '0014100001N37poAAB');
    
  

  

  

  //enable enhanced link tracking
  ga('require', 'linkid', 'linkid.js');

  // reading interface will track pageviews itself
  if (document.location.pathname.indexOf("/library/view") !== 0) {
    ga('send', 'pageview');
  }
  </script><script>
    var dataLayer = window.dataLayer || [];

    
      window.medalliaVsgUserIdentifier = '48b847cc-4100-401a-9732-d0a93f06ed1e';
      dataLayer.push({userIdentifier: '48b847cc-4100-401a-9732-d0a93f06ed1e'});
      dataLayer.push({loggedIn: 'yes'});

      
        window.medalliaVsgAccountIdentifier = '555c1d98-46da-46de-8ca0-0032dbcc46d2';
        
        dataLayer.push({orgID: '555c1d98-46da-46de-8ca0-0032dbcc46d2'});
        

        window.medalliaVsgIsIndividual = false;
        
          
          dataLayer.push({learningAccountType: 'enterprise'});
          
        

        
          dataLayer.push({learningPaidAccount: 'yes'});
        
      
    

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
    (function () {
      var VERSION = 'V1.1';
      var AUTHOR = 'Awwad';
      if (!window.GtmHelper)
        window.GtmHelper = function () {
          var instance = this;
          var loc = document.location;
          this.version = VERSION;
          this.author = AUTHOR;
          this.readCookie = function (name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
          };
          this.createCookie = function (name, value, days, cookieDomain) {
            var domain = "";
            var expires = "";

            if (days) {
              var date = new Date();
              date.setTime(date.getTime() + Math.ceil(days * 24 * 60 * 60 * 1000));
              var expires = " expires=" + date.toGMTString() + ";";
            }

            if (typeof (cookieDomain) != 'undefined')
              domain = " domain=" + cookieDomain + "; ";

            document.cookie = name + "=" + value + ";" + expires + domain + "path=/";
          };

          this.isDuplicated = function (currentTransactionId) {
            // the previous transaction id:
            var previousTransIdValue = this.readCookie("previousTransId");

            if (currentTransactionId === previousTransIdValue) {
              return true; // Duplication
            } else {
              return false;
            }
          };
        }
    })()
  </script><script defer src="/static/js/build/vendor.75d9ef59282e.js"></script><script defer src="/static/js/build/reader.acee09dc84ba.js"></script></head>


<body class="reading sidenav nav-collapsed  scalefonts">

    
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        





<a href="#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.738 14H9.254v-3.676a.617.617 0 0 0-.621-.613H7.39a.617.617 0 0 0-.62.613V14H4.284a.617.617 0 0 1-.622-.613V10.22c0-.327.132-.64.367-.87l3.547-3.493a.627.627 0 0 1 .875 0l3.54 3.499c.234.229.366.54.367.864v3.167a.617.617 0 0 1-.62.613zM7.57 2.181a.625.625 0 0 1 .882 0l5.77 5.692-.93.92-5.28-5.209-5.28 5.208-.932-.919 5.77-5.692z" /></svg><span>Safari Home</span></a></li><li><a href="/resource-centers/" class="t-resource-centers-nav l0 nav-icn"><?xml version="1.0" encoding="UTF-8"?><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Topic-Page-Design" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Heron-Button" transform="translate(-20.000000, -78.000000)" fill="#4A3A30"><g id="Group-9" transform="translate(20.000000, 78.000000)"><rect id="Rectangle" x="9.6" y="0" width="6.4" height="6.4" rx="0.503118"></rect><rect id="Rectangle" x="9.6" y="9.6" width="6.4" height="6.4" rx="0.503118"></rect><rect id="Rectangle" x="0" y="9.6" width="6.4" height="6.4" rx="0.503118"></rect></g></g></g></svg><span>Resource Centers</span></a></li><li><a href="/playlists/" class="t-queue-nav l0 nav-icn None"><?xml version="1.0" encoding="UTF-8"?><svg width="21px" height="17px" viewBox="0 0 21 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- Generator: Sketch 46.2 (44496) - http://www.bohemiancoding.com/sketch --><title>icon_Playlist_sml</title><desc>Created with Sketch.</desc><defs></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="icon_Playlist_sml" fill-rule="nonzero" fill="#000000"><g id="playlist-icon"><g id="Group-6"><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle></g><g id="Group-5" transform="translate(0.000000, 7.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g><g id="Group-5-Copy" transform="translate(0.000000, 14.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g></g></g></g></svg><span>
               Playlists
            </span></a></li><li class="search"><a href="#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"/></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"/></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z"/></g></svg><span>History</span></a></li><li><a href="/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" width="20" height="20" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z"/></g></svg><span>Topics</span></a></li><li><a href="/learning-paths/" class="l1 nav-icn t-learningpaths-nav js-toggle-menu-item"><?xml version="1.0" encoding="UTF-8"?><svg width="32px" height="32px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- Generator: Sketch 52.5 (67469) - http://www.bohemiancoding.com/sketch --><title>Mask</title><desc>Created with Sketch.</desc><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M0,16.0214227 C0,15.0387209 0.796453294,14.2411658 1.77779753,14.2411658 C2.75914177,14.2411658 3.55559506,15.0387209 3.55559506,16.0214227 C3.55559506,17.0041246 2.75914177,17.8016797 1.77779753,17.8016797 C0.796453294,17.8016797 0,17.0041246 0,16.0214227 Z M9.77788642,5.22914885 C8.9280992,5.72049977 7.84008711,5.42853763 7.34941499,4.57757479 C6.85874287,3.72661195 7.15030167,2.63709467 8.00008889,2.14574375 C8.84987611,1.65439282 9.9378882,1.94635496 10.4285603,2.7973178 C10.9192324,3.64828064 10.6276736,4.73779792 9.77788642,5.22914885 Z M4.57213969,7.35869225 C5.42192691,7.85004318 5.71348571,8.93956046 5.22281359,9.79052329 C4.73214147,10.6414861 3.64412938,10.9334483 2.79434216,10.4420974 C1.94455494,9.95074642 1.65299614,8.86122915 2.14366826,8.01026631 C2.63434038,7.15930347 3.72235247,6.86734132 4.57213969,7.35869225 Z M2.79434216,21.6007481 C3.64412938,21.1093972 4.73214147,21.4013594 5.22281359,22.2523222 C5.71348571,23.103285 5.42192691,24.1928023 4.57213969,24.6841532 C3.72235247,25.1755042 2.63434038,24.883542 2.14366826,24.0325792 C1.65299614,23.1816163 1.94455494,22.0920991 2.79434216,21.6007481 Z M7.34941499,27.4652707 C7.84008711,26.6143079 8.9280992,26.3223457 9.77788642,26.8136966 C10.6276736,27.3050476 10.9192324,28.3945649 10.4285603,29.2455277 C9.9378882,30.0964905 8.84987611,30.3884527 8.00008889,29.8971017 C7.15030167,29.4057508 6.85874287,28.3162335 7.34941499,27.4652707 Z M18.7118524,11.3165596 C21.3074367,12.8173162 22.1963355,16.1392758 20.6976522,18.738451 C19.1989689,21.3358459 15.8815987,22.2259744 13.2860143,20.726998 C10.6922077,19.2262414 9.80330893,15.9042818 11.3002144,13.3051066 C12.7988978,10.7059314 16.116268,9.81580294 18.7118524,11.3165596 Z M26.7821642,27.8093944 L30.1315348,31.1633985 C30.3982044,31.4304371 30.2097579,31.8844026 29.8346426,31.8844026 L21.5945511,31.8844026 C21.1287681,31.8844026 20.751875,31.5069881 20.751875,31.0405608 L20.751875,22.7890697 C20.751875,22.4134355 21.2052134,22.2247282 21.4701052,22.4899865 L24.2843587,25.3081333 C26.8337204,23.0240636 28.4444049,19.7092251 28.4444049,16.0223129 C28.4444049,9.15052091 22.8621207,3.56051397 15.9998222,3.56051397 L15.9998222,0 C24.8230314,0 32,7.18689745 32,16.0223129 C32,20.6919269 29.9750886,24.8790914 26.7821642,27.8093944 Z" id="Mask" fill="#8B889A"></path></g></svg><span>Learning Paths</span></a></li><li class="nav-offers flyout-parent"><a href="#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>offers icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M35.9 20.6L27 15.5C26.1 15 24.7 15 23.7 15.5L14.9 20.6C13.9 21.1 13.2 22.4 13.2 23.4L13.2 41.4C13.2 42.4 13.9 43.7 14.9 44.2L23.3 49C24.2 49.5 25.6 49.5 26.6 49L35.9 43.6C36.8 43.1 37.6 41.8 37.6 40.8L37.6 23.4C37.6 22.4 36.8 21.1 35.9 20.6L35.9 20.6ZM40 8.2C39.1 7.6 37.6 7.6 36.7 8.2L30.2 11.9C29.3 12.4 29.3 13.2 30.2 13.8L39.1 18.8C40 19.4 40.7 20.6 40.7 21.7L40.7 39C40.7 40.1 41.4 40.5 42.4 40L48.2 36.6C49.1 36.1 49.8 34.9 49.8 33.8L49.8 15.6C49.8 14.6 49.1 13.3 48.2 12.8L40 8.2 40 8.2ZM27 10.1L33.6 6.4C34.5 5.9 34.5 5 33.6 4.5L26.6 0.5C25.6 0 24.2 0 23.3 0.5L16.7 4.2C15.8 4.7 15.8 5.6 16.7 6.1L23.7 10.1C24.7 10.6 26.1 10.6 27 10.1ZM10.1 21.7C10.1 20.6 10.8 19.4 11.7 18.8L20.6 13.8C21.5 13.2 21.5 12.4 20.6 11.9L13.6 7.9C12.7 7.4 11.2 7.4 10.3 7.9L1.6 12.8C0.7 13.3 0 14.6 0 15.6L0 33.8C0 34.9 0.7 36.1 1.6 36.6L8.4 40.5C9.3 41 10.1 40.6 10.1 39.6L10.1 21.7 10.1 21.7Z"/></g></svg><span>Offers & Deals</span></a><ul class="flyout"><li><a href="/oreilly-conferences/" class="l2 nav-icn"><span>Conferences</span></a></li><li><a href="https://get.oreilly.com/email-signup.html" target="_blank" class="l2 nav-icn"><span>Newsletters</span></a></li></ul></li><li class="nav-highlights"><a href="/u/48b847cc-4100-401a-9732-d0a93f06ed1e/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" width="20" height="20" fill="#4A3C31"><path d="M13.325 18.071H8.036c0-6.736 4.324-10.925 14.464-12.477V0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35c5.142 0 9.175-3.515 9.175-8.816 0-4.628-2.367-7.293-6.253-8.113zm27.5 0h-5.26c0-6.736 4.295-10.925 14.435-12.477V0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35c5.113 0 9.146-3.515 9.146-8.816 0-4.628-2.338-7.293-6.253-8.113z" fill-rule="evenodd"/></svg><span>Highlights</span></a></li><li><a href="/u/preferences/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"/></g></svg><span>Settings</span></a></li><li><a href="https://www.oreilly.com/online-learning/support/" class="l1 no-icon">Support</a></li><li><a href="/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="/u/preferences/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"/></g></svg><span>Settings</span></a></li><li><a href="https://www.oreilly.com/online-learning/support/" class="l2">Support</a></li><li><a href="/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Head First Design Patterns
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/0596007124/chapter/ch11.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards"></div></div></li><li class="js-font-control-panel font-control-activator"><a href="#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a
        class="twitter share-button t-twitter"
        target="_blank"
        aria-label="Share this section on Twitter"
        title="Share this section on Twitter"
      
        href="https://twitter.com/share?url=https://learning.oreilly.com/library/view/head-first-design/0596007124/ch11.html&text=Head%20First%20Design%20Patterns&via=safari"
      ><span>Twitter</span></a></li><li><a
        class="facebook share-button t-facebook"
        target="_blank"
        aria-label="Share this section on Facebook"
        title="Share this section on Facebook"
        href="https://www.facebook.com/sharer/sharer.php?u=https://learning.oreilly.com/library/view/head-first-design/0596007124/ch11.html"
      ><span>Facebook</span></a></li><li><a
        class="googleplus share-button t-googleplus"
        target="_blank"
        aria-label="Share this secton on Google Plus"
        title="Share this secton on Google Plus"
        href="https://plus.google.com/share?url=https://learning.oreilly.com/library/view/head-first-design/0596007124/ch11.html"
      ><span>Google Plus</span></a></li><li><a
        class="email share-button t-email"
        aria-label="Share this section via email"
        title="Share this section via email"
      
        href="mailto:?subject=Safari: 11.%20The%20Proxy%20Pattern%3A%20Controlling%20Object%20Access&body=https://learning.oreilly.com/library/view/head-first-design/0596007124/ch11.html%0D%0Afrom Head%20First%20Design%20Patterns%0D%0A"
      ><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    
    <section role="document">
        
        




  <script defer src="/static/js/build/djangoMessagesPage.0361f09909c8.js"></script>


        
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="/library/view/head-first-design/0596007124/ch10.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">10. The State Pattern: The State of Things</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="/library/view/head-first-design/0596007124/ch12.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">12. Compound Patterns: Patterns of Patterns</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><section class="chapter" title="Chapter 11. The Proxy Pattern: Controlling Object Access" epub:type="chapter" id="proxy_pattern_controlling_object_access"><div class="titlepage"><div><div><h2 class="title">Chapter 11. The Proxy Pattern: Controlling Object Access</h2></div></div></div><div class="informalfigure"><a id="med_id00593a"></a><div class="mediaobject"><a id="med_id00593"></a><img src="/library/view/head-first-design/0596007124/figs/web/437fig01.png.jpg" alt="image with no caption" width="613" height="455"></div></div><p><a id="iddle2154" class="indexterm"></a><span class="strong"><strong>Ever play good cop, bad cop?</strong></span> You’re the good cop and you provide all your services in a nice and friendly manner, but you don’t want everyone asking you for services, so you have the bad cop control access to you. That’s what proxies do: control and manage access. As you’re going to see, there are lots of ways in which proxies stand in for the objects they proxy. Proxies have been known to haul entire method calls over the Internet for their proxied objects; they’ve also been known to patiently stand in the place for some pretty lazy objects.</p><div class="informalfigure"><a id="med_id00594a"></a><div class="mediaobject"><a id="med_id00594"></a><img src="/library/view/head-first-design/0596007124/figs/web/438fig01.png.jpg" alt="image with no caption" width="461" height="466"></div></div><p><a id="iddle1302" class="indexterm"></a><a id="iddle1709" class="indexterm"></a><a id="iddle1974" class="indexterm"></a>Sounds easy enough. If you remember, we’ve already got methods in the gumball machine code for getting the count of gumballs (getCount()), and getting the current state of the machine (getState()).</p><p>All we need to do is create a report that can be printed out and sent back to the CEO. Hmmm, we should probably add a location field to each gumball machine as well; that way the CEO can keep the machines straight.</p><p>Let’s just jump in and code this. We’ll impress the CEO with a very fast turnaround.</p><div class="sect1" title="Coding the Monitor"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="coding_the_monitor">Coding the Monitor</h2></div></div></div><p>Let’s start by adding support to the GumballMachine class so that it can handle locations:</p><div class="informalfigure"><a id="med_id00595a"></a><div class="mediaobject"><a id="med_id00595"></a><img src="/library/view/head-first-design/0596007124/figs/web/439fig01.png.jpg" alt="image with no caption" width="645" height="326"></div></div><p>Now let’s create another class, GumballMonitor, that retrieves the machine’s location, inventory of gumballs, and current machine state and prints them in a nice little report:</p><div class="informalfigure"><a id="med_id00596a"></a><div class="mediaobject"><a id="med_id00596"></a><img src="/library/view/head-first-design/0596007124/figs/web/439fig02.png.jpg" alt="image with no caption" width="719" height="320"></div></div></div><div class="sect1" title="Testing the Monitor"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="testing_the_monitor">Testing the Monitor</h2></div></div></div><p>We implemented that in no time. The CEO is going to be thrilled and amazed by our development skills.</p><p>Now we just need to instantiate a GumballMonitor and give it a machine to monitor:</p><div class="informalfigure"><a id="med_id00597a"></a><div class="mediaobject"><a id="med_id00597"></a><img src="/library/view/head-first-design/0596007124/figs/web/440fig01.png.jpg" alt="image with no caption" width="763" height="761"></div></div><div class="informalfigure"><a id="med_id00598a"></a><div class="mediaobject"><a id="med_id00598"></a><img src="/library/view/head-first-design/0596007124/figs/web/441fig01.png.jpg" alt="image with no caption" width="752" height="428"></div></div><p><a id="iddle1314" class="indexterm"></a><a id="iddle1710" class="indexterm"></a><a id="iddle1986" class="indexterm"></a><a id="iddle2166" class="indexterm"></a><a id="iddle2223" class="indexterm"></a><span class="strong"><strong>Frank</strong></span>: A remote what?</p><p><span class="strong"><strong>Joe</strong></span>: Remote proxy. Think about it: we’ve already got the monitor code written, right? We give the GumballMonitor a reference to a machine and it gives us a report. The problem is that the monitor runs in the same JVM as the gumball machine and the CEO wants to sit at his desk and remotely monitor the machines! So what if we left our GumballMonitor class as is, but handed it a proxy to a remote object?</p><p><span class="strong"><strong>Frank</strong></span>: I’m not sure I get it.</p><p><span class="strong"><strong>Jim</strong></span>: Me neither.</p><p><span class="strong"><strong>Joe</strong></span>: Let’s start at the beginning... a proxy is a stand in for a real object. In this case, the proxy acts just like it is a Gumball Machine object, but behind the scenes it is communicating over the network to talk to the real, remote GumballMachine.</p><p><span class="strong"><strong>Jim</strong></span>: So you’re saying we keep our code as it is, and we give the monitor a reference to a proxy version of the GumballMachine...</p><p><span class="strong"><strong>Frank</strong></span>: And this proxy pretends it’s the real object, but it’s really just communicating over the net to the real object.</p><p><span class="strong"><strong>Joe</strong></span>: Yeah, that’s pretty much the story.</p><p><span class="strong"><strong>Frank</strong></span>: It sounds like something that is easier said than done.</p><p><span class="strong"><strong>Joe</strong></span>: Perhaps, but I don’t think it’ll be that bad. We have to make sure that the gumball machine can act as a service and accept requests over the network; we also need to give our monitor a way to get a reference to a proxy object, but we’ve got some great tools already built into Java to help us. Let’s talk a little more about remote proxies first...</p></div><div class="sect1" title="The role of the ‘remote proxy’"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="role_of_the_apostropheremote_proxyapostr">The role of the ‘remote proxy’</h2></div></div></div><p><a id="iddle1320" class="indexterm"></a><a id="iddle1716" class="indexterm"></a><a id="iddle1992" class="indexterm"></a><a id="iddle2172" class="indexterm"></a><a id="iddle2229" class="indexterm"></a>A remote proxy acts as a <span class="emphasis"><em>local representative to a remote object</em></span>. What’s a “remote object”? It’s an object that lives in the heap of a different Java Virtual Machine (or more generally, a remote object that is running in a different address space). What’s a “local representative”? It’s an object that you can call local methods on and have them forwarded on to the remote object.</p><div class="informalfigure"><a id="med_id00599a"></a><div class="mediaobject"><a id="med_id00599"></a><img src="/library/view/head-first-design/0596007124/figs/web/442fig01.png.jpg" alt="image with no caption" width="765" height="401"></div></div><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>Your client object acts like it’s making remote method calls. But what it’s really doing is calling methods on a heap-local ‘proxy’ object that handles all the low-level details of network communication.</strong></span></p></blockquote></div><div class="informalfigure"><a id="med_id00600a"></a><div class="mediaobject"><a id="med_id00600"></a><img src="/library/view/head-first-design/0596007124/figs/web/443fig01.png.jpg" alt="image with no caption" width="695" height="510"></div></div><div class="note" title="Brain Power"><h3 class="title"><a id="ch11note01"></a>Brain Power</h3><p>Before going further, think about how you’d design a system to enable remote method invocation. How would you make it easy on the developer so that she has to write as little code as possible? How would you make the remote invocation look seamless?</p></div><div class="note" title="Brain Power"><h3 class="title"><a id="ch11note02"></a>Brain Power</h3><p>Should making remote calls be totally transparent? Is that a good idea? What might be a problem with that approach?</p></div></div><div class="sect1" title="Adding a remote proxy to the Gumball Machine monitoring code"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="adding_a_remote_proxy_to_the_gumball_mac">Adding a remote proxy to the Gumball Machine monitoring code</h2></div></div></div><p><a id="iddle1315" class="indexterm"></a><a id="iddle1711" class="indexterm"></a><a id="iddle1869" class="indexterm"></a><a id="iddle1987" class="indexterm"></a><a id="iddle2167" class="indexterm"></a><a id="iddle2212" class="indexterm"></a><a id="iddle2224" class="indexterm"></a><a id="iddle2239" class="indexterm"></a>On paper this looks good, but how do we create a proxy that knows how to invoke a method on an object that lives in another JVM?</p><p>Hmmm. Well, you can’t get a reference to something on another heap, right? In other words, you can’t say:</p><a id="pro_id00039"></a><pre class="programlisting"><span class="strong"><strong>Duck d = &lt;object in another heap&gt;</strong></span></pre><p>Whatever the variable <span class="strong"><strong><code class="literal">d</code></strong></span> is referencing must be in the same heap space as the code running the statement. So how do we approach this? Well, that’s where Java’s Remote Method Invocation comes in... RMI gives us a way to find objects in a remote JVM and allows us to invoke their methods.</p><p>You may have encountered RMI in Head First Java; if not, take a slight detour and get up to speed on RMI before adding the proxy support to the Gumball Machine code.</p><p>So, here’s what we’re going to do:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>① First, we’re going to take the RMI Detour and check RMI out. Even if you are familiar with RMI, you might want to follow along and check out the scenery.</strong></span></p><div class="informalfigure"><a id="med_id00601a"></a><div class="mediaobject"><a id="med_id00601"></a><img src="/library/view/head-first-design/0596007124/figs/web/444fig01.png.jpg" alt="image with no caption" width="265" height="223"></div></div></li><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>② Then we’re going to take our GumballMachine and make it a remote service that provides a set of methods calls that can be invoked remotely.</strong></span></p></li><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>③ Then, we going to create a proxy that can talk to a remote GumballMachine, again using RMI, and put the monitoring system back together so that the CEO can monitor any number of remote machines.</strong></span></p></li></ul></div></div><div class="sect1" title="Remote methods 101"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="remote_methods_101">Remote methods 101</h2></div></div></div><div class="informalfigure"><a id="med_id00602a"></a><div class="mediaobject"><a id="med_id00602"></a><img src="/library/view/head-first-design/0596007124/figs/web/common20.png.jpg" alt="image with no caption" width="107" height="49"></div></div><p><a id="iddle1137" class="indexterm"></a><a id="iddle2253" class="indexterm"></a>Let’s say we want to design a system that allows us to call a local object that forwards each request to a remote object. How would we design it? We’d need a couple of helper objects that actually do the communicating for us. The helpers make it possible for the client to act as though it’s calling a method on a local object (which in fact, it is). The client calls a method on the client helper, as if the client helper were the actual service. The client helper then takes care of forwarding that request for us.</p><p>In other words, the client object thinks it’s calling a method on the remote service, because the client helper is pretending to be the service object. Pretending to be the thing with the method the client wants to call.</p><p>But the client helper isn’t really the remote service. Although the client helper acts like it (because it has the same method that the service is advertising), the client helper doesn’t have any of the actual method logic the client is expecting. Instead, the client helper contacts the server, transfers information about the method call (e.g., name of the method, arguments, etc.), and waits for a return from the server.</p><p>On the server side, the service helper receives the request from the client helper (through a Socket connection), unpacks the information about the call, and then invokes the real method on the real service object. So, to the service object, the call is local. It’s coming from the service helper, not a remote client.</p><p>The service helper gets the return value from the service, packs it up, and ships it back (over a Socket’s output stream) to the client helper. The client helper unpacks the information and returns the value to the client object.</p><div class="note" title="Note"><h3 class="title"><a id="ch11note01a"></a>Note</h3><p>This should look familiar...</p></div><div class="informalfigure"><a id="med_id00603a"></a><div class="mediaobject"><a id="med_id00603"></a><img src="/library/view/head-first-design/0596007124/figs/web/445fig01.png.jpg" alt="image with no caption" width="835" height="363"></div></div><p><a id="iddle2220" class="indexterm"></a><a id="iddle2247" class="indexterm"></a><span class="strong"><strong>How the method call happens</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>① Client object calls doBigThing() on the client helper object.</p><div class="informalfigure"><a id="med_id00604a"></a><div class="mediaobject"><a id="med_id00604"></a><img src="/library/view/head-first-design/0596007124/figs/web/446fig01.png.jpg" alt="image with no caption" width="594" height="234"></div></div></li><li class="listitem" style="list-style-type: none"><p>② Client helper packages up information about the call (arguments, method name, etc.) and ships it over the network to the service helper.</p><div class="informalfigure"><a id="med_id00605a"></a><div class="mediaobject"><a id="med_id00605"></a><img src="/library/view/head-first-design/0596007124/figs/web/446fig02.png.jpg" alt="image with no caption" width="594" height="227"></div></div></li><li class="listitem" style="list-style-type: none"><p>③ Service helper unpacks the information from the client helper, finds out which method to call (and on which object) and invokes the <span class="underline">real</span> method on the <span class="underline">real</span> service object.</p><div class="informalfigure"><a id="med_id00606a"></a><div class="mediaobject"><a id="med_id00606"></a><img src="/library/view/head-first-design/0596007124/figs/web/446fig03.png.jpg" alt="image with no caption" width="774" height="233"></div></div></li><li class="listitem" style="list-style-type: none"><p>④ The method is invoked on the service object, which returns some result to the service helper.</p><div class="informalfigure"><a id="med_id00607a"></a><div class="mediaobject"><a id="med_id00607"></a><img src="/library/view/head-first-design/0596007124/figs/web/common20.png.jpg" alt="image with no caption" width="107" height="49"></div></div><div class="informalfigure"><a id="med_id00608a"></a><div class="mediaobject"><a id="med_id00608"></a><img src="/library/view/head-first-design/0596007124/figs/web/447fig01.png.jpg" alt="image with no caption" width="594" height="238"></div></div></li><li class="listitem" style="list-style-type: none"><p>⑤ Service helper packages up information returned from the call and ships it back over the network to the client helper.</p><div class="informalfigure"><a id="med_id00609a"></a><div class="mediaobject"><a id="med_id00609"></a><img src="/library/view/head-first-design/0596007124/figs/web/447fig02.png.jpg" alt="image with no caption" width="594" height="232"></div></div></li><li class="listitem" style="list-style-type: none"><p>⑥ Client helper unpackages the returned values and returns them to the client object. To the client object, this was all transparent.</p><div class="informalfigure"><a id="med_id00610a"></a><div class="mediaobject"><a id="med_id00610"></a><img src="/library/view/head-first-design/0596007124/figs/web/447fig03.png.jpg" alt="image with no caption" width="594" height="231"></div></div></li></ul></div></div><div class="sect1" title="Java RMI, the Big Picture"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="java_rmicomma_the_big_picture">Java RMI, the Big Picture</h2></div></div></div><p><a id="iddle1138" class="indexterm"></a><a id="iddle2213" class="indexterm"></a><a id="iddle2240" class="indexterm"></a><a id="iddle2254" class="indexterm"></a><a id="iddle2347" class="indexterm"></a><a id="iddle2427" class="indexterm"></a>Okay, you’ve got the gist of how remote methods work; now you just need to understand how to use RMI to enable remote method invocation.</p><p>What RMI does for you is build the client and service helper objects, right down to creating a client helper object with the same methods as the remote service. The nice thing about RMI is that you don’t have to write any of the networking or I/O code yourself. With your client, you call remote methods (i.e., the ones the Real Service has) just like normal method calls on objects running in the client’s own local JVM.</p><p>RMI also provides all the runtime infrastructure to make it all work, including a lookup service that the client can use to find and access the remote objects.</p><p>There is one difference between RMI calls and local (normal) method calls. Remember that even though to the client it looks like the method call is local, the client helper sends the method call across the network. So there is networking and I/O. And what do we know about networking and I/O methods?</p><p>They’re risky! They can fail! And so, they throw exceptions all over the place. As a result, the client does have to acknowledge the risk. We’ll see how in a few pages.</p><p><span class="strong"><strong>RMI Nomenclature: in RMI, the client helper is a ‘stub’ and the service helper is a ‘skeleton’.</strong></span></p><div class="informalfigure"><a id="med_id00611a"></a><div class="mediaobject"><a id="med_id00611"></a><img src="/library/view/head-first-design/0596007124/figs/web/448fig01.png.jpg" alt="image with no caption" width="703" height="394"></div></div><p>Now let’s go through all the steps needed to make an object into a service that can accept remote calls and also the steps needed to allow a client to make remote calls.</p><p>You might want to make sure your seat belt is fastened; there are a lot of steps and a few bumps and curves—but nothing to be too worried about.</p><p><a id="iddle2219" class="indexterm"></a><a id="iddle2246" class="indexterm"></a><span class="strong"><strong>Making the Remote service</strong></span></p><div class="informalfigure"><a id="med_id00612a"></a><div class="mediaobject"><a id="med_id00612"></a><img src="/library/view/head-first-design/0596007124/figs/web/common20.png.jpg" alt="image with no caption" width="107" height="49"></div></div><p>This is an <span class="strong"><strong>overview</strong></span> of the five steps for making the remote service. In other words, the steps needed to take an ordinary object and supercharge it so it can be called by a remote client. We’ll be doing this later to our GumballMachine. For now, let’s get the steps down and then we’ll explain each one in detail.</p><p><span class="strong"><strong>Step one:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>Make a <span class="strong"><strong>Remote Interface</strong></span></p></li><li class="listitem" style="list-style-type: none"><p>The remote interface defines the methods that a client can call remotely. It’s what the client will use as the class type for your service. Both the Stub and actual service will implement this!</p></li></ul></div><div class="informalfigure"><a id="med_id00613a"></a><div class="mediaobject"><a id="med_id00613"></a><img src="/library/view/head-first-design/0596007124/figs/web/449fig01.png.jpg" alt="image with no caption" width="334" height="128"></div></div><p><span class="strong"><strong>Step two:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>Make a <span class="strong"><strong>Remote Implementation</strong></span></p></li><li class="listitem" style="list-style-type: none"><p>This is the class that does the Real Work. It has the real implementation of the remote methods defined in the remote interface. It’s the object that the client wants to call methods on (e.g., our GumballMachine!).</p></li></ul></div><div class="informalfigure"><a id="med_id00614a"></a><div class="mediaobject"><a id="med_id00614"></a><img src="/library/view/head-first-design/0596007124/figs/web/449fig02.png.jpg" alt="image with no caption" width="388" height="123"></div></div><p><span class="strong"><strong>Step three:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>Start the <span class="strong"><strong>RMI registry</strong></span> (rmiregistry)</p></li><li class="listitem" style="list-style-type: none"><p>The <span class="emphasis"><em>rmiregistry</em></span> is like the white pages of a phone book. It’s where the client goes to get the proxy (the client stub/helper object).</p></li></ul></div><div class="informalfigure"><a id="med_id00615a"></a><div class="mediaobject"><a id="med_id00615"></a><img src="/library/view/head-first-design/0596007124/figs/web/449fig03.png.jpg" alt="image with no caption" width="479" height="138"></div></div><p><span class="strong"><strong>Step four:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>Start the <span class="strong"><strong>remote service</strong></span></p></li><li class="listitem" style="list-style-type: none"><p>You have to get the service object up and running. Your service implementation class instantiates an instance of the service and registers it with the RMI registry. Registering it makes the service available for clients.</p><div class="informalfigure"><a id="med_id00616a"></a><div class="mediaobject"><a id="med_id00616"></a><img src="/library/view/head-first-design/0596007124/figs/web/449fig04.png.jpg" alt="image with no caption" width="422" height="219"></div></div></li></ul></div><p><span class="strong"><strong>Step one: make a Remote interface</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>① Extend java.rmi.Remote</strong></span></p><p>Remote is a ‘marker’ interface, which means it has no methods. It has special meaning for RMI, though, so you must follow this rule. Notice that we say ‘extends’ here. One interface is allowed to <span class="emphasis"><em>extend</em></span> another interface.</p><div class="informalfigure"><a id="med_id00617a"></a><div class="mediaobject"><a id="med_id00617"></a><img src="/library/view/head-first-design/0596007124/figs/web/450fig01.png.jpg" alt="image with no caption" width="716" height="77"></div></div></li><li class="listitem" style="list-style-type: none"><p>② Declare that all methods <span class="strong"><strong>throw a RemoteException</strong></span></p><p>The remote interface is the one the client uses as the type for the service. In other words, the client invokes methods on something that implements the remote interface. That something is the stub, of course, and since the stub is doing networking and I/O, all kinds of Bad Things can happen. The client has to acknowledge the risks by handling or declaring the remote exceptions. If the methods in an interface declare exceptions, any code calling methods on a reference of that type (the interface type) must handle or declare the exceptions.</p><div class="informalfigure"><a id="med_id00618a"></a><div class="mediaobject"><a id="med_id00618"></a><img src="/library/view/head-first-design/0596007124/figs/web/450fig02.png.jpg" alt="image with no caption" width="804" height="197"></div></div></li><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>③ Be sure arguments and return values are primitives or Serializable</strong></span></p><p>Arguments and return values of a remote method must be either primitive or Serializable. Think about it. Any argument to a remote method has to be packaged up and shipped across the network, and that’s done through Serialization. Same thing with return values. If you use primitives, Strings, and the majority of types in the API (including arrays and collections), you’ll be fine. If you are passing around your own types, just be sure that you make your classes implement Serializable.</p><div class="note" title="Note"><h3 class="title"><a id="ch11note03"></a>Note</h3><p>Check out Head First Java if you need to refresh your memory on Serializable.</p></div><div class="informalfigure"><a id="med_id00619a"></a><div class="mediaobject"><a id="med_id00619"></a><img src="/library/view/head-first-design/0596007124/figs/web/450fig03.png.jpg" alt="image with no caption" width="567" height="113"></div></div></li></ul></div><p><span class="strong"><strong>Step two: make a Remote implementation</strong></span></p><div class="informalfigure"><a id="med_id00620a"></a><div class="mediaobject"><a id="med_id00620"></a><img src="/library/view/head-first-design/0596007124/figs/web/common20.png.jpg" alt="image with no caption" width="107" height="49"></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>① Implement the Remote interface</strong></span></p><p>Your service has to implement the remote interface—the one with the methods your client is going to call.</p><div class="informalfigure"><a id="med_id00621a"></a><div class="mediaobject"><a id="med_id00621"></a><img src="/library/view/head-first-design/0596007124/figs/web/451fig01.png.jpg" alt="image with no caption" width="766" height="142"></div></div></li><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>② Extend UnicastRemoteObject</strong></span></p><p>In order to work as a remote service object, your object needs some functionality related to ‘being remote’. The simplest way is to extend UnicastRemoteObject (from the java.rmi.server package) and let that class (your superclass) do the work for you.</p><div class="informalfigure"><a id="med_id00622a"></a><div class="mediaobject"><a id="med_id00622"></a><img src="/library/view/head-first-design/0596007124/figs/web/451fig02.png.jpg" alt="image with no caption" width="796" height="105"></div></div></li><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>③ Write a no-arg constructor that declares a RemoteException</strong></span></p><p>Your new superclass, UnicastRemoteObject, has one little problem—its constructor throws a RemoteException. The only way to deal with this is to declare a constructor for your remote implementation, just so that you have a place to declare the RemoteException. Remember, when a class is instantiated, its superclass constructor is always called. If your superclass constructor throws an exception, you have no choice but to declare that your constructor also throws an exception.</p><div class="informalfigure"><a id="med_id00623a"></a><div class="mediaobject"><a id="med_id00623"></a><img src="/library/view/head-first-design/0596007124/figs/web/451fig03.png.jpg" alt="image with no caption" width="776" height="92"></div></div></li><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>④ Register the service with the RMI registry</strong></span></p><p>Now that you’ve got a remote service, you have to make it available to remote clients. You do this by instantiating it and putting it into the RMI registry (which must be running or this line of code fails). When you register the implementation object, the RMI system actually puts the <span class="emphasis"><em>stub</em></span> in the registry, since that’s what the client really needs. Register your service using the static rebind() method of the java.rmi.Naming class.</p><div class="informalfigure"><a id="med_id00624a"></a><div class="mediaobject"><a id="med_id00624"></a><img src="/library/view/head-first-design/0596007124/figs/web/451fig04.png.jpg" alt="image with no caption" width="781" height="123"></div></div></li></ul></div><p><a id="iddle1139" class="indexterm"></a><a id="iddle1858" class="indexterm"></a><a id="iddle2175" class="indexterm"></a><a id="iddle2255" class="indexterm"></a><a id="iddle2348" class="indexterm"></a><a id="iddle2428" class="indexterm"></a><span class="strong"><strong>Step three: run rmiregistry</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>① Bring up a terminal and start the rmiregistry.</strong></span></p><p>Be sure you start it from a directory that has access to your classes. The simplest way is to start it from your <code class="literal">classes</code> directory.</p><div class="informalfigure"><a id="med_id00625a"></a><div class="mediaobject"><a id="med_id00625"></a><img src="/library/view/head-first-design/0596007124/figs/web/452fig01.png.jpg" alt="image with no caption" width="267" height="139"></div></div></li></ul></div><p><span class="strong"><strong>Step four: start the service</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>① Bring up another terminal and start your service</strong></span></p><p>This might be from a main() method in your remote implementation class, or from a separate launcher class. In this simple example, we put the starter code in the implementation class, in a main method that instantiates the object and registers it with RMI registry.</p><div class="informalfigure"><a id="med_id00626a"></a><div class="mediaobject"><a id="med_id00626"></a><img src="/library/view/head-first-design/0596007124/figs/web/452fig02.png.jpg" alt="image with no caption" width="266" height="139"></div></div></li></ul></div><div class="note" title="Watch it!"><h3 class="title"><a id="ch11note04"></a>Watch it!</h3><p><span class="strong"><strong>Before Java 5, we had to generate static stubs and skeletons using rmic. Now, we don’t have to do this anymore and in fact, we</strong></span> <span class="bolditalic">shouldn’t</span> <span class="strong"><strong>do it anymore, because</strong></span> <span class="bolditalic">static</span> <span class="strong"><strong>stubs and skeletons are deprecated.</strong></span></p><p><span class="emphasis"><em>Instead, stubs and skeletons are generated dynamically. This happens automatically when we subclass the UnicastRemoteObject (like we’re doing for the MyRemoteImpl class).</em></span></p></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00140"></a><div class="sidebar-title">There Are No Dumb Questions</div><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "><col></colgroup><tbody><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch11qa1qe1"></a><a id="ch11qa1q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Why are you showing stubs and skeletons in the diagrams for the RMI code? I thought we got rid of those way back.</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch11qa1q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> You’re right; for the skeleton, the RMI runtime can dispatch the client calls directly to the remote service using reflection, and stubs are generated dynamically using Dynamic Proxy (which you’ll learn more about a bit later in the chapter). The remote object’s stub is a java.lang.reflect.Proxy instance (with an invocation handler) that is automatically generated to handle all the details of getting the local method calls by the client to the remote object. But we like to show both the stub and skeleton, because conceptually it helps you to understand that there is something under the covers that’s making that communication between the client stub and the remote service happen.</p></td></tr></tbody></table></div></blockquote></div></div><p><a id="iddle2215" class="indexterm"></a><a id="iddle2242" class="indexterm"></a><span class="strong"><strong>Complete code for the server side</strong></span></p><div class="informalfigure"><a id="med_id00627a"></a><div class="mediaobject"><a id="med_id00627"></a><img src="/library/view/head-first-design/0596007124/figs/web/common20.png.jpg" alt="image with no caption" width="107" height="49"></div></div><p><span class="strong"><strong>The Remote interface:</strong></span></p><div class="informalfigure"><a id="med_id00628a"></a><div class="mediaobject"><a id="med_id00628"></a><img src="/library/view/head-first-design/0596007124/figs/web/453fig01.png.jpg" alt="image with no caption" width="762" height="172"></div></div><p><span class="strong"><strong>The Remote service (the implementation):</strong></span></p><div class="informalfigure"><a id="med_id00629a"></a><div class="mediaobject"><a id="med_id00629"></a><img src="/library/view/head-first-design/0596007124/figs/web/453fig02.png.jpg" alt="image with no caption" width="814" height="592"></div></div></div><div class="sect1" title="How does the client get the stub object?"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="how_does_the_client_get_the_stub_objectq">How does the client get the stub <span class="underline">ob</span>j<span class="underline">ect</span>?</h2></div></div></div><p><a id="iddle1140" class="indexterm"></a><a id="iddle2214" class="indexterm"></a><a id="iddle2241" class="indexterm"></a><a id="iddle2256" class="indexterm"></a><a id="iddle2349" class="indexterm"></a><a id="iddle2429" class="indexterm"></a>The client has to get the stub object (our proxy), since that’s the thing the client will call methods on. And that’s where the RMI registry comes in. The client does a ‘lookup’, like going to the white pages of a phone book, and essentially says, “Here’s a name, and I’d like the stub that goes with that name.”</p><p>Let’s take a look at the code we need to look-up and retrieve a stub object.</p><div class="sidebar"><a id="code_up_close-id00141"></a><div class="sidebar-title">Code Up Close</div><div class="note" title="Note"><h3 class="title"><a id="ch11note02a"></a>Note</h3><p>Here’s how it works.</p></div><div class="informalfigure"><a id="med_id00630a"></a><div class="mediaobject"><a id="med_id00630"></a><img src="/library/view/head-first-design/0596007124/figs/web/454fig01.png.jpg" alt="image with no caption" width="721" height="299"></div></div></div><div class="informalfigure"><a id="med_id00631a"></a><div class="mediaobject"><a id="med_id00631"></a><img src="/library/view/head-first-design/0596007124/figs/web/common20.png.jpg" alt="image with no caption" width="107" height="49"></div></div><div class="informalfigure"><a id="med_id00632a"></a><div class="mediaobject"><a id="med_id00632"></a><img src="/library/view/head-first-design/0596007124/figs/web/455fig01.png.jpg" alt="image with no caption" width="659" height="440"></div></div><p><span class="strong"><strong>How it works...</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>① Client does a lookup on the RMI registry</strong></span></p><a id="pro_id00040"></a><pre class="programlisting"><span class="strong"><strong>Naming.lookup("rmi://127.0.0.1/RemoteHello");</strong></span></pre></li><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>② RMI registry returns the stub object</strong></span></p><p>(as the return value of the lookup method) and RMI deserializes the stub automatically.</p></li><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>③ Client invokes a method on the stub, as if the stub IS the real service</strong></span></p></li></ul></div><p><a id="iddle2222" class="indexterm"></a><a id="iddle2249" class="indexterm"></a><span class="strong"><strong>Complete client code</strong></span></p><div class="informalfigure"><a id="med_id00633a"></a><div class="mediaobject"><a id="med_id00633"></a><img src="/library/view/head-first-design/0596007124/figs/web/456fig01.png.jpg" alt="image with no caption" width="791" height="503"></div></div><div class="note" title="Watch it!"><h3 class="title"><a id="ch11note05"></a>Watch it!</h3><p><span class="strong"><strong>The things programmers do wrong with RMI are:</strong></span></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Forget to start rmiregistry before starting remote service (when the service is registered using Naming.rebind(), the rmiregistry must be running!)</em></span></p></li><li class="listitem"><p><span class="emphasis"><em>Forget to make arguments and return types serializable (you won’t know until runtime; this is not something the compiler will detect.)</em></span></p></li></ol></div></div></div><div class="sect1" title="Back to our GumballMachine remote proxy"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="back_to_our_gumballmachine_remote_proxy">Back to our GumballMachine remote proxy</h2></div></div></div><p>Okay, now that you have the RMI basics down, you’ve got the tools you need to implement the gumball machine remote proxy. Let’s take a look at how the GumballMachine fits into this framework:</p><div class="informalfigure"><a id="med_id00634a"></a><div class="mediaobject"><a id="med_id00634"></a><img src="/library/view/head-first-design/0596007124/figs/web/457fig01.png.jpg" alt="image with no caption" width="172" height="206"></div></div><div class="informalfigure"><a id="med_id00635a"></a><div class="mediaobject"><a id="med_id00635"></a><img src="/library/view/head-first-design/0596007124/figs/web/457fig02.png.jpg" alt="image with no caption" width="803" height="444"></div></div></div><div class="sect1" title="Getting the GumballMachine ready to be a remote service"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="getting_the_gumballmachine_ready_to_be_a">Getting the GumballMachine ready to be a remote service</h2></div></div></div><p><a id="iddle1316" class="indexterm"></a><a id="iddle1712" class="indexterm"></a><a id="iddle1988" class="indexterm"></a><a id="iddle2168" class="indexterm"></a><a id="iddle2216" class="indexterm"></a><a id="iddle2225" class="indexterm"></a><a id="iddle2243" class="indexterm"></a>The first step in converting our code to use the remote proxy is to enable the GumballMachine to service remote requests from clients. In other words, we’re going to make it into a service. To do that, we need to:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Create a remote interface for the GumballMachine. This will provide a set of methods that can be called remotely.</p></li><li class="listitem"><p>Make sure all the return types in the interface are serializable.</p></li><li class="listitem"><p>Implement the interface in a concrete class.</p></li></ol></div><p>We’ll start with the remote interface:</p><div class="informalfigure"><a id="med_id00636a"></a><div class="mediaobject"><a id="med_id00636"></a><img src="/library/view/head-first-design/0596007124/figs/web/458fig01.png.jpg" alt="image with no caption" width="670" height="333"></div></div><p>We have one return type that isn’t Serializable: the State class. Let’s fix it up...</p><div class="informalfigure"><a id="med_id00637a"></a><div class="mediaobject"><a id="med_id00637"></a><img src="/library/view/head-first-design/0596007124/figs/web/458fig02.png.jpg" alt="image with no caption" width="710" height="210"></div></div><p><a id="iddle2217" class="indexterm"></a><a id="iddle2244" class="indexterm"></a>Actually, we’re not done with Serializable yet; we have one problem with State. As you may remember, each State object maintains a reference to a gumball machine so that it can call the gumball machine’s methods and change its state. We don’t want the entire gumball machine serialized and transferred with the State object. There is an easy way to fix this:</p><div class="informalfigure"><a id="med_id00638a"></a><div class="mediaobject"><a id="med_id00638"></a><img src="/library/view/head-first-design/0596007124/figs/web/459fig01.png.jpg" alt="image with no caption" width="800" height="170"></div></div><p>We’ve already implemented our GumballMachine, but we need to make sure it can act as a service and handle requests coming from over the network. To do that, we have to make sure the GumballMachine is doing everything it needs to implement the GumballMachineRemote interface.</p><p>As you’ve already seen in the RMI detour, this is quite simple; all we need to do is add a couple of things...</p><div class="informalfigure"><a id="med_id00639a"></a><div class="mediaobject"><a id="med_id00639"></a><img src="/library/view/head-first-design/0596007124/figs/web/459fig02.png.jpg" alt="image with no caption" width="811" height="569"></div></div></div><div class="sect1" title="Registering with the RMI registry..."><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="registering_with_the_rmi_registryhellip">Registering with the RMI registry...</h2></div></div></div><p><a id="iddle1317" class="indexterm"></a><a id="iddle1713" class="indexterm"></a><a id="iddle1989" class="indexterm"></a><a id="iddle2169" class="indexterm"></a><a id="iddle2221" class="indexterm"></a><a id="iddle2226" class="indexterm"></a><a id="iddle2248" class="indexterm"></a>That completes the gumball machine service. Now we just need to fire it up so it can receive requests. First, we need to make sure we register it with the RMI registry so that clients can locate it.</p><p>We’re going to add a little code to the test drive that will take care of this for us:</p><div class="informalfigure"><a id="med_id00640a"></a><div class="mediaobject"><a id="med_id00640"></a><img src="/library/view/head-first-design/0596007124/figs/web/460fig01.png.jpg" alt="image with no caption" width="794" height="433"></div></div><p>Let’s go ahead and get this running...</p><div class="informalfigure"><a id="med_id00641a"></a><div class="mediaobject"><a id="med_id00641"></a><img src="/library/view/head-first-design/0596007124/figs/web/460fig02.png.jpg" alt="image with no caption" width="842" height="327"></div></div></div><div class="sect1" title="Now for the GumballMonitor client..."><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="now_for_the_gumballmonitor_clienthellip">Now for the GumballMonitor client...</h2></div></div></div><p><a id="iddle1318" class="indexterm"></a><a id="iddle1714" class="indexterm"></a><a id="iddle1990" class="indexterm"></a><a id="iddle2170" class="indexterm"></a><a id="iddle2218" class="indexterm"></a><a id="iddle2227" class="indexterm"></a><a id="iddle2245" class="indexterm"></a>Remember the GumballMonitor? We wanted to reuse it without having to rewrite it to work over a network. Well, we’re pretty much going to do that, but we do need to make a few changes.</p><div class="informalfigure"><a id="med_id00642a"></a><div class="mediaobject"><a id="med_id00642"></a><img src="/library/view/head-first-design/0596007124/figs/web/461fig01.png.jpg" alt="image with no caption" width="822" height="470"></div></div><div class="informalfigure"><a id="med_id00643a"></a><div class="mediaobject"><a id="med_id00643"></a><img src="/library/view/head-first-design/0596007124/figs/web/461fig02.png.jpg" alt="image with no caption" width="434" height="322"></div></div></div><div class="sect1" title="Writing the Monitor test drive"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="writing_the_monitor_test_drive">Writing the Monitor test drive</h2></div></div></div><p><a id="iddle1321" class="indexterm"></a><a id="iddle1717" class="indexterm"></a><a id="iddle1993" class="indexterm"></a><a id="iddle2173" class="indexterm"></a><a id="iddle2230" class="indexterm"></a>Now we’ve got all the pieces we need. We just need to write some code so the CEO can monitor a bunch of gumball machines:</p><div class="informalfigure"><a id="med_id00644a"></a><div class="mediaobject"><a id="med_id00644"></a><img src="/library/view/head-first-design/0596007124/figs/web/462fig01.png.jpg" alt="image with no caption" width="761" height="733"></div></div><div class="sidebar"><a id="code_up_close-id00142"></a><div class="sidebar-title">Code Up Close</div><div class="informalfigure"><a id="med_id00645a"></a><div class="mediaobject"><a id="med_id00645"></a><img src="/library/view/head-first-design/0596007124/figs/web/463fig01.png.jpg" alt="image with no caption" width="690" height="290"></div></div></div></div><div class="sect1" title="Another demo for the CEO of Mighty Gumball..."><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="another_demo_for_the_ceo_of_mighty_gumba">Another demo for the CEO of Mighty Gumball...</h2></div></div></div><p>Okay, it’s time to put all this work together and give another demo. First let’s make sure a few gumball machines are running the new code:</p><div class="informalfigure"><a id="med_id00646a"></a><div class="mediaobject"><a id="med_id00646"></a><img src="/library/view/head-first-design/0596007124/figs/web/463fig02.png.jpg" alt="image with no caption" width="813" height="410"></div></div><div class="sect2" title="And now let’s put the monitor in the hands of the CEO. Hopefully, this time he’ll love it"><div class="titlepage"><div><div><h3 class="title" id="and_now_letapostrophes_put_the_monitor_i">And now let’s put the monitor in the hands of the CEO. Hopefully, this time he’ll love it</h3></div></div></div><div class="informalfigure"><a id="med_id00647a"></a><div class="mediaobject"><a id="med_id00647"></a><img src="/library/view/head-first-design/0596007124/figs/web/464fig01.png.jpg" alt="image with no caption" width="808" height="722"></div></div><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>By invoking methods on the proxy, we make a remote call across the wire, and get back a String, an integer, and a State object. Because we are using a proxy, the GumballMonitor doesn’t know, or care, that calls are remote (other than having to worry about remote exceptions).</strong></span></p></blockquote></div><div class="informalfigure"><a id="med_id00648a"></a><div class="mediaobject"><a id="med_id00648"></a><img src="/library/view/head-first-design/0596007124/figs/web/465fig01.png.jpg" alt="image with no caption" width="447" height="231"></div></div><div class="sidebar"><a id="behind_the_scenes-id00143"></a><div class="sidebar-title">Behind the Scenes</div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p><a id="iddle1141" class="indexterm"></a><a id="iddle1319" class="indexterm"></a><a id="iddle1715" class="indexterm"></a><a id="iddle1991" class="indexterm"></a><a id="iddle2171" class="indexterm"></a><a id="iddle2228" class="indexterm"></a><a id="iddle2257" class="indexterm"></a><a id="iddle2350" class="indexterm"></a><a id="iddle2430" class="indexterm"></a>① The CEO runs the monitor, which first grabs the proxies to the remote gumball machines and then calls getState() on each one (along with getCount() and getLocation()).</p><div class="informalfigure"><a id="med_id00649a"></a><div class="mediaobject"><a id="med_id00649"></a><img src="/library/view/head-first-design/0596007124/figs/web/465fig02.png.jpg" alt="image with no caption" width="799" height="490"></div></div></li><li class="listitem" style="list-style-type: none"><p>② getState() is called on the proxy, which forwards the call to the remote service. The skeleton receives the request and then forwards it to the gumball machine.</p><div class="informalfigure"><a id="med_id00650a"></a><div class="mediaobject"><a id="med_id00650"></a><img src="/library/view/head-first-design/0596007124/figs/web/466fig01.png.jpg" alt="image with no caption" width="684" height="211"></div></div></li><li class="listitem" style="list-style-type: none"><p>③ GumballMachine returns the state to the skeleton, which serializes it and transfers it back over the wire to the proxy. The proxy deserializes it and returns it as an object to the monitor.</p><div class="informalfigure"><a id="med_id00651a"></a><div class="mediaobject"><a id="med_id00651"></a><img src="/library/view/head-first-design/0596007124/figs/web/466fig02.png.jpg" alt="image with no caption" width="749" height="349"></div></div></li></ul></div><div class="note" title="Note"><h3 class="title"><a id="ch11note06"></a>Note</h3><p>We also have a small bit of code to register and locate stubs using the RMI registry. But no matter what, if we were writing something to work over the Internet, we’d need some kind of locator service.</p></div></div></div></div><div class="sect1" title="The Proxy Pattern defined"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="proxy_pattern_defined">The Proxy Pattern defined</h2></div></div></div><p><a id="iddle2160" class="indexterm"></a>We’ve already put a lot of pages behind us in this chapter; as you can see, explaining the Remote Proxy is quite involved. Despite that, you’ll see that the definition and class diagram for the Proxy Pattern is actually fairly straightforward. Note that Remote Proxy is one implementation of the general Proxy Pattern; there are actually quite a few variations of the pattern, and we’ll talk about them later. For now, let’s get the details of the general pattern down.</p><p>Here’s the Proxy Pattern definition:</p><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>Use the Proxy Pattern to create a representative object that controls access to another object, which may be remote, expensive to create, or in need of securing.</strong></span></p></blockquote></div><div class="note" title="Note"><h3 class="title"><a id="ch11note07"></a>Note</h3><p><span class="strong"><strong>The Proxy Pattern</strong></span> provides a surrogate or placeholder for another object to control access to it.</p></div><p>Well, we’ve seen how the Proxy Pattern provides a surrogate or placeholder for another object. We’ve also described the proxy as a “representative” for another object.</p><p>But what about a proxy controlling access? That sounds a little strange. No worries. In the case of the gumball machine, just think of the proxy controlling access to the remote object. The proxy needed to control access because our client, the monitor, didn’t know how to talk to a remote object. So in some sense the remote proxy controlled access so that it could handle the network details for us. As we just discussed, there are many variations of the Proxy Pattern, and the variations typically revolve around the way the proxy “controls access.” We’re going to talk more about this later, but for now here are a few ways proxies control access:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>As we know, a remote proxy controls access to a remote object.</p></li><li class="listitem"><p>A virtual proxy controls access to a resource that is expensive to create.</p></li><li class="listitem"><p>A protection proxy controls access to a resource based on access rights.</p></li></ul></div><p>Now that you’ve got the gist of the general pattern, check out the class diagram...</p><div class="informalfigure"><a id="med_id00652a"></a><div class="mediaobject"><a id="med_id00652"></a><img src="/library/view/head-first-design/0596007124/figs/web/468fig01.png.jpg" alt="image with no caption" width="701" height="523"></div></div><p>Let’s step through the diagram...</p><p>First we have a Subject, which provides an interface for the RealSubject and the Proxy. By implementing the same interface, the Proxy can be substituted for the RealSubject anywhere it occurs.</p><p>The RealSubject is the object that does the real work. It’s the object that the Proxy represents and controls access to.</p><p>The Proxy holds a reference to the RealSubject. In some cases, the Proxy may be responsible for creating and destroying the RealSubject. Clients interact with the RealSubject through the Proxy. Because the Proxy and RealSubject implement the same interface (Subject), the Proxy can be substituted anywhere the subject can be used. The Proxy also controls access to the RealSubject; this control may be needed if the Subject is running on a remote machine, if the Subject is expensive to create in some way or if access to the subject needs to be protected in some way.</p><p>Now that you understand the general pattern, let’s look at some other ways of using proxy beyond the Remote Proxy...</p></div><div class="sect1" title="Get ready for Virtual Proxy"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="get_ready_for_virtual_proxy">Get ready for Virtual Proxy</h2></div></div></div><p><a id="iddle1325" class="indexterm"></a><a id="iddle1997" class="indexterm"></a><a id="iddle2195" class="indexterm"></a><a id="iddle2496" class="indexterm"></a>Okay, so far you’ve seen the definition of the Proxy Pattern and you’ve taken a look at one specific example: the <span class="emphasis"><em>Remote Proxy</em></span>. Now we’re going to take a look at a different type of proxy, the <span class="emphasis"><em>Virtual Proxy</em></span>. As you’ll discover, the Proxy Pattern can manifest itself in many forms, yet all the forms follow roughly the general proxy design. Why so many forms? Because the Proxy Pattern can be applied to a lot of different use cases. Let’s check out the Virtual Proxy and compare it to Remote Proxy:</p><div class="sect2" title="Remote Proxy"><div class="titlepage"><div><div><h3 class="title" id="remote_proxy">Remote Proxy</h3></div></div></div><p>With Remote Proxy, the proxy acts as a local representative for an object that lives in a different JVM. A method call on the proxy results in the call being transferred over the wire, invoked remotely, and the result being returned back to the proxy and then to the Client.</p><div class="informalfigure"><a id="med_id00653a"></a><div class="mediaobject"><a id="med_id00653"></a><img src="/library/view/head-first-design/0596007124/figs/web/469fig01.png.jpg" alt="image with no caption" width="541" height="251"></div></div></div><div class="sect2" title="Virtual Proxy"><div class="titlepage"><div><div><h3 class="title" id="virtual_proxy">Virtual Proxy</h3></div></div></div><p>Virtual Proxy acts as a representative for an object that may be expensive to create. The Virtual Proxy often defers the creation of the object until it is needed; the Virtual Proxy also acts as a surrogate for the object before and while it is being created. After that, the proxy delegates requests directly to the RealSubject.</p><div class="informalfigure"><a id="med_id00654a"></a><div class="mediaobject"><a id="med_id00654"></a><img src="/library/view/head-first-design/0596007124/figs/web/469fig02.png.jpg" alt="image with no caption" width="541" height="338"></div></div></div></div><div class="sect1" title="Displaying CD covers"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="displaying_cd_covers">Displaying CD covers</h2></div></div></div><p><a id="iddle1092" class="indexterm"></a>Let’s say you want to write an application that displays your favorite compact disc covers. You might create a menu of the CD titles and then retrieve the images from an online service like Amazon.com. If you’re using Swing, you might create an Icon and ask it to load the image from the network. The only problem is, depending on the network load and the bandwidth of your connection, retrieving a CD cover might take a little time, so your application should display something while you are waiting for the image to load. We also don’t want to hang up the entire application while it’s waiting on the image. Once the image is loaded, the message should go away and you should see the image.</p><p>An easy way to achieve this is through a virtual proxy. The virtual proxy can stand in place of the icon, manage the background loading, and before the image is fully retrieved from the network, display “Loading CD cover, please wait...”. Once the image is loaded, the proxy delegates the display to the Icon.</p><div class="informalfigure"><a id="med_id00655a"></a><div class="mediaobject"><a id="med_id00655"></a><img src="/library/view/head-first-design/0596007124/figs/web/470fig01.png.jpg" alt="image with no caption" width="858" height="733"></div></div></div><div class="sect1" title="Designing the CD cover Virtual Proxy"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="designing_the_cd_cover_virtual_proxy">Designing the CD cover Virtual Proxy</h2></div></div></div><p><a id="iddle1094" class="indexterm"></a><a id="iddle1326" class="indexterm"></a><a id="iddle1998" class="indexterm"></a><a id="iddle2198" class="indexterm"></a><a id="iddle2499" class="indexterm"></a>Before writing the code for the CD Cover Viewer, let’s look at the class diagram. You’ll see this looks just like our Remote Proxy class diagram, but here the proxy is used to hide an object that is expensive to create (because we need to retrieve the data for the Icon over the network) as opposed to an object that actually lives somewhere else on the network.</p><div class="informalfigure"><a id="med_id00656a"></a><div class="mediaobject"><a id="med_id00656"></a><img src="/library/view/head-first-design/0596007124/figs/web/471fig01.png.jpg" alt="image with no caption" width="899" height="470"></div></div><div class="sect2" title="How ImageProxy is going to work"><div class="titlepage"><div><div><h3 class="title" id="how_imageproxy_is_going_to_work">How ImageProxy is going to work</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>① ImageProxy first creates an ImageIcon and starts loading it from a network URL.</strong></span></p></li><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>② While the bytes of the image are being retrieved, ImageProxy displays “Loading CD cover, please wait...”.</strong></span></p></li><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>③ When the image is fully loaded, ImageProxy delegates all method calls to the image icon, including paintIcon(), getWidth() and getHeight().</strong></span></p></li><li class="listitem" style="list-style-type: none"><p><span class="strong"><strong>④ If the user requests a new image, we’ll create a new proxy and start the process over.</strong></span></p></li></ul></div></div></div><div class="sect1" title="Writing the Image Proxy"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="writing_the_image_proxy">Writing the Image Proxy</h2></div></div></div><div class="informalfigure"><a id="med_id00657a"></a><div class="mediaobject"><a id="med_id00657"></a><img src="/library/view/head-first-design/0596007124/figs/web/472fig01.png.jpg" alt="image with no caption" width="844" height="971"></div></div><div class="sidebar"><a id="code_up_close-id00144"></a><div class="sidebar-title">Code Up Close</div><div class="informalfigure"><a id="med_id00658a"></a><div class="mediaobject"><a id="med_id00658"></a><img src="/library/view/head-first-design/0596007124/figs/web/473fig01.png.jpg" alt="image with no caption" width="760" height="736"></div></div></div><div class="sidebar"><a id="code_way_up_close-id00145"></a><div class="sidebar-title">Code Way Up Close</div><div class="informalfigure"><a id="med_id00659a"></a><div class="mediaobject"><a id="med_id00659"></a><img src="/library/view/head-first-design/0596007124/figs/web/474fig01.png.jpg" alt="image with no caption" width="720" height="488"></div></div></div><div class="note" title="Note"><h3 class="title"><a id="ch11note08"></a>Note</h3><p><a id="iddle1097" class="indexterm"></a><a id="iddle1329" class="indexterm"></a><a id="iddle1772" class="indexterm"></a><a id="iddle2001" class="indexterm"></a><a id="iddle2201" class="indexterm"></a><a id="iddle2502" class="indexterm"></a>So, the next time the display is painted after the ImageIcon is instantiated, the paintIcon method will paint the image, not the loading message.</p></div><div class="sidebar"><a id="design_puzzle-id00146"></a><div class="sidebar-title">Design Puzzle</div><p><a id="iddle1437" class="indexterm"></a><a id="iddle1517" class="indexterm"></a>The ImageProxy class appears to have two states that are controlled by conditional statements. Can you think of another pattern that might clean up this code? How would you redesign ImageProxy?</p><div class="informalfigure"><a id="med_id00660a"></a><div class="mediaobject"><a id="med_id00660"></a><img src="/library/view/head-first-design/0596007124/figs/web/475fig01.png.jpg" alt="image with no caption" width="767" height="706"></div></div></div></div><div class="sect1" title="Testing the CD Cover Viewer"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="testing_the_cd_cover_viewer">Testing the CD Cover Viewer</h2></div></div></div><div class="sidebar"><a id="ready_bake_code"></a><div class="sidebar-title">Ready Bake Code</div><p><a id="iddle1096" class="indexterm"></a><a id="iddle1328" class="indexterm"></a><a id="iddle2000" class="indexterm"></a><a id="iddle2200" class="indexterm"></a><a id="iddle2501" class="indexterm"></a>Okay, it’s time to test out this fancy new virtual proxy. Behind the scenes we’ve been baking up a new ImageProxyTestDrive that sets up the window, creates a frame, installs the menus and creates our proxy. We don’t go through all that code in gory detail here, but you can always grab the source code and have a look, or check it out at the end of the chapter where we list all the source code for the Virtual Proxy.</p><p>Here’s a partial view of the test drive code:</p><div class="informalfigure"><a id="med_id00661a"></a><div class="mediaobject"><a id="med_id00661"></a><img src="/library/view/head-first-design/0596007124/figs/web/476fig01.png.jpg" alt="image with no caption" width="781" height="358"></div></div><p>Now let’s run the test drive:</p><div class="informalfigure"><a id="med_id00662a"></a><div class="mediaobject"><a id="med_id00662"></a><img src="/library/view/head-first-design/0596007124/figs/web/476fig02.png.jpg" alt="image with no caption" width="803" height="310"></div></div></div><div class="sect2" title="Things to try..."><div class="titlepage"><div><div><h3 class="title" id="things_to_tryhellip">Things to try...</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>① Use the menu to load different CD covers; watch the proxy display “loading” until the image has arrived.</p></li><li class="listitem" style="list-style-type: none"><p>② Resize the window as the “loading” message is displayed. Notice that the proxy is handling the loading without hanging up the Swing window.</p></li><li class="listitem" style="list-style-type: none"><p>③ Add your own favorite CDs to the ImageProxyTestDrive.</p></li></ul></div></div></div><div class="sect1" title="What did we do?"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="what_did_we_doquestion_mark-id00147">What did we do?</h2></div></div></div><div class="sidebar"><a id="behind_the_scenes-id00148"></a><div class="sidebar-title">Behind the Scenes</div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>① <a id="iddle1095" class="indexterm"></a><a id="iddle1327" class="indexterm"></a><a id="iddle1999" class="indexterm"></a><a id="iddle2199" class="indexterm"></a><a id="iddle2500" class="indexterm"></a>We created an ImageProxy for the display. The paintIcon() method is called and ImageProxy fires off a thread to retrieve the image and create the ImageIcon.</p><div class="informalfigure"><a id="med_id00663a"></a><div class="mediaobject"><a id="med_id00663"></a><img src="/library/view/head-first-design/0596007124/figs/web/477fig01.png.jpg" alt="image with no caption" width="843" height="493"></div></div></li><li class="listitem" style="list-style-type: none"><p>② At some point the image is returned and the ImageIcon fully instantiated.</p></li><li class="listitem" style="list-style-type: none"><p>③ After the ImageIcon is created, the next time paintIcon() is called, the proxy delegates to the ImageIcon.</p><div class="informalfigure"><a id="med_id00664a"></a><div class="mediaobject"><a id="med_id00664"></a><img src="/library/view/head-first-design/0596007124/figs/web/477fig02.png.jpg" alt="image with no caption" width="608" height="257"></div></div></li></ul></div></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00149"></a><div class="sidebar-title">There Are No Dumb Questions</div><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "><col></colgroup><tbody><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch11qa2qe1"></a><a id="ch11qa2q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><a id="iddle1033" class="indexterm"></a><a id="iddle1088" class="indexterm"></a><a id="iddle1303" class="indexterm"></a><a id="iddle1354" class="indexterm"></a><a id="iddle1975" class="indexterm"></a><a id="iddle2150" class="indexterm"></a><a id="iddle2156" class="indexterm"></a><a id="iddle2159" class="indexterm"></a><a id="iddle2179" class="indexterm"></a><a id="iddle2185" class="indexterm"></a><a id="iddle2187" class="indexterm"></a><a id="iddle2193" class="indexterm"></a><a id="iddle2196" class="indexterm"></a><a id="iddle2204" class="indexterm"></a><a id="iddle2206" class="indexterm"></a><a id="iddle2497" class="indexterm"></a><span class="strong"><strong>Q: The Remote Proxy and Virtual Proxy seem so different to me; are they really ONE pattern?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch11qa2q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> You’ll find a lot of variants of the Proxy Pattern in the real world; what they all have in common is that they intercept a method invocation that the client is making on the subject. This level of indirection allows us to do many things, including dispatching requests to a remote subject, providing a representative for an expensive object as it is created, or, as you’ll see, providing some level of protection that can determine which clients should be calling which methods. That’s just the beginning; the general Proxy Pattern can be applied in many different ways, and we’ll cover some of the other ways at the end of the chapter.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch11qa2qe2"></a><a id="ch11qa2q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: ImageProxy seems just like a Decorator to me. I mean, we are basically wrapping one object with another and then delegating the calls to the ImageIcon. What am I missing?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch11qa2q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Sometimes Proxy and Decorator look very similar, but their purposes are different: a decorator adds behavior to a class, while a proxy controls access to it. You might ask, “Isn’t the loading message adding behavior?” In some ways it is; however, more importantly, the ImageProxy is controlling access to an ImageIcon. How does it control access? Well, think about it this way: the proxy is decoupling the client from the ImageIcon. If they were coupled the client would have to wait until each image is retrieved before it could paint its entire interface. The proxy controls access to the ImageIcon so that before it is fully created, the proxy provides another on screen representation. Once the ImageIcon is created the proxy allows access.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch11qa2qe3"></a><a id="ch11qa2q3"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: How do I make clients use the Proxy rather than the Real Subject?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch11qa2q3a3"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Good question. One common technique is to provide a factory that instantiates and returns the subject. Because this happens in a factory method we can then wrap the subject with a proxy before returning it. The client never knows or cares that it’s using a proxy instead of the real thing.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch11qa2qe4"></a><a id="ch11qa2q4"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: I noticed in the ImageProxy example, you always create a new ImageIcon to get the image, even if the image has already been retrieved. Could you implement something similar to the ImageProxy that caches past retrievals?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch11qa2q4a4"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> You are talking about a specialized form of a Virtual Proxy called a Caching Proxy. A caching proxy maintains a cache of previously created objects and when a request is made it returns cached object, if possible.</p><p>We’re going to look at this and at several other variants of the Proxy Pattern at the end of the chapter.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch11qa2qe5"></a><a id="ch11qa2q5"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: I see how Decorator and Proxy relate, but what about Adapter? An adapter seems very similar as well.</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch11qa2q5a5"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Both Proxy and Adapter sit in front of other objects and forward requests to them. Remember that Adapter changes the interface of the objects it adapts, while the Proxy implements the same interface.</p><p>There is one additional similarity that relates to the Protection Proxy. A Protection Proxy may allow or disallow a client access to particular methods in an object based on the role of the client. In this way a Protection Proxy may only provide a partial interface to a client, which is quite similar to some Adapters. We are going to take a look at Protection Proxy in a few pages.</p></td></tr></tbody></table></div></blockquote></div></div><div class="sidebar"><a id="fireside_chats-id00150"></a><div class="sidebar-title"><code class="literal">Fireside Chats</code></div><p>Tonight’s talk: <span class="strong"><strong>Proxy and Decorator get intentional.</strong></span></p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Proxy:</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Decorator:</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Hello, Decorator. I presume you’re here because people sometimes get us confused?</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Well, I think the reason people get us confused is that you go around pretending to be an entirely different pattern, when in fact, you’re just a Decorator in disguise. I really don’t think you should be copying all my ideas.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="emphasis"><em>Me</em></span> copying <span class="emphasis"><em>your</em></span> ideas? Please. I control access to objects. You just decorate them. My job is so much more important than yours it’s just not even funny.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>“Just” decorate? You think decorating is some frivolous, unimportant pattern? Let me tell you buddy, I add <span class="emphasis"><em>behavior</em></span>. That’s the most important thing about objects—what they do!</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Fine, so maybe you’re not entirely frivolous... but I still don’t get why you think I’m copying all your ideas. I’m all about representing my subjects, not decorating them.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>You can call it “representation” but if it looks like a duck and walks like a duck... I mean, just look at your Virtual Proxy; it’s just another way of adding behavior to do something while some big expensive object is loading, and your Remote Proxy is a way of talking to remote objects so your clients don’t have to bother with that themselves. It’s all about behavior, just like I said.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>I don’t think you get it, Decorator. I stand in for my Subjects; I don’t just add behavior. Clients use me as a surrogate of a Real Subject, because I can protect them from unwanted access, or keep their GUIs from hanging up while they’re waiting for big objects to load, or hide the fact that their Subjects are running on remote machines. I’d say that’s a very different intent from yours!</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Call it what you want. I implement the same interface as the objects I wrap; so do you.<a id="iddle1322" class="indexterm"></a><a id="iddle1718" class="indexterm"></a><a id="iddle1994" class="indexterm"></a><a id="iddle2174" class="indexterm"></a><a id="iddle2231" class="indexterm"></a><a id="iddle2533" class="indexterm"></a></p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Okay, let’s review that statement. You wrap an object. While sometimes we informally say a proxy wraps its Subject, that’s not really an accurate term.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Oh yeah? Why not?</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Think about a remote proxy... what object am I wrapping? The object I’m representing and controlling access to lives on another machine! Let’s see you do that.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Okay, but we all know remote proxies are kinda weird. Got a second example? I doubt it.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Sure, okay, take a virtual proxy... think about the CD viewer example. When the client first uses me as a proxy the subject doesn’t even exist! So what am I wrapping there?</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Uh huh, and the next thing you’ll be saying is that you actually get to create objects.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>I never knew decorators were so dumb! Of course I sometimes create objects. How do you think a virtual proxy gets its subject?! Okay, you just pointed out a big difference between us: we both know decorators only add window dressing; they never get to instantiate anything.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Oh yeah? Instantiate this!</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Hey, after this conversation I’m convinced you’re just a dumb proxy!</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Dumb proxy? I’d like to see you recursively wrap an object with 10 decorators and keep your head straight at the same time.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Very seldom will you ever see a proxy get into wrapping a subject multiple times; in fact, if you’re wrapping something 10 times, you better go back reexamine your design.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; "> </td><td style="vertical-align: top; "><p>Just like a proxy, acting all real when in fact you just stand in for the objects doing the real work. You know, I actually feel sorry for you.</p></td></tr></tbody></table></div></div></div><div class="sect1" title="Using the Java API’s Proxy to create a protection proxy"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="using_the_java_apiapostrophes_proxy_to_c">Using the Java API’s Proxy to create a protection proxy</h2></div></div></div><p><a id="iddle1308" class="indexterm"></a><a id="iddle1313" class="indexterm"></a><a id="iddle1468" class="indexterm"></a><a id="iddle1859" class="indexterm"></a><a id="iddle1980" class="indexterm"></a><a id="iddle1985" class="indexterm"></a><a id="iddle2146" class="indexterm"></a><a id="iddle2152" class="indexterm"></a><a id="iddle2176" class="indexterm"></a><a id="iddle2178" class="indexterm"></a><a id="iddle2184" class="indexterm"></a>Java’s got its own proxy support right in the java.lang.reflect package. With this package, Java lets you create a proxy class <span class="emphasis"><em>on the fly</em></span> that implements one or more interfaces and forwards method invocations to a class that you specify. Because the actual proxy class is created at runtime, we refer to this Java technology as a <span class="emphasis"><em>dynamic proxy</em></span>.</p><div class="informalfigure"><a id="med_id00665a"></a><div class="mediaobject"><a id="med_id00665"></a><img src="/library/view/head-first-design/0596007124/figs/web/481fig00.png.jpg" alt="image with no caption" width="147" height="124"></div></div><p>We’re going to use Java’s dynamic proxy to create our next proxy implementation (a protection proxy), but before we do that, let’s quickly look at a class diagram that shows how dynamic proxies are put together. Like most things in the real world, it differs slightly from the classic definition of the pattern:</p><div class="informalfigure"><a id="med_id00666a"></a><div class="mediaobject"><a id="med_id00666"></a><img src="/library/view/head-first-design/0596007124/figs/web/481fig01.png.jpg" alt="image with no caption" width="905" height="511"></div></div><p>Because Java creates the Proxy class <span class="emphasis"><em>for you</em></span>, you need a way to tell the Proxy class what to do. You can’t put that code into the Proxy class like we did before, because you’re not implementing one directly. So, if you can’t put this code in the Proxy class, where do you put it? In an InvocationHandler. The job of the InvocationHandler is to respond to any method calls on the proxy. Think of the InvocationHandler as the object the Proxy asks to do all the real work after it’s received the method calls.</p><p>Okay, let’s step through how to use the dynamic proxy...</p></div><div class="sect1" title="Matchmaking in Objectville"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="matchmaking_in_objectville">Matchmaking in Objectville</h2></div></div></div><div class="informalfigure"><a id="med_id00667a"></a><div class="mediaobject"><a id="med_id00667"></a><img src="/library/view/head-first-design/0596007124/figs/web/482fig01.png.jpg" alt="image with no caption" width="130" height="90"></div></div><p><a id="iddle1898" class="indexterm"></a>Every town needs a matchmaking service, right? You’ve risen to the task and implemented a dating service for Objectville. You’ve also tried to be innovative by including a “Hot or Not” feature in the service where participants can rate each other—you figure this keeps your customers engaged and looking through possible matches; it also makes things a lot more fun.</p><p>Your service revolves around a PersonBean that allows you to set and get information about a person:</p><div class="informalfigure"><a id="med_id00668a"></a><div class="mediaobject"><a id="med_id00668"></a><img src="/library/view/head-first-design/0596007124/figs/web/482fig02.png.jpg" alt="image with no caption" width="597" height="554"></div></div><p>Now let’s check out the implementation...</p></div><div class="sect1" title="The PersonBean implementation"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="personbean_implementation">The PersonBean implementation</h2></div></div></div><div class="informalfigure"><a id="med_id00669a"></a><div class="mediaobject"><a id="med_id00669"></a><img src="/library/view/head-first-design/0596007124/figs/web/483fig01.png.jpg" alt="image with no caption" width="824" height="895"></div></div><div class="informalfigure"><a id="med_id00670a"></a><div class="mediaobject"><a id="med_id00670"></a><img src="/library/view/head-first-design/0596007124/figs/web/484fig01.png.jpg" alt="image with no caption" width="473" height="557"></div></div><p><a id="iddle1310" class="indexterm"></a><a id="iddle1900" class="indexterm"></a><a id="iddle1982" class="indexterm"></a><a id="iddle2148" class="indexterm"></a><a id="iddle2181" class="indexterm"></a>While we suspect other factors may be keeping Elroy from getting dates, he is right: you shouldn’t be able to vote for yourself or to change another customer’s data. The way our PersonBean is defined, any client can call any of the methods.</p><p>This is a perfect example of where we might be able to use a Protection Proxy. What’s a Protection Proxy? It’s a proxy that controls access to an object based on access rights. For instance, if we had an employee object, a Protection Proxy might allow the employee to call certain methods on the object, a manager to call additional methods (like setSalary()), and a human resources employee to call any method on the object.</p><p>In our dating service we want to make sure that a customer can set his own information while preventing others from altering it. We also want to allow just the opposite with the HotOrNot ratings: we want the other customers to be able to set the rating, but not that particular customer. We also have a number of getter methods in the PersonBean, and because none of these return private information, any customer should be able to call them.</p></div><div class="sect1" title="Five-minute drama: protecting subjects"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="five-minute_drama_protecting_subjects">Five-minute drama: protecting subjects</h2></div></div></div><div class="informalfigure"><a id="med_id00671a"></a><div class="mediaobject"><a id="med_id00671"></a><img src="/library/view/head-first-design/0596007124/figs/web/common21.png.jpg" alt="image with no caption" width="90" height="93"></div></div><p><a id="iddle1311" class="indexterm"></a><a id="iddle1901" class="indexterm"></a><a id="iddle1983" class="indexterm"></a><a id="iddle2149" class="indexterm"></a><a id="iddle2182" class="indexterm"></a>The Internet bubble seems a distant memory; those were the days when all you needed to do to find a better, higher-paying job was to walk across the street. Even agents for software developers were in vogue...</p><div class="informalfigure"><a id="med_id00672a"></a><div class="mediaobject"><a id="med_id00672"></a><img src="/library/view/head-first-design/0596007124/figs/web/485fig01.png.jpg" alt="image with no caption" width="752" height="760"></div></div></div><div class="sect1" title="Big Picture: creating a Dynamic Proxy for the PersonBean"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="big_picture_creating_a_dynamic_proxy_for">Big Picture: creating a Dynamic Proxy for the PersonBean</h2></div></div></div><p><a id="iddle1309" class="indexterm"></a><a id="iddle1467" class="indexterm"></a><a id="iddle1899" class="indexterm"></a><a id="iddle1981" class="indexterm"></a><a id="iddle2147" class="indexterm"></a><a id="iddle2180" class="indexterm"></a>We have a couple of problems to fix: customers shouldn’t be changing their own HotOrNot rating and customers shouldn’t be able to change other customers’ personal information. To fix these problems we’re going to create two proxies: one for accessing your own PersonBean object and one for accessing another customer’s PersonBean object. That way, the proxies can control what requests can be made in each circumstance.</p><p>To create these proxies we’re going to use the Java API’s dynamic proxy that you saw a few pages back. Java will create two proxies for us; all we need to do is supply the handlers that know what to do when a method is invoked on the proxy.</p><div class="informalfigure"><a id="med_id00673a"></a><div class="mediaobject"><a id="med_id00673"></a><img src="/library/view/head-first-design/0596007124/figs/web/486fig01.png.jpg" alt="image with no caption" width="608" height="596"></div></div><p><span class="strong"><strong>Step one:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>Create two <span class="strong"><strong>InvocationHandlers.</strong></span></p></li><li class="listitem" style="list-style-type: none"><p>InvocationHandlers implement the behavior of the proxy. As you’ll see, Java will take care of creating the actual proxy class and object; we just need to supply a handler that knows what to do when a method is called on it.</p></li></ul></div><p><span class="strong"><strong>Step two:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>Write the code that creates the dynamic proxies.</p></li><li class="listitem" style="list-style-type: none"><p>We need to write a little bit of code to generate the proxy class and instantiate it. We’ll step through this code in just a bit.</p></li></ul></div><p><span class="strong"><strong>Step three:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>Wrap any PersonBean object with the appropriate proxy.</p></li><li class="listitem" style="list-style-type: none"><p>When we need to use a PersonBean object, either it’s the object of the customer himself (in that case, will call him the “owner”), or it’s another user of the service that the customer is checking out (in that case we’ll call him “non-owner”).</p></li><li class="listitem" style="list-style-type: none"><p>In either case, we create the appropriate proxy for the PersonBean.</p></li></ul></div><div class="informalfigure"><a id="med_id00674a"></a><div class="mediaobject"><a id="med_id00674"></a><img src="/library/view/head-first-design/0596007124/figs/web/486fig02.png.jpg" alt="image with no caption" width="447" height="346"></div></div></div><div class="sect1" title="Step one: creating Invocation Handlers"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="step_one_creating_invocation_handlers">Step one: creating Invocation Handlers</h2></div></div></div><p><a id="iddle2186" class="indexterm"></a><a id="iddle2205" class="indexterm"></a>We know we need to write two invocation handlers, one for the owner and one for the non-owner. But what are invocation handlers? Here’s the way to think about them: when a method call is made on the proxy, the proxy forwards that call to your invocation handler, but not by calling the invocation handler’s corresponding method. So, what does it call? Have a look at the InvocationHandler interface:</p><div class="informalfigure"><a id="med_id00675a"></a><div class="mediaobject"><a id="med_id00675"></a><img src="/library/view/head-first-design/0596007124/figs/web/487fig01.png.jpg" alt="image with no caption" width="239" height="125"></div></div><p>There’s only one method, invoke(), and no matter what methods get called on the proxy, the invoke() method is what gets called on the handler. Let’s see how this works:</p><div class="informalfigure"><a id="med_id00676a"></a><div class="mediaobject"><a id="med_id00676"></a><img src="/library/view/head-first-design/0596007124/figs/web/487fig02.png.jpg" alt="image with no caption" width="809" height="529"></div></div></div><div class="sect1" title="Creating Invocation Handlers continued..."><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="creating_invocation_handlers_continuedhe">Creating Invocation Handlers continued...</h2></div></div></div><p><a id="iddle1860" class="indexterm"></a><a id="iddle2177" class="indexterm"></a><a id="iddle2188" class="indexterm"></a><a id="iddle2207" class="indexterm"></a>When invoke() is called by the proxy, how do you know what to do with the call? Typically, you’ll examine the method that was called on the proxy and make decisions based on the method’s name and possibly its arguments. Let’s implement the OwnerInvocationHandler to see how this works:</p><div class="informalfigure"><a id="med_id00677a"></a><div class="mediaobject"><a id="med_id00677"></a><img src="/library/view/head-first-design/0596007124/figs/web/488fig01.png.jpg" alt="image with no caption" width="792" height="740"></div></div><div class="sidebar"><a id="exercise-id00151"></a><div class="sidebar-title">Exercise</div><p><a id="iddle1592" class="indexterm"></a>The NonOwnerInvocationHandler works just like the OwnerInvocationHandler except that it <span class="emphasis"><em>allows</em></span> calls to setHotOrNotRating() and it <span class="emphasis"><em>disallows</em></span> calls to any other set method. Go ahead and write this handler yourself:</p></div></div><div class="sect1" title="Step two: creating the Proxy class and instantiating the Proxy object"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="step_two_creating_the_proxy_class_and_in">Step two: creating the Proxy class and instantiating the Proxy object</h2></div></div></div><p><a id="iddle1570" class="indexterm"></a><a id="iddle2189" class="indexterm"></a><a id="iddle2208" class="indexterm"></a><a id="iddle2315" class="indexterm"></a>Now, all we have left is to dynamically create the Proxy class and instantiate the proxy object. Let’s start by writing a method that takes a PersonBean and knows how to create an owner proxy for it. That is, we’re going to create the kind of proxy that forwards its method calls to the OwnerInvocationHandler. Here’s the code:</p><div class="informalfigure"><a id="med_id00678a"></a><div class="mediaobject"><a id="med_id00678"></a><img src="/library/view/head-first-design/0596007124/figs/web/490fig01.png.jpg" alt="image with no caption" width="761" height="401"></div></div><div class="sidebar"><a id="sharpen_your_pencil-id00152"></a><div class="sidebar-title">Sharpen your pencil</div><p>While it is a little complicated, there isn’t much to creating a dynamic proxy. Why don’t you write getNonOwnerProxy(), which returns a proxy for the NonOwnerInvocationHandler:</p><p>Take it further: can you write one method getProxy() that takes a handler and a person and returns a proxy that uses that handler?</p></div></div><div class="sect1" title="Testing the matchmaking service"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="testing_the_matchmaking_service">Testing the matchmaking service</h2></div></div></div><p><a id="iddle1312" class="indexterm"></a><a id="iddle1902" class="indexterm"></a><a id="iddle1984" class="indexterm"></a><a id="iddle2151" class="indexterm"></a><a id="iddle2183" class="indexterm"></a>Let’s give the matchmaking service a test run and see how it controls access to the setter methods based on the proxy that is used.</p><div class="informalfigure"><a id="med_id00679a"></a><div class="mediaobject"><a id="med_id00679"></a><img src="/library/view/head-first-design/0596007124/figs/web/491fig01.png.jpg" alt="image with no caption" width="791" height="786"></div></div></div><div class="sect1" title="Running the code..."><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="running_the_codehellip">Running the code...</h2></div></div></div><div class="informalfigure"><a id="med_id00680a"></a><div class="mediaobject"><a id="med_id00680"></a><img src="/library/view/head-first-design/0596007124/figs/web/492fig01.png.jpg" alt="image with no caption" width="711" height="450"></div></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00153"></a><div class="sidebar-title">There Are No Dumb Questions</div><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "><col></colgroup><tbody><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch11qa3qe1"></a><a id="ch11qa3q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><a id="iddle1120" class="indexterm"></a><a id="iddle1466" class="indexterm"></a><a id="iddle2155" class="indexterm"></a><a id="iddle2161" class="indexterm"></a><a id="iddle2190" class="indexterm"></a><span class="strong"><strong>Q: So what exactly is the “dynamic” aspect of dynamic proxies? Is it that I’m instantiating the proxy and setting it to a handler at runtime?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch11qa3q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> No, the proxy is dynamic because its class is created at runtime. Think about it: before your code runs there is no proxy class; it is created on demand from the set of interfaces you pass it.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch11qa3qe2"></a><a id="ch11qa3q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: My InvocationHandler seems like a very strange proxy, it doesn’t implement any of the methods of the class it’s proxying.</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch11qa3q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> That is because the InvocationHandler isn’t a proxy—it is a class that the proxy dispatches to for handling method calls. The proxy itself is created dynamically at runtime by the static Proxy.newProxyInstance() method.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch11qa3qe3"></a><a id="ch11qa3q3"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Is there any way to tell if a class is a Proxy class?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch11qa3q3a3"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Yes. The Proxy class has a static method called isProxyClass(). Calling this method with a class will return true if the class is a dynamic proxy class. Other than that, the proxy class will act like any other class that implements a particular set of interfaces.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch11qa3qe4"></a><a id="ch11qa3q4"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Are there any restrictions on the types of interfaces I can pass into newProxyInstance()?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch11qa3q4a4"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Yes, there are a few. First, it is worth pointing out that we always pass newProxyInstance() an array of interfaces—only interfaces are allowed, no classes. The major restrictions are that all non-public interfaces need to be from the same package. You also can’t have interfaces with clashing method names (that is, two interfaces with a method with the same signature). There are a few other minor nuances as well, so at some point you should take a look at the fine print on dynamic proxies in the javadoc.</p></td></tr></tbody></table></div></blockquote></div></div><div class="sidebar"><a id="who_does_whatquestion_mark-id00154"></a><div class="sidebar-title">Who Does What?</div><p><a id="iddle1025" class="indexterm"></a><a id="iddle1347" class="indexterm"></a><a id="iddle1586" class="indexterm"></a><a id="iddle1609" class="indexterm"></a><a id="iddle2162" class="indexterm"></a><a id="iddle2523" class="indexterm"></a>Match each pattern with its description:</p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Pattern</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Description</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Decorator</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Wraps another object and provides a different interface to it.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Facade</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Wraps another object and provides additional behavior for it.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Proxy</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Wraps another object to control access to it.</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>Adapter</p></td><td style="vertical-align: top; "><p>Wraps a bunch of objects to simplify their interface.</p></td></tr></tbody></table></div></div></div><div class="sect1" title="The Proxy Zoo"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="proxy_zoo">The Proxy Zoo</h2></div></div></div><p><a id="iddle1089" class="indexterm"></a><a id="iddle1304" class="indexterm"></a><a id="iddle1307" class="indexterm"></a><a id="iddle1323" class="indexterm"></a><a id="iddle1677" class="indexterm"></a><a id="iddle1976" class="indexterm"></a><a id="iddle1979" class="indexterm"></a><a id="iddle1995" class="indexterm"></a><a id="iddle2165" class="indexterm"></a><a id="iddle2191" class="indexterm"></a><a id="iddle2194" class="indexterm"></a><a id="iddle2197" class="indexterm"></a><a id="iddle2352" class="indexterm"></a><a id="iddle2498" class="indexterm"></a>Welcome to the Objectville Zoo!</p><div class="informalfigure"><a id="med_id00681a"></a><div class="mediaobject"><a id="med_id00681"></a><img src="/library/view/head-first-design/0596007124/figs/web/494fig01.png.jpg" alt="image with no caption" width="211" height="126"></div></div><p>You now know about the remote, virtual and protection proxies, but out in the wild you’re going to see lots of mutations of this pattern. Over here in the Proxy corner of the zoo we’ve got a nice collection of wild proxy patterns that we’ve captured for your study.</p><p>Our job isn’t done; we are sure you’re going to see more variations of this pattern in the real world, so give us a hand in cataloging more proxies. Let’s take a look at the existing collection:</p><div class="informalfigure"><a id="med_id00682a"></a><div class="mediaobject"><a id="med_id00682"></a><img src="/library/view/head-first-design/0596007124/figs/web/494fig02.png.jpg" alt="image with no caption" width="842" height="672"></div></div><div class="informalfigure"><a id="med_id00683a"></a><div class="mediaobject"><a id="med_id00683"></a><img src="/library/view/head-first-design/0596007124/figs/web/495fig01.png.jpg" alt="image with no caption" width="828" height="589"></div></div><div class="note" title="Note"><h3 class="title"><a id="ch11note09"></a>Note</h3><p><a id="iddle1223" class="indexterm"></a><a id="iddle1305" class="indexterm"></a><a id="iddle1306" class="indexterm"></a><a id="iddle1324" class="indexterm"></a><a id="iddle1330" class="indexterm"></a><a id="iddle1605" class="indexterm"></a><a id="iddle1977" class="indexterm"></a><a id="iddle1978" class="indexterm"></a><a id="iddle1996" class="indexterm"></a><a id="iddle2157" class="indexterm"></a><a id="iddle2158" class="indexterm"></a><a id="iddle2192" class="indexterm"></a><a id="iddle2451" class="indexterm"></a>Field Notes: please add your observations of other proxies in the wild here:</p></div><p>____________________________________________________</p><p>____________________________________________________</p><p>____________________________________________________</p><p>____________________________________________________</p><p>____________________________________________________</p><div class="sidebar"><a id="design_patterns_crossword-id00155"></a><div class="sidebar-title">Design Patterns Crossword</div><p>It’s been a LONG chapter. Why not unwind by doing a crossword puzzle before it ends?</p><div class="informalfigure"><a id="med_id00684a"></a><div class="mediaobject"><a id="med_id00684"></a><img src="/library/view/head-first-design/0596007124/figs/web/496fig01.png" alt="image with no caption" width="769" height="524"></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Across</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Down</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>1. Our first mistake: the gumball machine reporting was not _________.</p>
<p>5. Commonly used proxy for web services (two words).</p>
<p>7. Objectville matchmaking gimmick (three words).</p>
<p>11. A _______ proxy class is created at runtime.</p>
<p>13. Java’s dynamic proxy forwards all requests to this (two words).</p>
<p>16. In RMI, the object that takes the network requests on the service side.</p>
<p>17. The CD viewer used this kind of proxy.</p></td><td style="vertical-align: top; "><p>2. Remote _________ was used to implement the gumball machine monitor (two words).</p>
<p>3. Similar to proxy, but with a different purpose.</p>
<p>4. Place to learn about the many proxy variants.</p>
<p>6. Proxy that protects method calls from unauthorized callers.</p>
<p>8. This utility acts as a lookup service for RMI.</p>
<p>9. Why Elroy couldn’t get dates.</p>
<p>10. Software developer agent was being this kind of proxy.</p>
<p>12. In RMI, the proxy is called this.</p>
<p>14. Proxy that stands in for expensive objects.</p>
<p>15. We took one of these to learn RMI.</p></td></tr></tbody></table></div></div></div><div class="sect1" title="Tools for your Design Toolbox"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="tools_for_your_design_toolbox-id00156">Tools for your Design Toolbox</h2></div></div></div><p>Your design toolbox is almost full; you’re prepared for almost any design problem that comes your way.</p><div class="informalfigure"><a id="med_id00685a"></a><div class="mediaobject"><a id="med_id00685"></a><img src="/library/view/head-first-design/0596007124/figs/web/497fig01.png.jpg" alt="image with no caption" width="573" height="882"></div></div><div class="sidebar"><a id="bullet_points-id00157"></a><div class="sidebar-title">Bullet Points</div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The Proxy Pattern provides a representative for another object in order to control the client’s access to it. There are a number of ways it can manage that access.</p></li><li class="listitem"><p>A Remote Proxy manages interaction between a client and a remote object.</p></li><li class="listitem"><p>A Virtual Proxy controls access to an object that is expensive to instantiate.</p></li><li class="listitem"><p>A Protection Proxy controls access to the methods of an object based on the caller.</p></li><li class="listitem"><p>Many other variants of the Proxy Pattern exist including caching proxies, synchronization proxies, firewall proxies, copy-on-write proxies, and so on.</p></li><li class="listitem"><p>Proxy is structurally similar to Decorator, but the two differ in their purpose.</p></li><li class="listitem"><p>The Decorator Pattern adds behavior to an object, while a Proxy controls access.</p></li><li class="listitem"><p>Java’s built-in support for Proxy can build a dynamic proxy class on demand and dispatch all calls on it to a handler of your choosing.</p></li><li class="listitem"><p>Like any wrapper, proxies will increase the number of classes and objects in your designs.</p></li></ul></div></div><div class="sidebar"><a id="exercise_solution-id00158"></a><div class="sidebar-title">Exercise Solution</div><p><a id="iddle1438" class="indexterm"></a><a id="iddle1518" class="indexterm"></a><a id="iddle1593" class="indexterm"></a>The NonOwnerInvocationHandler works just like the OwnerInvocationHandler except that it <span class="emphasis"><em>allows</em></span> calls to setHotOrNotRating() and it <span class="emphasis"><em>disallows</em></span> calls to any other set method. Here’s our solution:</p><a id="pro_id00041"></a><pre class="programlisting"><span class="strong"><strong>import java.lang.reflect.*;</strong></span>

<span class="strong"><strong>public class NonOwnerInvocationHandler implements InvocationHandler {</strong></span>
    <span class="strong"><strong>PersonBean person;</strong></span>

    <span class="strong"><strong>public NonOwnerInvocationHandler(PersonBean person) {</strong></span>
        <span class="strong"><strong>this.person = person;</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public Object invoke(Object proxy, Method method, Object[] args)</strong></span>
            <span class="strong"><strong>throws IllegalAccessException {</strong></span>

        <span class="strong"><strong>try {</strong></span>
            <span class="strong"><strong>if (method.getName().startsWith("get")) {</strong></span>
                <span class="strong"><strong>return method.invoke(person, args);</strong></span>
            <span class="strong"><strong>} else if (method.getName().equals("setHotOrNotRating")) {</strong></span>
                <span class="strong"><strong>return method.invoke(person, args);</strong></span>
            <span class="strong"><strong>} else if (method.getName().startsWith("set")) {</strong></span>
                <span class="strong"><strong>throw new IllegalAccessException();</strong></span>
            <span class="strong"><strong>}</strong></span>
        <span class="strong"><strong>} catch (InvocationTargetException e) {</strong></span>
            <span class="strong"><strong>e.printStackTrace();</strong></span>
        <span class="strong"><strong>}</strong></span>
        <span class="strong"><strong>return null;</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre></div><div class="sidebar"><a id="design_puzzle_solution-id00159"></a><div class="sidebar-title">Design Puzzle Solution</div><p>The ImageProxy class appears to have two states that are controlled by conditional statements. Can you think of another pattern that might clean up this code? How would you redesign ImageProxy?</p><p>Use State Pattern: implement two states, ImageLoaded and ImageNotLoaded. Then put the code from the if statements into their respective states. Start in the ImageNotLoaded state and then transition to the ImageLoaded state once the ImageIcon had been retrieved.</p></div><div class="sidebar"><a id="sharpen_your_pencil_solution-id00160"></a><div class="sidebar-title">Sharpen your pencil Solution</div><p><a id="iddle1571" class="indexterm"></a><a id="iddle2316" class="indexterm"></a>While it is a little complicated, there isn’t much to creating a dynamic proxy. Why don’t you write getNonOwnerProxy(), which returns a proxy for the NonOwnerInvocationHandler. Here’s our solution:</p><a id="pro_id00042"></a><pre class="programlisting"><span class="strong"><strong>PersonBean getNonOwnerProxy(PersonBean person) {</strong></span>

    <span class="strong"><strong>return (PersonBean) Proxy.newProxyInstance(</strong></span>
            <span class="strong"><strong>person.getClass().getClassLoader(),</strong></span>
            <span class="strong"><strong>person.getClass().getInterfaces(),</strong></span>
            <span class="strong"><strong>new NonOwnerInvocationHandler(person));</strong></span>
<span class="strong"><strong>}</strong></span></pre></div><div class="sidebar"><a id="design_patterns_crossword_soluti-id00161"></a><div class="sidebar-title">Design Patterns Crossword Solution</div><div class="informalfigure"><a id="med_id00686a"></a><div class="mediaobject"><a id="med_id00686"></a><img src="/library/view/head-first-design/0596007124/figs/web/499fig01.png" alt="image with no caption" width="721" height="491"></div></div></div><div class="sidebar"><a id="who_does_whatquestion_mark_solut-id00162"></a><div class="sidebar-title">Who Does What? Solution</div><p><a id="iddle1587" class="indexterm"></a><a id="iddle2524" class="indexterm"></a>Match each pattern with its description:</p><div class="informalfigure"><a id="med_id00687a"></a><div class="mediaobject"><a id="med_id00687"></a><img src="/library/view/head-first-design/0596007124/figs/web/500fig01.png.jpg" alt="image with no caption" width="499" height="455"></div></div></div></div><div class="sect1" title="The code for the CD Cover Viewer"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="code_for_the_cd_cover_viewer">The code for the CD Cover Viewer</h2></div></div></div><div class="sidebar"><a id="ready_bake_code-id00163"></a><div class="sidebar-title">Ready Bake Code</div><a id="pro_id00043"></a><pre class="programlisting"><span class="strong"><strong>package headfirst.designpatterns.proxy.virtualproxy;</strong></span>

<span class="strong"><strong>import java.net.*;</strong></span>
<span class="strong"><strong>import java.awt.*;</strong></span>
<span class="strong"><strong>import java.awt.event.*;</strong></span>
<span class="strong"><strong>import javax.swing.*;</strong></span>
<span class="strong"><strong>import java.util.*;</strong></span>
<span class="strong"><strong>public class ImageProxyTestDrive {</strong></span>
    <span class="strong"><strong>ImageComponent imageComponent;</strong></span>
    <span class="strong"><strong>JFrame frame = new JFrame("CD Cover Viewer");</strong></span>
    <span class="strong"><strong>JMenuBar menuBar;</strong></span>
    <span class="strong"><strong>JMenu menu;</strong></span>
    <span class="strong"><strong>Hashtable&lt;String, String&gt; cds = new Hashtable&lt;String, String&gt;();</strong></span>

    <span class="strong"><strong>public static void main (String[] args) throws Exception {</strong></span>
        <span class="strong"><strong>ImageProxyTestDrive testDrive = new ImageProxyTestDrive();</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public ImageProxyTestDrive() throws Exception{</strong></span>
        <span class="strong"><strong>cds.put("Buddha Bar","http://images.amazon.com/images/P/B00009XBYK.01.LZZZZZZZ.</strong></span>
<span class="strong"><strong>jpg");</strong></span>
        <span class="strong"><strong>cds.put("Ima","http://images.amazon.com/images/P/B000005IRM.01.LZZZZZZZ.jpg");</strong></span>
        <span class="strong"><strong>cds.put("Karma","http://images.amazon.com/images/P/B000005DCB.01.LZZZZZZZ.gif");</strong></span>
        <span class="strong"><strong>cds.put("MCMXC A.D.","http://images.amazon.com/images/P/B000002URV.01.LZZZZZZZ.</strong></span>
<span class="strong"><strong>jpg");</strong></span>
        <span class="strong"><strong>cds.put("Northern Exposure","http://images.amazon.com/images/P/B000003SFN.01.</strong></span>
<span class="strong"><strong>LZZZZZZZ.jpg");</strong></span>
        <span class="strong"><strong>cds.put("Selected Ambient Works, Vol. 2","http://images.amazon.com/images/P/</strong></span>
<span class="strong"><strong>B000002MNZ.01.LZZZZZZZ.jpg");</strong></span>

        <span class="strong"><strong>URL initialURL = new URL((String)cds.get("Selected Ambient Works, Vol. 2"));</strong></span>
        <span class="strong"><strong>menuBar = new JMenuBar();</strong></span>
        <span class="strong"><strong>menu = new JMenu("Favorite CDs");</strong></span>
        <span class="strong"><strong>menuBar.add(menu);</strong></span>
        <span class="strong"><strong>frame.setJMenuBar(menuBar);</strong></span>
        <span class="strong"><strong>for(Enumeration e = cds.keys(); e.hasMoreElements();) {</strong></span>
            <span class="strong"><strong>String name = (String)e.nextElement();</strong></span>
            <span class="strong"><strong>JMenuItem menuItem = new JMenuItem(name);</strong></span>
            <span class="strong"><strong>menu.add(menuItem);</strong></span>
            <span class="strong"><strong>menuItem.addActionListener(event -&gt; {</strong></span>
                <span class="strong"><strong>imageComponent.setIcon(new ImageProxy(getCDUrl(event.getActionCommand())));</strong></span>
                <span class="strong"><strong>frame.repaint();</strong></span>
            <span class="strong"><strong>});</strong></span>
        <span class="strong"><strong>}</strong></span>

        <span class="strong"><strong>// set up frame and menus</strong></span>

        <span class="strong"><strong>Icon icon = new ImageProxy(initialURL);</strong></span>
        <span class="strong"><strong>imageComponent = new ImageComponent(icon);</strong></span>
        <span class="strong"><strong>frame.getContentPane().add(imageComponent);</strong></span>
        <span class="strong"><strong>frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</strong></span>
        <span class="strong"><strong>frame.setSize(800,600);</strong></span>
        <span class="strong"><strong>frame.setVisible(true);</strong></span>

    <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>URL getCDUrl(String name) {</strong></span>
        <span class="strong"><strong>try {</strong></span>
            <span class="strong"><strong>return new URL((String)cds.get(name));</strong></span>
        <span class="strong"><strong>} catch (MalformedURLException e) {</strong></span>
            <span class="strong"><strong>e.printStackTrace();</strong></span>
            <span class="strong"><strong>return null;</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span>
<span class="strong"><strong>package headfirst.designpatterns.proxy.virtualproxy;</strong></span>

<span class="strong"><strong>import java.net.*;</strong></span>
<span class="strong"><strong>import java.awt.*;</strong></span>
<span class="strong"><strong>import javax.swing.*;</strong></span>

<span class="strong"><strong>class ImageProxy implements Icon {</strong></span>
    <span class="strong"><strong>volatile ImageIcon imageIcon;</strong></span>
    <span class="strong"><strong>final URL imageURL;</strong></span>
    <span class="strong"><strong>Thread retrievalThread;</strong></span>
    <span class="strong"><strong>boolean retrieving = false;</strong></span>

    <span class="strong"><strong>public ImageProxy(URL url) { imageURL = url; }</strong></span>

    <span class="strong"><strong>public int getIconWidth() {</strong></span>
        <span class="strong"><strong>if (imageIcon != null) {</strong></span>
            <span class="strong"><strong>return imageIcon.getIconWidth();</strong></span>
        <span class="strong"><strong>} else {</strong></span>
            <span class="strong"><strong>return 800;</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public int getIconHeight() {</strong></span>
        <span class="strong"><strong>if (imageIcon != null) {</strong></span>
            <span class="strong"><strong>return imageIcon.getIconHeight();</strong></span>
        <span class="strong"><strong>} else {</strong></span>
            <span class="strong"><strong>return 600;</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>synchronized void setImageIcon(ImageIcon imageIcon) {</strong></span>
        <span class="strong"><strong>this.imageIcon = imageIcon;</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void paintIcon(final Component c, Graphics g, int x, int y) {</strong></span>
        <span class="strong"><strong>if (imageIcon != null) {</strong></span>
            <span class="strong"><strong>imageIcon.paintIcon(c, g, x, y);</strong></span>
        <span class="strong"><strong>} else {</strong></span>
            <span class="strong"><strong>g.drawString("Loading CD cover, please wait...", x+300, y+190);</strong></span>
            <span class="strong"><strong>if (!retrieving) {</strong></span>
                <span class="strong"><strong>retrieving = true;</strong></span>
                <span class="strong"><strong>retrievalThread = new Thread(new Runnable() {</strong></span>
                    <span class="strong"><strong>public void run() {</strong></span>
                        <span class="strong"><strong>try {</strong></span>
                            <span class="strong"><strong>setImageIcon(new ImageIcon(imageURL, "CD Cover"));</strong></span>
                            <span class="strong"><strong>c.repaint();</strong></span>
                        <span class="strong"><strong>} catch (Exception e) {</strong></span>
                            <span class="strong"><strong>e.printStackTrace();</strong></span>
                        <span class="strong"><strong>}</strong></span>
                    <span class="strong"><strong>}</strong></span>
                <span class="strong"><strong>});</strong></span>
                <span class="strong"><strong>retrievalThread.start();</strong></span>
            <span class="strong"><strong>}</strong></span>
        <span class="strong"><strong>}</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span>
<span class="strong"><strong>package headfirst.designpatterns.proxy.virtualproxy;</strong></span>

<span class="strong"><strong>import java.awt.*;</strong></span>
<span class="strong"><strong>import javax.swing.*;</strong></span>

<span class="strong"><strong>class ImageComponent extends JComponent {</strong></span>
    <span class="strong"><strong>private Icon icon;</strong></span>

    <span class="strong"><strong>public ImageComponent(Icon icon) {</strong></span>
        <span class="strong"><strong>this.icon = icon;</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void setIcon(Icon icon) {</strong></span>
        <span class="strong"><strong>this.icon = icon;</strong></span>
    <span class="strong"><strong>}</strong></span>

    <span class="strong"><strong>public void paintComponent(Graphics g) {</strong></span>
        <span class="strong"><strong>super.paintComponent(g);</strong></span>
        <span class="strong"><strong>int w = icon.getIconWidth();</strong></span>
        <span class="strong"><strong>int h = icon.getIconHeight();</strong></span>
        <span class="strong"><strong>int x = (800 - w)/2;</strong></span>
        <span class="strong"><strong>int y = (600 - h)/2;</strong></span>
        <span class="strong"><strong>icon.paintIcon(this, g, x, y);</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>}</strong></span></pre></div></div></section></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="/library/view/head-first-design/0596007124/ch10.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">10. The State Pattern: The State of Things</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="/library/view/head-first-design/0596007124/ch12.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">12. Compound Patterns: Patterns of Patterns</div>
        </a>
    
  
  </div>


        
    </section>
  </div>
<section class="sbo-saved-archives"></section>

<script>
  window.dataLayer = window.dataLayer || [];
  context = {
    product: {
      title: 'Head First Design Patterns',
      type: 'book',
      identifier: '0596007124',
      topic: 'Design Patterns'
    },
    content: {
      title: 'Head First Design Patterns',
      formatType: 'book',
      identifier: '0596007124',
      author: 'Kathy Sierra, Bert Bates, Elisabeth Robson, Eric Freeman',
      publisher: 'O&#39;Reilly Media, Inc.',
      releaseDate: '2004-10-25',
      parentTopic: 'none',
      free: 'no',
      subdirectory: 'none'
    }
  }
  dataLayer.push(context);
</script>



          
          
  




    
    



        
      </div>
      



  <footer class="pagefoot t-pagefoot">
    <a href="#" class="icon-up"><div class="visuallyhidden">Back to top</div></a>
    <ul class='js-footer-nav'>
      
        <li><a class="t-resource-centers-footer" href="/resource-centers/">Resource Centers</a></li>
      
      <li>
      <a class="t-queue-footer" href="/playlists/">Playlists</a>
      </li>
      
        <li><a class="t-recent-footer" href="/history/">History</a></li>
        <li><a class="t-topics-footer" href="/topics?q=*&limit=21">Topics</a></li>
      
      <li><a class="t-settings-footer js-settings" href="/u/preferences/">Settings</a></li>
      <li class="full-support"><a href="https://www.oreilly.com/online-learning/support/">Support</a></li>
      <li><a href="https://www.oreilly.com/online-learning/apps.html">Get the App</a></li>
      <li><a href="/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">&#169; 2019 <a href="/" target="_blank">Safari</a>.</span>
    <a href="/terms/">Terms of Service</a> /
    <a href="https://www.oreilly.com/privacy.html">Privacy Policy</a>
  </footer>

<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"applicationID":"172641827,79672898,93931619","agent":"","queueTime":3,"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","applicationTime":862,"transactionName":"YgdaZ0NSW0cEB0RdWltNfkZfUEFdCgofXFBHDVYdR1pQQxZeRl1QQj1aWkU=","licenseKey":"510f1a6865"}</script>


    
    <script src="/jsi18n/web/" charset="utf-8"></script>
    <script src="/library/jsi18n/appcache/" charset="utf-8"></script>
  </body>
</html>
